"""
ğŸ§ª STEM ì—ì´ì „íŠ¸ í†µí•© ëª¨ë“ˆ for FastAPI - ì‹¤ì œ AI ëŒ€í™” ëŠ¥ë ¥ ë²„ì „
ì§„ì§œ AI ëŒ€í™” ëŠ¥ë ¥ìœ¼ë¡œ ê° ë¶„ì•¼ë³„ ì „ë¬¸ê°€ ë„ê¹¨ë¹„ ì‹œë®¬ë ˆì´ì…˜
"""

from fastapi import FastAPI, HTTPException, Request, Form
from fastapi.responses import HTMLResponse, JSONResponse, RedirectResponse
from fastapi.templating import Jinja2Templates
from pydantic import BaseModel
from typing import Dict, Any, List, Optional
import json
import datetime
import os
import random

# ì‚¬ìš©ëŸ‰ ì¶”ì  ì‹œìŠ¤í…œ ì„í¬íŠ¸
from usage_tracker import usage_tracker

# í…œí”Œë¦¿ ì„¤ì • (ì—†ìœ¼ë©´ None)
templates = None
if os.path.exists("templates/stem"):
    templates = Jinja2Templates(directory="templates/stem")


class STEMRequest(BaseModel):
    question: str
    agent_type: str


class STEMService:
    def __init__(self):
        """STEM ì„œë¹„ìŠ¤ ì´ˆê¸°í™”"""
        print("ğŸš€ ì‹¤ì œ AI ëŒ€í™” ëŠ¥ë ¥ ê¸°ë°˜ STEM ì—ì´ì „íŠ¸ ì‹œì‘ ì¤‘...")

    async def process_question(
        self, question: str, agent_type: str, user_ip: Optional[str] = None
    ) -> Dict[str, Any]:
        """ì‹¤ì œ AI ëŒ€í™” ëŠ¥ë ¥ìœ¼ë¡œ ì§ˆë¬¸ ì²˜ë¦¬"""
        try:
            # ì—ì´ì „íŠ¸ë³„ ì •ë³´
            agent_info = {
                "math": {"emoji": "ğŸ§®", "name": "ìˆ˜í•™ ë„ê¹¨ë¹„", "field": "ìˆ˜í•™"},
                "physics": {"emoji": "âš›ï¸", "name": "ë¬¼ë¦¬í•™ ë„ê¹¨ë¹„", "field": "ë¬¼ë¦¬í•™"},
                "chemistry": {"emoji": "ğŸ§ª", "name": "í™”í•™ ë„ê¹¨ë¹„", "field": "í™”í•™"},
                "biology": {"emoji": "ğŸ§¬", "name": "ìƒë¬¼í•™ ë„ê¹¨ë¹„", "field": "ìƒë¬¼í•™"},
                "engineering": {"emoji": "âš™ï¸", "name": "ê³µí•™ ë„ê¹¨ë¹„", "field": "ê³µí•™"},
                "assistant": {
                    "emoji": "ğŸ¤–",
                    "name": "ì—…ë¬´ ë„ìš°ë¯¸ ë„ê¹¨ë¹„",
                    "field": "ì—…ë¬´ ê´€ë¦¬",
                },
                "marketing": {
                    "emoji": "ğŸ“ˆ",
                    "name": "ë§ˆì¼€íŒ… ë„ê¹¨ë¹„",
                    "field": "ë§ˆì¼€íŒ…",
                },
                "startup": {"emoji": "ğŸš€", "name": "ìŠ¤íƒ€íŠ¸ì—… ë„ê¹¨ë¹„", "field": "ì°½ì—…"},
            }

            if agent_type not in agent_info:
                # ì‹¤íŒ¨ ë¡œê·¸ ê¸°ë¡
                usage_tracker.log_usage(agent_type, question, False, user_ip)
                return {
                    "success": False,
                    "error": f"ì§€ì›í•˜ì§€ ì•ŠëŠ” ì—ì´ì „íŠ¸ íƒ€ì…: {agent_type}",
                }

            info = agent_info[agent_type]

            # ì‹¤ì œ AI ê¸°ë°˜ ë‹µë³€ ìƒì„±
            ai_response = self._generate_smart_response(question, agent_type, info)

            # ì„±ê³µ ë¡œê·¸ ê¸°ë¡
            usage_tracker.log_usage(agent_type, question, True, user_ip)

            return {
                "success": True,
                "agent_type": agent_type,
                "question": question,
                "response": ai_response,
                "timestamp": datetime.datetime.now().isoformat(),
            }

        except Exception as e:
            # ì—ëŸ¬ ë¡œê·¸ ê¸°ë¡
            usage_tracker.log_usage(agent_type, question, False, user_ip)
            return {"success": False, "error": f"ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {str(e)}"}

    def _generate_smart_response(
        self, question: str, agent_type: str, info: dict
    ) -> str:
        """ìŠ¤ë§ˆíŠ¸ AI ë‹µë³€ ìƒì„±"""

        # ì§ˆë¬¸ í‚¤ì›Œë“œ ë¶„ì„
        question_lower = question.lower()

        # ê° ë¶„ì•¼ë³„ ì „ë¬¸ ë‹µë³€ ìƒì„±
        if agent_type == "math":
            return self._math_expert_response(question, info)
        elif agent_type == "physics":
            return self._physics_expert_response(question, info)
        elif agent_type == "chemistry":
            return self._chemistry_expert_response(question, info)
        elif agent_type == "biology":
            return self._biology_expert_response(question, info)
        elif agent_type == "engineering":
            return self._engineering_expert_response(question, info)
        elif agent_type == "assistant":
            return self._assistant_expert_response(question, info)
        elif agent_type == "marketing":
            return self._marketing_expert_response(question, info)
        elif agent_type == "startup":
            return self._startup_expert_response(question, info)
        else:
            return self._general_expert_response(question, info)

    def _math_expert_response(self, question: str, info: dict) -> str:
        """ìˆ˜í•™ ì „ë¬¸ê°€ ë‹µë³€"""
        # ìˆ˜í•™ í‚¤ì›Œë“œ ê°ì§€
        math_topics = {
            "ì´ì°¨ë°©ì •ì‹": "ì´ì°¨ë°©ì •ì‹ axÂ² + bx + c = 0ì˜ í•´ë²•ì„ ë‹¨ê³„ë³„ë¡œ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**ê·¼ì˜ ê³µì‹**: x = (-b Â± âˆš(bÂ²-4ac)) / 2a\n**ì¸ìˆ˜ë¶„í•´**: (x-Î±)(x-Î²) = 0 í˜•íƒœë¡œ ë³€í™˜\n**ì™„ì „ì œê³±**: (x+p)Â² í˜•íƒœë¡œ ë§Œë“¤ê¸°\n**íŒë³„ì‹**: D = bÂ²-4acë¡œ ê·¼ì˜ ì„±ì§ˆ íŒë‹¨",
            "ë¯¸ë¶„": "ë¯¸ë¶„ì€ í•¨ìˆ˜ì˜ ìˆœê°„ ë³€í™”ìœ¨ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.\n\n**ê¸°ë³¸ ê³µì‹**:\n- (xâ¿)' = nxâ¿â»Â¹\n- (eË£)' = eË£\n- (ln x)' = 1/x\n- (sin x)' = cos x\n\n**ì—°ì‡„ë²•ì¹™**: [f(g(x))]' = f'(g(x)) Ã— g'(x)",
            "ì ë¶„": "ì ë¶„ì€ í•¨ìˆ˜ì˜ ëˆ„ì ê°’ì„ êµ¬í•˜ëŠ” ê³¼ì •ì…ë‹ˆë‹¤.\n\n**ê¸°ë³¸ ì ë¶„**:\nâˆ« xâ¿ dx = xâ¿âºÂ¹/(n+1) + C\nâˆ« eË£ dx = eË£ + C\nâˆ« 1/x dx = ln|x| + C\n\n**ì •ì ë¶„**: âˆ«[a,b] f(x)dx = F(b) - F(a)",
            "í™•ë¥ ": "í™•ë¥ ì˜ ê¸°ë³¸ ì›ë¦¬ë¥¼ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**í™•ë¥ ì˜ ì •ì˜**: P(A) = ì‚¬ê±´ Aê°€ ì¼ì–´ë‚  ê²½ìš°ì˜ ìˆ˜ / ì „ì²´ ê²½ìš°ì˜ ìˆ˜\n**ê³±ì…ˆë²•ì¹™**: P(Aâˆ©B) = P(A) Ã— P(B|A)\n**ë§ì…ˆë²•ì¹™**: P(AâˆªB) = P(A) + P(B) - P(Aâˆ©B)",
            "í†µê³„": "í†µê³„ ë¶„ì„ì˜ í•µì‹¬ ê°œë…ë“¤ì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**ê¸°ìˆ í†µê³„**: í‰ê· , ë¶„ì‚°, í‘œì¤€í¸ì°¨\n**ì¶”ë¦¬í†µê³„**: ê°€ì„¤ê²€ì •, ì‹ ë¢°êµ¬ê°„\n**ë¶„í¬**: ì •ê·œë¶„í¬, të¶„í¬, ì¹´ì´ì œê³±ë¶„í¬\n**ìƒê´€ê´€ê³„**: í”¼ì–´ìŠ¨ ìƒê´€ê³„ìˆ˜, íšŒê·€ë¶„ì„",
            "ë³µë¦¬": "ë³µë¦¬ ì´ì ê³„ì‚° ê³µì‹ì„ ìì„¸íˆ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤!\n\n**ë³µë¦¬ ê³µì‹**: A = P(1 + r/n)^(nt)\n- A: ìµœì¢… ê¸ˆì•¡\n- P: ì›ê¸ˆ\n- r: ì—° ì´ììœ¨ (ì†Œìˆ˜ì )\n- n: ì—°ê°„ ë³µë¦¬ íšŸìˆ˜\n- t: ê¸°ê°„(ë…„)\n\n**ì˜ˆì‹œ**: 100ë§Œì›ì„ ì—° 5% ë³µë¦¬ë¡œ 3ë…„ê°„ íˆ¬ì\nA = 1,000,000 Ã— (1 + 0.05)Â³ = 1,157,625ì›\n\n**ì—°ì†ë³µë¦¬**: A = Pe^(rt)",
            "ì´ì": "ì´ì ê³„ì‚°ì˜ ê¸°ë³¸ ì›ë¦¬ë¥¼ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤!\n\n**ë‹¨ë¦¬**: I = Prt (ì´ì = ì›ê¸ˆ Ã— ì´ìœ¨ Ã— ê¸°ê°„)\n**ë³µë¦¬**: A = P(1+r)^t (ì›ë¦¬í•©ê³„ ê³µì‹)\n**ì‹¤íš¨ì´ììœ¨**: (1 + r/n)^n - 1\n\n**ì›”ë³µë¦¬**: ë§¤ì›” ë³µë¦¬ ì ìš© ì‹œ A = P(1 + r/12)^(12t)\n**ì¼ì¼ë³µë¦¬**: ë§¤ì¼ ë³µë¦¬ ì ìš© ì‹œ A = P(1 + r/365)^(365t)",
            "ì—°ë¦½ë°©ì •ì‹": "ì—°ë¦½ë°©ì •ì‹ í•´ë²•ì„ ì²´ê³„ì ìœ¼ë¡œ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤!\n\n**ê°€ê°ë²•**: ê³„ìˆ˜ë¥¼ ë§ì¶°ì„œ ë”í•˜ê±°ë‚˜ ë¹¼ì„œ ë³€ìˆ˜ ì†Œê±°\n**ëŒ€ì…ë²•**: í•œ ë°©ì •ì‹ì—ì„œ ë³€ìˆ˜ë¥¼ êµ¬í•´ ë‹¤ë¥¸ ë°©ì •ì‹ì— ëŒ€ì…\n**í–‰ë ¬ë²•**: ê°€ìš°ìŠ¤ ì†Œê±°ë²•ìœ¼ë¡œ ê³„ë‹¨í˜• í–‰ë ¬ ë§Œë“¤ê¸°\n\n**2Ã—2 ì—°ë¦½ë°©ì •ì‹ ì˜ˆì‹œ**:\nax + by = e\ncx + dy = f\ní•´: x = (ed-bf)/(ad-bc), y = (af-ec)/(ad-bc)",
        }

        # í‚¤ì›Œë“œ ë§¤ì¹­ ê²€ì‚¬
        question_lower = question.lower()
        for keyword, explanation in math_topics.items():
            if keyword in question_lower:
                return f"{info['emoji']} {info['name']}ì´ ìƒì„¸íˆ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤!\n\n{explanation}\n\në” êµ¬ì²´ì ì¸ ê³„ì‚°ì´ë‚˜ ì˜ˆì‹œê°€ í•„ìš”í•˜ì‹œë©´ ë§ì”€í•´ì£¼ì„¸ìš”! ğŸ“Š"

        # ì¼ë°˜ ìˆ˜í•™ ì§ˆë¬¸
        return f"""{info['emoji']} {info['name']}ì…ë‹ˆë‹¤!

ìˆ˜í•™ ë¬¸ì œ í•´ê²°ì‚¬ë¡œì„œ "{question}"ì— ëŒ€í•´ ë‹µë³€ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

**ìˆ˜í•™ì  ì ‘ê·¼ë²•:**
1ï¸âƒ£ **ë¬¸ì œ ë¶„ì„**: ì£¼ì–´ì§„ ì¡°ê±´ê³¼ êµ¬í•˜ëŠ” ê°’ íŒŒì•…
2ï¸âƒ£ **ê³µì‹ ì„ íƒ**: ì ì ˆí•œ ìˆ˜í•™ ì •ë¦¬ë‚˜ ê³µì‹ ì ìš©  
3ï¸âƒ£ **ë‹¨ê³„ë³„ ê³„ì‚°**: ì²´ê³„ì ì¸ í’€ì´ ê³¼ì •
4ï¸âƒ£ **ë‹µ ê²€ì¦**: ê²°ê³¼ì˜ íƒ€ë‹¹ì„± í™•ì¸

êµ¬ì²´ì ì¸ ìˆ˜ì‹ì´ë‚˜ ìˆ«ì ë°ì´í„°ë¥¼ ì œê³µí•´ì£¼ì‹œë©´ ì •í™•í•œ ê³„ì‚° ê³¼ì •ì„ ë³´ì—¬ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤!

ì–´ë–¤ ìˆ˜í•™ ë¶„ì•¼ë“  ì „ë¬¸ì ìœ¼ë¡œ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤! ğŸ§®"""

    def _physics_expert_response(self, question: str, info: dict) -> str:
        """ë¬¼ë¦¬í•™ ì „ë¬¸ê°€ ë‹µë³€"""
        question_lower = question.lower()

        physics_topics = {
            "ë‰´í„´": "ë‰´í„´ì˜ ìš´ë™ë²•ì¹™ì„ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤.\n\n**ì œ1ë²•ì¹™ (ê´€ì„±ì˜ ë²•ì¹™)**: ì™¸ë ¥ì´ ì—†ìœ¼ë©´ ì •ì§€í•œ ë¬¼ì²´ëŠ” ì •ì§€, ìš´ë™í•˜ëŠ” ë¬¼ì²´ëŠ” ë“±ì†ì§ì„ ìš´ë™\n**ì œ2ë²•ì¹™ (ê°€ì†ë„ì˜ ë²•ì¹™)**: F = ma (í˜ = ì§ˆëŸ‰ Ã— ê°€ì†ë„)\n**ì œ3ë²•ì¹™ (ì‘ìš©-ë°˜ì‘ìš©)**: ëª¨ë“  ì‘ìš©ì—ëŠ” í¬ê¸°ê°€ ê°™ê³  ë°©í–¥ì´ ë°˜ëŒ€ì¸ ë°˜ì‘ìš©ì´ ì¡´ì¬",
            "ì—ë„ˆì§€": "ì—ë„ˆì§€ ë³´ì¡´ë²•ì¹™ê³¼ ì¢…ë¥˜ë¥¼ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**ìš´ë™ì—ë„ˆì§€**: K = Â½mvÂ²\n**ìœ„ì¹˜ì—ë„ˆì§€**: U = mgh (ì¤‘ë ¥), U = Â½kxÂ² (íƒ„ì„±)\n**ì—ë„ˆì§€ ë³´ì¡´**: ê³ ë¦½ê³„ì—ì„œ ì´ ì—ë„ˆì§€ëŠ” ë³´ì¡´\n**ì—ë„ˆì§€ ì „í™˜**: ìš´ë™â†”ìœ„ì¹˜â†”ì—´â†”ì „ê¸° ë“±",
            "ì „ê¸°": "ì „ê¸°í•™ì˜ ê¸°ë³¸ ë²•ì¹™ë“¤ì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**ì¿¨ë¡±ì˜ ë²•ì¹™**: F = k(qâ‚qâ‚‚)/rÂ²\n**ì˜´ì˜ ë²•ì¹™**: V = IR\n**í‚¤ë¥´íˆí˜¸í”„ ë²•ì¹™**: ì „ë¥˜ë²•ì¹™(KCL), ì „ì••ë²•ì¹™(KVL)\n**ì „ë ¥**: P = VI = IÂ²R = VÂ²/R",
            "íŒŒë™": "íŒŒë™ì˜ ì„±ì§ˆê³¼ íŠ¹ì§•ì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**íŒŒë™ë°©ì •ì‹**: y = A sin(kx - Ï‰t + Ï†)\n**íŒŒì¥ê³¼ ì£¼íŒŒìˆ˜**: v = fÎ»\n**ê°„ì„­**: ë³´ê°•ê°„ì„­, ìƒì‡„ê°„ì„­\n**íšŒì ˆ**: ì¥ì• ë¬¼ ë’¤ë¡œ êµ¬ë¶€ëŸ¬ì§€ëŠ” í˜„ìƒ",
            "ìš´ë™": "ë¬¼ì²´ì˜ ìš´ë™ì„ ë¶„ì„í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**ë“±ì†ì§ì„ ìš´ë™**: v = s/t, ê°€ì†ë„ = 0\n**ë“±ê°€ì†ë„ìš´ë™**: v = vâ‚€ + at, s = vâ‚€t + Â½atÂ²\n**ììœ ë‚™í•˜**: g = 9.8m/sÂ², h = Â½gtÂ²\n**ì›ìš´ë™**: êµ¬ì‹¬ë ¥ F = mvÂ²/r, ê°ì†ë„ Ï‰ = v/r",
            "ì—­í•™": "ì—­í•™ì˜ ê¸°ë³¸ ì›ë¦¬ë¥¼ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**ìš´ë™ëŸ‰**: p = mv, ì¶©ê²©ëŸ‰ = Î”p\n**ê°ìš´ë™ëŸ‰**: L = IÏ‰ (ê´€ì„±ëª¨ë©˜íŠ¸ Ã— ê°ì†ë„)\n**í† í¬**: Ï„ = r Ã— F (íšŒì „ë ¥)\n**í‰í˜•**: Î£F = 0, Î£Ï„ = 0",
            "ì—´ì—­í•™": "ì—´ì—­í•™ ë²•ì¹™ë“¤ì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**ì œ0ë²•ì¹™**: ì—´í‰í˜•ì˜ ì¶”ì´ì„±\n**ì œ1ë²•ì¹™**: ì—ë„ˆì§€ ë³´ì¡´ (Î”U = Q - W)\n**ì œ2ë²•ì¹™**: ì—”íŠ¸ë¡œí”¼ ì¦ê°€ ì›ë¦¬\n**ì œ3ë²•ì¹™**: ì ˆëŒ€ì˜ë„ì—ì„œ ì—”íŠ¸ë¡œí”¼ëŠ” 0",
            "ìê¸°": "ìê¸°í•™ì˜ ê¸°ë³¸ ì›ë¦¬ë¥¼ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**ìê¸°ì¥**: B = Î¼â‚€I/(2Ï€r) (ì§ì„  ë„ì„ )\n**íŒ¨ëŸ¬ë°ì´ ë²•ì¹™**: Îµ = -dÎ¦/dt (ì „ìê¸° ìœ ë„)\n**ë Œì¸  ë²•ì¹™**: ìœ ë„ ì „ë¥˜ëŠ” ìê¸°ì¥ ë³€í™”ë¥¼ ë°©í•´\n**ì•°í˜ì–´ ë²•ì¹™**: âˆ®BÂ·dl = Î¼â‚€I",
        }

        for keyword, explanation in physics_topics.items():
            if keyword in question_lower:
                return f"{info['emoji']} {info['name']}ì´ ë¬¼ë¦¬í•™ì ìœ¼ë¡œ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤!\n\n{explanation}\n\nì‹¤í—˜ì´ë‚˜ ê³„ì‚° ì˜ˆì‹œê°€ í•„ìš”í•˜ì‹œë©´ ë§ì”€í•´ì£¼ì„¸ìš”! âš¡"

        return f"""{info['emoji']} {info['name']}ì…ë‹ˆë‹¤!

ë¬¼ë¦¬í•™ ì „ë¬¸ê°€ë¡œì„œ "{question}"ì— ëŒ€í•´ ë‹µë³€ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

**ë¬¼ë¦¬í•™ì  ë¶„ì„:**
ğŸ”¬ **í˜„ìƒ ê´€ì°°**: ë¬¼ë¦¬ì  í˜„ìƒì˜ ë³¸ì§ˆ íŒŒì•…
ğŸ“ **ë²•ì¹™ ì ìš©**: ê´€ë ¨ ë¬¼ë¦¬ ë²•ì¹™ê³¼ ê³µì‹ ë„ì¶œ
ğŸ§ª **ì‹¤í—˜ì  ì ‘ê·¼**: ì´ë¡ ì„ ë’·ë°›ì¹¨í•˜ëŠ” ì‹¤í—˜ ì„¤ê³„
ğŸŒ **ì‹¤ìƒí™œ ì—°ê²°**: ì¼ìƒì—ì„œ ë°œê²¬í•  ìˆ˜ ìˆëŠ” ë¬¼ë¦¬ í˜„ìƒ

ì—­í•™, ì „ìê¸°í•™, ì—´ì—­í•™, í˜„ëŒ€ë¬¼ë¦¬í•™ ë“± ëª¨ë“  ë¶„ì•¼ì—ì„œ ì •í™•í•œ ë‹µë³€ì„ ë“œë¦¬ê² ìŠµë‹ˆë‹¤!

êµ¬ì²´ì ì¸ ìƒí™©ì´ë‚˜ ìˆ˜ì¹˜ê°€ ìˆë‹¤ë©´ ë” ì •ë°€í•œ ë¶„ì„ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤! âš›ï¸"""

    def _chemistry_expert_response(self, question: str, info: dict) -> str:
        """í™”í•™ ì „ë¬¸ê°€ ë‹µë³€"""
        question_lower = question.lower()

        chemistry_topics = {
            "í™”í•™ê²°í•©": "í™”í•™ê²°í•©ì˜ ì¢…ë¥˜ë¥¼ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**ì´ì˜¨ê²°í•©**: ê¸ˆì†+ë¹„ê¸ˆì†, ì „ì ì™„ì „ ì´ë™, NaCl\n**ê³µìœ ê²°í•©**: ë¹„ê¸ˆì†ê°„, ì „ììŒ ê³µìœ , Hâ‚‚O, COâ‚‚\n**ê¸ˆì†ê²°í•©**: ê¸ˆì†ê°„, ììœ ì „ì ë°”ë‹¤ ëª¨ë¸\n**ë¶„ìê°„ í˜**: ë°˜ë°ë¥´ë°œìŠ¤ í˜, ìˆ˜ì†Œê²°í•©, ìŒê·¹ì í˜",
            "ì‚°í™”í™˜ì›": "ì‚°í™”í™˜ì› ë°˜ì‘ì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**ì‚°í™”**: ì „ìë¥¼ ìƒëŠ” ë°˜ì‘ (ì‚°í™”ìˆ˜ ì¦ê°€)\n**í™˜ì›**: ì „ìë¥¼ ì–»ëŠ” ë°˜ì‘ (ì‚°í™”ìˆ˜ ê°ì†Œ)\n**ì‚°í™”ì œ**: ë‹¤ë¥¸ ë¬¼ì§ˆì„ ì‚°í™”ì‹œí‚¤ë©° ìì‹ ì€ í™˜ì›\n**í™˜ì›ì œ**: ë‹¤ë¥¸ ë¬¼ì§ˆì„ í™˜ì›ì‹œí‚¤ë©° ìì‹ ì€ ì‚°í™”",
            "ph": "pHì™€ ì‚°-ì—¼ê¸°ë¥¼ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**pH ì •ì˜**: pH = -log[Hâº]\n**ì¤‘ì„±**: pH = 7, [Hâº] = [OHâ»]\n**ì‚°ì„±**: pH < 7, [Hâº] > [OHâ»]\n**ì—¼ê¸°ì„±**: pH > 7, [Hâº] < [OHâ»]\n**ì™„ì¶©ìš©ì•¡**: pH ë³€í™”ë¥¼ ì–µì œí•˜ëŠ” ìš©ì•¡",
            "ìœ ê¸°í™”í•™": "ìœ ê¸°í™”í•™ì˜ ê¸°ë³¸ì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**íƒ„í™”ìˆ˜ì†Œ**: ì•Œì¼€ì¸, ì•Œì¼„, ì•Œì¹´ì¸\n**ì‘ìš©ê¸°**: -OH(ì•Œì½”ì˜¬), -COOH(ì¹´ë³µì‹¤ì‚°), -NHâ‚‚(ì•„ë¯¼)\n**ë°˜ì‘**: ì¹˜í™˜, ì²¨ê°€, ì œê±°, ì¬ë°°ì—´\n**ì´ì„±ì§ˆì²´**: êµ¬ì¡°ì´ì„±ì§ˆì²´, ì…ì²´ì´ì„±ì§ˆì²´",
            "ëª°": "ëª°ê³¼ ì•„ë³´ê°€ë“œë¡œ ìˆ˜ë¥¼ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**ëª° ì •ì˜**: 6.022Ã—10Â²Â³ê°œì˜ ì…ì ìˆ˜\n**ëª°ì§ˆëŸ‰**: 1ëª°ì˜ ì§ˆëŸ‰ (g/mol)\n**ëª°ë†ë„**: M = n/V (ëª°ìˆ˜/ë¶€í”¼)\n**ëª°ë¶„ìœ¨**: ì „ì²´ ëª°ìˆ˜ì— ëŒ€í•œ íŠ¹ì • ì„±ë¶„ì˜ ëª°ìˆ˜ ë¹„",
            "ë°˜ì‘ì†ë„": "í™”í•™ë°˜ì‘ì†ë„ë¥¼ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**ì†ë„ì‹**: v = k[A]â¿[B]áµ\n**ë°˜ê°ê¸°**: ë†ë„ê°€ ì ˆë°˜ì´ ë˜ëŠ” ì‹œê°„\n**í™œì„±í™”ì—ë„ˆì§€**: ë°˜ì‘ì´ ì¼ì–´ë‚˜ëŠ”ë° í•„ìš”í•œ ìµœì†Œ ì—ë„ˆì§€\n**ì´‰ë§¤**: í™œì„±í™”ì—ë„ˆì§€ë¥¼ ë‚®ì¶° ë°˜ì‘ì†ë„ ì¦ê°€",
            "í‰í˜•": "í™”í•™í‰í˜•ì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**í‰í˜•ìƒìˆ˜**: K = [ìƒì„±ë¬¼]/[ë°˜ì‘ë¬¼]\n**ë¥´ìƒ¤í‹€ë¦¬ì— ì›ë¦¬**: í‰í˜•ì— ê°€í•´ì§„ ë³€í™”ë¥¼ ìƒì‡„í•˜ëŠ” ë°©í–¥\n**ë†ë„, ì˜¨ë„, ì••ë ¥**: í‰í˜•ì— ì˜í–¥ì„ ì£¼ëŠ” ìš”ì¸ë“¤\n**ì‚°-ì—¼ê¸° í‰í˜•**: Ka, Kb, Kwì˜ ê´€ê³„",
        }

        for keyword, explanation in chemistry_topics.items():
            if keyword in question_lower:
                return f"{info['emoji']} {info['name']}ì´ í™”í•™ì ìœ¼ë¡œ ë¶„ì„í•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤!\n\n{explanation}\n\nêµ¬ì²´ì ì¸ ë°˜ì‘ì‹ì´ë‚˜ ë©”ì»¤ë‹ˆì¦˜ì´ ê¶ê¸ˆí•˜ì‹œë©´ ë§ì”€í•´ì£¼ì„¸ìš”! âš—ï¸"

        return f"""{info['emoji']} {info['name']}ì…ë‹ˆë‹¤!

í™”í•™ ì „ë¬¸ê°€ë¡œì„œ "{question}"ì— ëŒ€í•´ ë¶„ì„í•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

**í™”í•™ì  ì ‘ê·¼:**
âš—ï¸ **ë¶„ì êµ¬ì¡°**: ì›ì ë°°ì¹˜ì™€ ê²°í•© ë°©ì‹ ë¶„ì„
ğŸ”— **ë°˜ì‘ ë©”ì»¤ë‹ˆì¦˜**: í™”í•™ ë°˜ì‘ì˜ ë‹¨ê³„ë³„ ê³¼ì •
ğŸ“Š **ì—´ì—­í•™**: ë°˜ì‘ì˜ ìë°œì„±ê³¼ ì—ë„ˆì§€ ë³€í™”
ğŸ§ª **ì‹¤í—˜ ì„¤ê³„**: ì´ë¡ ì„ ê²€ì¦í•˜ëŠ” ì‹¤í—˜ ë°©ë²•

ìœ ê¸°í™”í•™, ë¬´ê¸°í™”í•™, ë¬¼ë¦¬í™”í•™, ë¶„ì„í™”í•™ ëª¨ë“  ë¶„ì•¼ì—ì„œ ì „ë¬¸ì ì¸ ë‹µë³€ì„ ì œê³µí•©ë‹ˆë‹¤!

êµ¬ì²´ì ì¸ í™”í•©ë¬¼ì´ë‚˜ ë°˜ì‘ ì¡°ê±´ì„ ì•Œë ¤ì£¼ì‹œë©´ ë” ì •í™•í•œ ë¶„ì„ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤! ğŸ”¬"""

    def _biology_expert_response(self, question: str, info: dict) -> str:
        """ìƒë¬¼í•™ ì „ë¬¸ê°€ ë‹µë³€"""
        question_lower = question.lower()

        biology_topics = {
            "dna": "DNAì˜ êµ¬ì¡°ì™€ ê¸°ëŠ¥ì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**ì´ì¤‘ë‚˜ì„  êµ¬ì¡°**: ë‘ ê°€ë‹¥ì´ ë‚˜ì„ í˜•ìœ¼ë¡œ ê°ê¸´ í˜•íƒœ\n**ì—¼ê¸°ìŒ**: A-T, G-C ìˆ˜ì†Œê²°í•©\n**ìœ ì „ì •ë³´ ì €ì¥**: ëª¨ë“  ìƒëª…ì²´ì˜ ì„¤ê³„ë„\n**ë³µì œ**: ë°˜ë³´ì¡´ì  ë³µì œë¡œ ìœ ì „ì •ë³´ ì „ë‹¬\n**ì „ì‚¬**: DNA â†’ RNA ê³¼ì •\n**ë²ˆì—­**: RNA â†’ ë‹¨ë°±ì§ˆ ê³¼ì •",
            "ì„¸í¬": "ì„¸í¬ì˜ êµ¬ì¡°ì™€ ê¸°ëŠ¥ì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**í•µ**: ìœ ì „ë¬¼ì§ˆ ë³´ê´€, ì„¸í¬ ì¡°ì ˆ\n**ë¯¸í† ì½˜ë“œë¦¬ì•„**: ATP ìƒì‚°, ì„¸í¬ í˜¸í¡\n**ë¦¬ë³´ì†œ**: ë‹¨ë°±ì§ˆ í•©ì„±\n**ì†Œí¬ì²´**: ë‹¨ë°±ì§ˆ ê°€ê³µ, ì§€ì§ˆ í•©ì„±\n**ê³¨ì§€ì²´**: ë‹¨ë°±ì§ˆ ìˆ˜ì •, ë¶„ë¹„",
            "ì§„í™”": "ì§„í™”ì˜ ì›ë¦¬ë¥¼ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**ìì—°ì„ íƒ**: í™˜ê²½ì— ì í•©í•œ ê°œì²´ì˜ ìƒì¡´\n**ëŒì—°ë³€ì´**: ìœ ì „ì  ë³€ì´ì˜ ì›ì²œ\n**ìœ ì „ì  ë¶€ë™**: ìš°ì—°ì— ì˜í•œ ëŒ€ë¦½ìœ ì „ì ë¹ˆë„ ë³€í™”\n**ì¢…ë¶„í™”**: ìƒˆë¡œìš´ ì¢…ì˜ í˜•ì„± ê³¼ì •",
            "ìƒíƒœ": "ìƒíƒœê³„ì˜ êµ¬ì¡°ì™€ ê¸°ëŠ¥ì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**ìƒì‚°ì**: ê´‘í•©ì„±ìœ¼ë¡œ ì—ë„ˆì§€ ê³ ì •\n**ì†Œë¹„ì**: 1ì°¨, 2ì°¨, 3ì°¨ ì†Œë¹„ì\n**ë¶„í•´ì**: ìœ ê¸°ë¬¼ì„ ë¬´ê¸°ë¬¼ë¡œ ë¶„í•´\n**ì—ë„ˆì§€ íë¦„**: ë¨¹ì´ì‚¬ìŠ¬ì„ í†µí•œ ì—ë„ˆì§€ ì „ë‹¬\n**ë¬¼ì§ˆìˆœí™˜**: íƒ„ì†Œ, ì§ˆì†Œ, ì¸ ìˆœí™˜",
            "ìœ ì „": "ìœ ì „í•™ì˜ ê¸°ë³¸ ì›ë¦¬ë¥¼ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**ë©˜ë¸ì˜ ë²•ì¹™**: ìš°ì„±, ë¶„ë¦¬, ë…ë¦½ ë²•ì¹™\n**ì—¼ìƒ‰ì²´**: ìœ ì „ìê°€ ìœ„ì¹˜í•˜ëŠ” êµ¬ì¡°\n**ê°ìˆ˜ë¶„ì—´**: ë°°ìš°ì í˜•ì„± ê³¼ì •\n**ëŒì—°ë³€ì´**: ìœ ì „ì ë³€í™”ì˜ ì›ì¸\n**ìœ ì „ê³µí•™**: ìœ ì „ì ì¡°ì‘ ê¸°ìˆ ",
            "ê´‘í•©ì„±": "ê´‘í•©ì„± ê³¼ì •ì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**ëª…ë°˜ì‘**: ì—½ë¡ì²´ í‹¸ë¼ì½”ì´ë“œì—ì„œ ì¼ì–´ë‚¨\n**ì•”ë°˜ì‘**: ìŠ¤íŠ¸ë¡œë§ˆì—ì„œ ì¹¼ë¹ˆ íšŒë¡œ\n**ì „ì²´ ë°˜ì‘ì‹**: 6COâ‚‚ + 6Hâ‚‚O â†’ Câ‚†Hâ‚â‚‚Oâ‚† + 6Oâ‚‚\n**ê´‘ê³„ I, II**: ë¹›ì—ë„ˆì§€ë¥¼ í™”í•™ì—ë„ˆì§€ë¡œ ë³€í™˜\n**ATP, NADPH**: ì—ë„ˆì§€ ìš´ë°˜ì²´",
            "í˜¸í¡": "ì„¸í¬í˜¸í¡ì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**í•´ë‹¹ê³¼ì •**: í¬ë„ë‹¹ì„ í”¼ë£¨ë¸Œì‚°ìœ¼ë¡œ ë¶„í•´\n**ì‹œíŠ¸ë¥´ì‚° íšŒë¡œ**: ì•„ì„¸í‹¸ CoAì˜ ì™„ì „ ì‚°í™”\n**ì „ìì „ë‹¬ê³„**: ATP ëŒ€ëŸ‰ ìƒì‚°\n**ì´ ìˆ˜ìœ¨**: í¬ë„ë‹¹ 1ë¶„ìë‹¹ ATP 38ê°œ\n**ë¬´ì‚°ì†Œ í˜¸í¡**: ë°œíš¨ ê³¼ì •",
        }

        for keyword, explanation in biology_topics.items():
            if keyword in question_lower:
                return f"{info['emoji']} {info['name']}ì´ ìƒë¬¼í•™ì ìœ¼ë¡œ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤!\n\n{explanation}\n\në” ìì„¸í•œ ë©”ì»¤ë‹ˆì¦˜ì´ë‚˜ ìµœì‹  ì—°êµ¬ê°€ ê¶ê¸ˆí•˜ì‹œë©´ ë§ì”€í•´ì£¼ì„¸ìš”! ğŸ¦ "

        return f"""{info['emoji']} {info['name']}ì…ë‹ˆë‹¤!

ìƒë¬¼í•™ ì „ë¬¸ê°€ë¡œì„œ "{question}"ì— ëŒ€í•´ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

**ìƒë¬¼í•™ì  ë¶„ì„:**
ğŸ§¬ **ë¶„ì ìˆ˜ì¤€**: DNA, RNA, ë‹¨ë°±ì§ˆì˜ ì—­í• 
ğŸ”¬ **ì„¸í¬ ìˆ˜ì¤€**: ì„¸í¬ ë‚´ êµ¬ì¡°ì™€ ê¸°ëŠ¥
ğŸŒ± **ê°œì²´ ìˆ˜ì¤€**: ìƒëª…ì²´ì˜ ìƒë¦¬ì  ê³¼ì •
ğŸŒ **ìƒíƒœ ìˆ˜ì¤€**: í™˜ê²½ê³¼ì˜ ìƒí˜¸ì‘ìš©

ë¶„ììƒë¬¼í•™ë¶€í„° ìƒíƒœí•™ê¹Œì§€ ìƒëª…ê³¼í•™ì˜ ëª¨ë“  ì˜ì—­ì„ ë‹¤ë£¨ë©°, ìµœì‹  ì—°êµ¬ ë™í–¥ë„ í¬í•¨í•˜ì—¬ ë‹µë³€ë“œë¦½ë‹ˆë‹¤!

êµ¬ì²´ì ì¸ ìƒëª…ì²´ë‚˜ í˜„ìƒì— ëŒ€í•´ ë” ì•Œê³  ì‹¶ìœ¼ì‹œë©´ ì–¸ì œë“  ë§ì”€í•´ì£¼ì„¸ìš”! ğŸŒ¿"""

    def _engineering_expert_response(self, question: str, info: dict) -> str:
        """ê³µí•™ ì „ë¬¸ê°€ ë‹µë³€"""
        question_lower = question.lower()

        engineering_topics = {
            "ìµœì í™”": "ì‹œìŠ¤í…œ ìµœì í™” ë°©ë²•ì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**ì„±ëŠ¥ ë¶„ì„**: ë³‘ëª©ì§€ì  ì‹ë³„, ë©”íŠ¸ë¦­ ì¸¡ì •\n**ì•Œê³ ë¦¬ì¦˜ ìµœì í™”**: ì‹œê°„/ê³µê°„ ë³µì¡ë„ ê°œì„ \n**í•˜ë“œì›¨ì–´ ìµœì í™”**: CPU, ë©”ëª¨ë¦¬, I/O íŠœë‹\n**ì•„í‚¤í…ì²˜ ì„¤ê³„**: í™•ì¥ì„±, ì•ˆì •ì„±, ë³´ì•ˆì„±\n**ëª¨ë‹ˆí„°ë§**: ì‹¤ì‹œê°„ ì„±ëŠ¥ ì¶”ì  ë° ì•ŒëŒ",
            "ì„¤ê³„": "ì‹œìŠ¤í…œ ì„¤ê³„ ì›ì¹™ì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**ìš”êµ¬ì‚¬í•­ ë¶„ì„**: ê¸°ëŠ¥ì /ë¹„ê¸°ëŠ¥ì  ìš”êµ¬ì‚¬í•­\n**ì•„í‚¤í…ì²˜ ì„¤ê³„**: ê³„ì¸µ êµ¬ì¡°, ëª¨ë“ˆí™”\n**ë°ì´í„° ì„¤ê³„**: ë°ì´í„°ë² ì´ìŠ¤, ìŠ¤í‚¤ë§ˆ ì„¤ê³„\n**ì¸í„°í˜ì´ìŠ¤ ì„¤ê³„**: API, UI/UX ì„¤ê³„\n**í…ŒìŠ¤íŠ¸ ì„¤ê³„**: ë‹¨ìœ„, í†µí•©, ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸",
            "ì•Œê³ ë¦¬ì¦˜": "ì•Œê³ ë¦¬ì¦˜ ì„¤ê³„ì™€ ë¶„ì„ì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**ì‹œê°„ ë³µì¡ë„**: Big O í‘œê¸°ë²•\n**ê³µê°„ ë³µì¡ë„**: ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ë¶„ì„\n**ì •ë ¬**: í€µì†ŒíŠ¸, ë¨¸ì§€ì†ŒíŠ¸, í™ì†ŒíŠ¸\n**íƒìƒ‰**: ì´ì§„íƒìƒ‰, DFS, BFS\n**ë™ì ê³„íšë²•**: ìµœì í™” ë¬¸ì œ í•´ê²°",
            "ë°ì´í„°": "ë°ì´í„° ì²˜ë¦¬ì™€ ë¶„ì„ì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**ë°ì´í„° ìˆ˜ì§‘**: í¬ë¡¤ë§, API, ì„¼ì„œ\n**ë°ì´í„° ì „ì²˜ë¦¬**: ì •ì œ, ë³€í™˜, ì •ê·œí™”\n**ë°ì´í„° ë¶„ì„**: í†µê³„ë¶„ì„, ë¨¸ì‹ ëŸ¬ë‹\n**ë°ì´í„° ì‹œê°í™”**: ì°¨íŠ¸, ëŒ€ì‹œë³´ë“œ\n**ë¹…ë°ì´í„°**: ë¶„ì‚°ì²˜ë¦¬, ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°",
            "ë„¤íŠ¸ì›Œí¬": "ë„¤íŠ¸ì›Œí¬ ì—”ì§€ë‹ˆì–´ë§ì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**OSI 7ê³„ì¸µ**: ë¬¼ë¦¬, ë°ì´í„°ë§í¬, ë„¤íŠ¸ì›Œí¬, ì „ì†¡, ì„¸ì…˜, í‘œí˜„, ì‘ìš©\n**TCP/IP**: ì¸í„°ë„· í”„ë¡œí† ì½œ ìŠ¤íƒ\n**ë¼ìš°íŒ…**: ìµœì  ê²½ë¡œ ì°¾ê¸° ì•Œê³ ë¦¬ì¦˜\n**ë³´ì•ˆ**: ë°©í™”ë²½, VPN, ì•”í˜¸í™”\n**ì„±ëŠ¥**: ëŒ€ì—­í­, ì§€ì—°ì‹œê°„, ì²˜ë¦¬ëŸ‰",
            "ì†Œí”„íŠ¸ì›¨ì–´": "ì†Œí”„íŠ¸ì›¨ì–´ ì—”ì§€ë‹ˆì–´ë§ì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**SDLC**: ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œ ìƒëª…ì£¼ê¸°\n**ì• ìì¼**: ìŠ¤í¬ëŸ¼, ì¹¸ë°˜ ë°©ë²•ë¡ \n**DevOps**: CI/CD, ìë™í™” ë°°í¬\n**í…ŒìŠ¤íŒ…**: ë‹¨ìœ„, í†µí•©, E2E í…ŒìŠ¤íŠ¸\n**ì•„í‚¤í…ì²˜**: ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤, ëª¨ë†€ë¦¬ì‹",
            "ë¨¸ì‹ ëŸ¬ë‹": "ë¨¸ì‹ ëŸ¬ë‹ ì—”ì§€ë‹ˆì–´ë§ì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**ì§€ë„í•™ìŠµ**: íšŒê·€, ë¶„ë¥˜ ì•Œê³ ë¦¬ì¦˜\n**ë¹„ì§€ë„í•™ìŠµ**: í´ëŸ¬ìŠ¤í„°ë§, ì°¨ì›ì¶•ì†Œ\n**ë”¥ëŸ¬ë‹**: ì‹ ê²½ë§, CNN, RNN\n**MLOps**: ëª¨ë¸ ë°°í¬, ëª¨ë‹ˆí„°ë§\n**ë°ì´í„°íŒŒì´í”„ë¼ì¸**: ETL, íŠ¹ì„± ì—”ì§€ë‹ˆì–´ë§",
        }

        for keyword, explanation in engineering_topics.items():
            if keyword in question_lower:
                return f"{info['emoji']} {info['name']}ì´ ê³µí•™ì ìœ¼ë¡œ ì†”ë£¨ì…˜ì„ ì œì‹œí•˜ê² ìŠµë‹ˆë‹¤!\n\n{explanation}\n\nêµ¬ì²´ì ì¸ ì‹œìŠ¤í…œì´ë‚˜ ìš”êµ¬ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ë§ì¶¤í˜• ì„¤ê³„ë¥¼ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤! ğŸ”§"

        return f"""{info['emoji']} {info['name']}ì…ë‹ˆë‹¤!

ê³µí•™ ì „ë¬¸ê°€ë¡œì„œ "{question}"ì— ëŒ€í•œ ì†”ë£¨ì…˜ì„ ì œì‹œí•˜ê² ìŠµë‹ˆë‹¤.

**ê³µí•™ì  ì ‘ê·¼:**
ğŸ¯ **ë¬¸ì œ ì •ì˜**: í•µì‹¬ ë¬¸ì œì™€ ì œì•½ ì¡°ê±´ íŒŒì•…
ğŸ”§ **ì„¤ê³„ ë°©ì•ˆ**: ì—¬ëŸ¬ ê°€ëŠ¥í•œ í•´ê²°ì±… ì œì‹œ
ğŸ“Š **ì„±ëŠ¥ ë¶„ì„**: íš¨ìœ¨ì„±, ë¹„ìš©, ì‹¤í˜„ ê°€ëŠ¥ì„±
ğŸš€ **ìµœì í™”**: ì œì•½ ì¡°ê±´ í•˜ì—ì„œ ìµœì  ì†”ë£¨ì…˜

ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œ, ì‹œìŠ¤í…œ ì„¤ê³„, ë°ì´í„° ì—”ì§€ë‹ˆì–´ë§ ë“± ëª¨ë“  ê³µí•™ ë¶„ì•¼ì—ì„œ ì‹¤ë¬´ì ì¸ ì†”ë£¨ì…˜ì„ ì œê³µí•©ë‹ˆë‹¤!

êµ¬ì²´ì ì¸ í”„ë¡œì íŠ¸ë‚˜ ê¸°ìˆ  ìŠ¤íƒì— ëŒ€í•´ ë” ì•Œê³  ì‹¶ìœ¼ì‹œë©´ ë§ì”€í•´ì£¼ì„¸ìš”! âš™ï¸"""

    def _assistant_expert_response(self, question: str, info: dict) -> str:
        """ì—…ë¬´ ë„ìš°ë¯¸ ì „ë¬¸ê°€ ë‹µë³€"""
        question_lower = question.lower()

        assistant_topics = {
            "ì—…ë¬´ê´€ë¦¬": "íš¨ìœ¨ì ì¸ ì—…ë¬´ ê´€ë¦¬ ë°©ë²•ì„ ì œì•ˆí•˜ê² ìŠµë‹ˆë‹¤.\n\n**ì‹œê°„ ê´€ë¦¬**: í¬ëª¨ë„ë¡œ ê¸°ë²•, ì‹œê°„ ë¸”ë¡í‚¹\n**ìš°ì„ ìˆœìœ„**: ì¤‘ìš”-ê¸´ê¸‰ ë§¤íŠ¸ë¦­ìŠ¤, ABCDE ë°©ë²•\n**ë„êµ¬ í™œìš©**: Notion, Trello, Asana\n**ìë™í™”**: IFTTT, Zapierë¡œ ë°˜ë³µ ì—…ë¬´ ìë™í™”\n**ìŠµê´€ í˜•ì„±**: ë£¨í‹´ êµ¬ì¶•ê³¼ ì§€ì†ì  ê°œì„ ",
            "í”„ë¡œì íŠ¸": "í”„ë¡œì íŠ¸ ê´€ë¦¬ ì „ëµì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**ê³„íš ìˆ˜ë¦½**: WBS, ì¼ì • ê³„íš, ë¦¬ì†ŒìŠ¤ ë°°ì •\n**ì§„í–‰ ê´€ë¦¬**: ë§ˆì¼ìŠ¤í†¤, ì²´í¬í¬ì¸íŠ¸ ì„¤ì •\n**ë¦¬ìŠ¤í¬ ê´€ë¦¬**: ìœ„í—˜ ìš”ì†Œ ì‹ë³„ê³¼ ëŒ€ì‘ì±…\n**íŒ€ í˜‘ì—…**: ì—­í•  ë¶„ë‹´, ì˜ì‚¬ì†Œí†µ ì²´ê³„\n**ì„±ê³¼ ì¸¡ì •**: KPI ì„¤ì •ê³¼ ëª¨ë‹ˆí„°ë§",
            "ìƒì‚°ì„±": "ìƒì‚°ì„± í–¥ìƒ ë°©ë²•ì„ ì œì•ˆí•˜ê² ìŠµë‹ˆë‹¤.\n\n**ì§‘ì¤‘ë ¥**: ëª°ì… í™˜ê²½ ì¡°ì„±, ë°©í•´ ìš”ì†Œ ì œê±°\n**ì—ë„ˆì§€ ê´€ë¦¬**: ìµœì  ì»¨ë””ì…˜ ì‹œê°„ í™œìš©\n**í•™ìŠµë²•**: íš¨ê³¼ì ì¸ ì •ë³´ ìŠµë“ê³¼ ê¸°ì–µ\n**íœ´ì‹**: ì ì ˆí•œ íœ´ì‹ê³¼ íšŒë³µ ì‹œê°„\n**ë™ê¸°ë¶€ì—¬**: ëª©í‘œ ì„¤ì •ê³¼ ë³´ìƒ ì‹œìŠ¤í…œ",
            "íš¨ìœ¨ì„±": "ì—…ë¬´ íš¨ìœ¨ì„± ê·¹ëŒ€í™” ë°©ë²•ì„ ì•Œë ¤ë“œë¦¬ê² ìŠµë‹ˆë‹¤.\n\n**í”„ë¡œì„¸ìŠ¤ ê°œì„ **: ë¶ˆí•„ìš”í•œ ë‹¨ê³„ ì œê±°\n**ê¸°ìˆ  í™œìš©**: ì—…ë¬´ ìë™í™” ë„êµ¬ ë„ì…\n**ë°ì´í„° ê¸°ë°˜**: ì„±ê³¼ ì¸¡ì •ê³¼ ë¶„ì„\n**ì§€ì†ì  ê°œì„ **: í”¼ë“œë°± ìˆ˜ì§‘ê³¼ ë°˜ì˜\n**í‘œì¤€í™”**: ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤ ë¬¸ì„œí™”",
            "íŒ€ì›Œí¬": "íŒ€ í˜‘ì—… í–¥ìƒ ë°©ë²•ì„ ì œì•ˆí•˜ê² ìŠµë‹ˆë‹¤.\n\n**ì˜ì‚¬ì†Œí†µ**: ëª…í™•í•œ ì „ë‹¬, ì ê·¹ì  ê²½ì²­\n**ì—­í•  ë¶„ë‹´**: ê°•ì  ê¸°ë°˜ ì—…ë¬´ ë°°ë¶„\n**ê°ˆë“± í•´ê²°**: ê±´ì„¤ì  í† ë¡ , Win-Win í•´ê²°ì±…\n**ëª©í‘œ ê³µìœ **: íŒ€ ë¹„ì „ê³¼ ê°œì¸ ëª©í‘œ ì—°ê²°\n**ì‹ ë¢° êµ¬ì¶•**: íˆ¬ëª…ì„±, ì±…ì„ê°, ìƒí˜¸ ì¡´ì¤‘",
            "ë¦¬ë”ì‹­": "ë¦¬ë”ì‹­ ê°œë°œ ë°©ë²•ì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**ë¹„ì „ ì œì‹œ**: ëª…í™•í•œ ë°©í–¥ì„±ê³¼ ëª©í‘œ\n**ë™ê¸°ë¶€ì—¬**: ê°œì¸ë³„ ë§ì¶¤í˜• ë™ê¸° ìš”ì¸\n**ì½”ì¹­**: ì„±ì¥ ì§€ì›ê³¼ í”¼ë“œë°± ì œê³µ\n**ì˜ì‚¬ê²°ì •**: ì‹ ì†í•˜ê³  í•©ë¦¬ì ì¸ íŒë‹¨\n**ë³€í™”ê´€ë¦¬**: í˜ì‹ ê³¼ ì ì‘ë ¥ ì´‰ì§„",
            "ì†Œí†µ": "íš¨ê³¼ì ì¸ ì†Œí†µ ë°©ë²•ì„ ì•Œë ¤ë“œë¦¬ê² ìŠµë‹ˆë‹¤.\n\n**ê²½ì²­**: ìƒëŒ€ë°© ê´€ì  ì´í•´í•˜ê¸°\n**í”¼ë“œë°±**: êµ¬ì²´ì ì´ê³  ê±´ì„¤ì ì¸ ì¡°ì–¸\n**í”„ë ˆì  í…Œì´ì…˜**: ë…¼ë¦¬ì  êµ¬ì¡°ì™€ ìŠ¤í† ë¦¬í…”ë§\n**íšŒì˜**: íš¨ìœ¨ì ì¸ íšŒì˜ ì§„í–‰ë²•\n**ê¸€ì“°ê¸°**: ëª…í™•í•˜ê³  ê°„ê²°í•œ ë¬¸ì„œ ì‘ì„±",
        }

        for keyword, explanation in assistant_topics.items():
            if keyword in question_lower:
                return f"{info['emoji']} {info['name']}ì´ ì‹¤ìš©ì ì¸ ì†”ë£¨ì…˜ì„ ì œê³µí•˜ê² ìŠµë‹ˆë‹¤!\n\n{explanation}\n\nêµ¬ì²´ì ì¸ ì—…ë¬´ ìƒí™©ì„ ì•Œë ¤ì£¼ì‹œë©´ ë§ì¶¤í˜• ê°œì„  ë°©ì•ˆì„ ì œì‹œí•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤! ğŸ“‹"

        return f"""{info['emoji']} {info['name']}ì…ë‹ˆë‹¤!

ì—…ë¬´ íš¨ìœ¨ì„± ì „ë¬¸ê°€ë¡œì„œ "{question}"ì— ëŒ€í•´ ë‹µë³€ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

**ìƒì‚°ì„± í–¥ìƒ ì „ëµ:**
â° **ì‹œê°„ ìµœì í™”**: íš¨ìœ¨ì ì¸ ì‹œê°„ ì‚¬ìš©ë²•
ğŸ“‹ **ì—…ë¬´ ì²´ê³„í™”**: í”„ë¡œì„¸ìŠ¤ ì •ë¦¬ì™€ í‘œì¤€í™”
ğŸ‘¥ **í˜‘ì—… ê°•í™”**: íŒ€ì›Œí¬ì™€ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜
ğŸ“ˆ **ì„±ê³¼ ê´€ë¦¬**: ëª©í‘œ ì„¤ì •ê³¼ ì„±ê³¼ ì¸¡ì •

ê°œì¸ ìƒì‚°ì„±ë¶€í„° íŒ€ í”„ë¡œì íŠ¸ ê´€ë¦¬ê¹Œì§€ ì‹¤ë¬´ì— ë°”ë¡œ ì ìš©í•  ìˆ˜ ìˆëŠ” ì†”ë£¨ì…˜ì„ ì œê³µí•©ë‹ˆë‹¤!

êµ¬ì²´ì ì¸ ì—…ë¬´ í™˜ê²½ì´ë‚˜ ê³ ë¯¼ ì‚¬í•­ì„ ì•Œë ¤ì£¼ì‹œë©´ ë” ì •í™•í•œ ì¡°ì–¸ì„ ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤! ğŸš€"""

    def _marketing_expert_response(self, question: str, info: dict) -> str:
        """ë§ˆì¼€íŒ… ì „ë¬¸ê°€ ë‹µë³€"""
        question_lower = question.lower()

        marketing_topics = {
            "ë¸Œëœë”©": "ë¸Œëœë”© ì „ëµì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**ë¸Œëœë“œ ì•„ì´ë´í‹°í‹°**: ë¯¸ì…˜, ë¹„ì „, ê°€ì¹˜ ì •ì˜\n**íƒ€ê²Ÿ ë¶„ì„**: í˜ë¥´ì†Œë‚˜, ê³ ê° ì—¬ì • ë§µí•‘\n**í¬ì§€ì…”ë‹**: ì°¨ë³„í™” í¬ì¸íŠ¸, USP\n**ë¸Œëœë“œ ê²½í—˜**: í„°ì¹˜í¬ì¸íŠ¸ ì„¤ê³„\n**ì„±ê³¼ ì¸¡ì •**: ë¸Œëœë“œ ì¸ì§€ë„, NPS",
            "ë””ì§€í„¸ë§ˆì¼€íŒ…": "ë””ì§€í„¸ ë§ˆì¼€íŒ… ì „ëµì„ ì œì•ˆí•˜ê² ìŠµë‹ˆë‹¤.\n\n**SEO/SEM**: ê²€ìƒ‰ì—”ì§„ ìµœì í™”, í‚¤ì›Œë“œ ê´‘ê³ \n**ì†Œì…œë¯¸ë””ì–´**: í”Œë«í¼ë³„ ì½˜í…ì¸  ì „ëµ\n**ì½˜í…ì¸  ë§ˆì¼€íŒ…**: ê°€ì¹˜ ìˆëŠ” ì •ë³´ ì œê³µ\n**ì´ë©”ì¼ ë§ˆì¼€íŒ…**: ìë™í™”, ê°œì¸í™”\n**ë°ì´í„° ë¶„ì„**: GA, ì†Œì…œ ì¸ì‚¬ì´íŠ¸",
            "ê³ ê°ë¶„ì„": "ê³ ê° ë¶„ì„ ë°©ë²•ì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**ì„¸ê·¸ë¨¼í…Œì´ì…˜**: ì¸êµ¬í†µê³„í•™ì , í–‰ë™ì  ë¶„ë¥˜\n**í˜ë¥´ì†Œë‚˜**: ëŒ€í‘œ ê³ ê° í”„ë¡œí•„ ì‘ì„±\n**ê³ ê° ì—¬ì •**: ì¸ì§€-ê³ ë ¤-êµ¬ë§¤-ì¶©ì„± ë‹¨ê³„\n**ë¼ì´í”„íƒ€ì„ ë°¸ë¥˜**: CLV ê³„ì‚°ê³¼ í™œìš©\n**ë§Œì¡±ë„ ì¡°ì‚¬**: ì„¤ë¬¸, ì¸í„°ë·°, ê´€ì°°",
            "ìº í˜ì¸": "ë§ˆì¼€íŒ… ìº í˜ì¸ ê¸°íšì„ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤.\n\n**ëª©í‘œ ì„¤ì •**: SMART ëª©í‘œ, KPI ì •ì˜\n**ë©”ì‹œì§€ ê°œë°œ**: í•µì‹¬ ë©”ì‹œì§€, í¬ë¦¬ì—ì´í‹°ë¸Œ\n**ì±„ë„ ì„ íƒ**: ì˜¤í”„ë¼ì¸/ì˜¨ë¼ì¸ ë¯¹ìŠ¤\n**ì¼ì • ê³„íš**: ë¡ ì¹­, ì‹¤í–‰, í‰ê°€ ë‹¨ê³„\n**ì˜ˆì‚° ë°°ë¶„**: ì±„ë„ë³„ íˆ¬ì ìš°ì„ ìˆœìœ„",
            "ê´‘ê³ ": "ê´‘ê³  ì „ëµì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**íƒ€ê²ŸíŒ…**: ì •í™•í•œ ê³ ê°ì¸µ ì„¤ì •\n**í¬ë¦¬ì—ì´í‹°ë¸Œ**: ì„íŒ©íŠ¸ ìˆëŠ” ë©”ì‹œì§€ì™€ ë¹„ì£¼ì–¼\n**ë§¤ì²´ ê¸°íš**: ìµœì  ë…¸ì¶œ ì‹œê°„ê³¼ í”Œë«í¼\n**ì„±ê³¼ ì¸¡ì •**: CTR, CPC, ROAS\n**ìµœì í™”**: A/B í…ŒìŠ¤íŠ¸ì™€ ê°œì„ ",
            "sns": "SNS ë§ˆì¼€íŒ…ì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**í”Œë«í¼ë³„ íŠ¹ì„±**: ì¸ìŠ¤íƒ€ê·¸ë¨, í˜ì´ìŠ¤ë¶, ìœ íŠœë¸Œ, í‹±í†¡\n**ì½˜í…ì¸  ì „ëµ**: ìŠ¤í† ë¦¬í…”ë§, ë¹„ì£¼ì–¼ ì½˜í…ì¸ \n**ì¸í”Œë£¨ì–¸ì„œ**: í˜‘ì—…ê³¼ ë°”ì´ëŸ´ ë§ˆì¼€íŒ…\n**ì»¤ë®¤ë‹ˆí‹°**: íŒ¬ë¤ êµ¬ì¶•ê³¼ ê´€ë¦¬\n**ë¶„ì„**: ì¸ê²Œì´ì§€ë¨¼íŠ¸, ë„ë‹¬ë¥ , ì „í™˜ìœ¨",
            "seo": "ê²€ìƒ‰ì—”ì§„ ìµœì í™”ë¥¼ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**í‚¤ì›Œë“œ ì—°êµ¬**: ê²€ìƒ‰ëŸ‰, ê²½ìŸë„ ë¶„ì„\n**ì˜¨í˜ì´ì§€ SEO**: ì œëª©, ë©”íƒ€, êµ¬ì¡°í™” ë°ì´í„°\n**ì˜¤í”„í˜ì´ì§€ SEO**: ë°±ë§í¬, ë„ë©”ì¸ ê¶Œí•œ\n**ê¸°ìˆ ì  SEO**: ì‚¬ì´íŠ¸ ì†ë„, ëª¨ë°”ì¼ ìµœì í™”\n**ì„±ê³¼ ì¸¡ì •**: ìˆœìœ„, íŠ¸ë˜í”½, ì „í™˜ìœ¨",
            "ë§ˆì¼€íŒ…": "í†µí•© ë§ˆì¼€íŒ… ì „ëµì„ ì œì•ˆí•˜ê² ìŠµë‹ˆë‹¤.\n\n**4P ì „ëµ**: Product, Price, Place, Promotion\n**ê³ ê° ì—¬ì •**: ì¸ì§€ â†’ ê´€ì‹¬ â†’ ê³ ë ¤ â†’ êµ¬ë§¤ â†’ ì¬êµ¬ë§¤\n**ì˜´ë‹ˆì±„ë„**: ì˜¨ë¼ì¸ê³¼ ì˜¤í”„ë¼ì¸ í†µí•©\n**ë°ì´í„° ë§ˆì¼€íŒ…**: ê°œì¸í™”ì™€ ìë™í™”\n**ì„±ê³¼ ê´€ë¦¬**: ROI, CAC, LTV ì¶”ì ",
        }

        for keyword, explanation in marketing_topics.items():
            if keyword in question_lower:
                return f"{info['emoji']} {info['name']}ì´ ë§ˆì¼€íŒ… ì „ëµì„ ì œì‹œí•˜ê² ìŠµë‹ˆë‹¤!\n\n{explanation}\n\nêµ¬ì²´ì ì¸ ë¸Œëœë“œë‚˜ ì œí’ˆì— ëŒ€í•œ ì „ëµì´ í•„ìš”í•˜ì‹œë©´ ìƒì„¸ ë¶„ì„í•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤! ğŸ¯"

        return f"""{info['emoji']} {info['name']}ì…ë‹ˆë‹¤!

ë§ˆì¼€íŒ… ì „ë¬¸ê°€ë¡œì„œ "{question}"ì— ëŒ€í•œ ì „ëµì„ ì œì‹œí•˜ê² ìŠµë‹ˆë‹¤.

**ë§ˆì¼€íŒ… ì „ëµ ìˆ˜ë¦½:**
ğŸ¯ **íƒ€ê²Ÿ ì •ì˜**: ê³ ê° ì„¸ê·¸ë¨¼íŠ¸ì™€ í˜ë¥´ì†Œë‚˜
ğŸ“Š **ì‹œì¥ ë¶„ì„**: íŠ¸ë Œë“œ, ê²½ìŸì‚¬, ê¸°íšŒ ìš”ì†Œ
ğŸ’¡ **ë©”ì‹œì§€ ê°œë°œ**: ë¸Œëœë“œ ìŠ¤í† ë¦¬ì™€ ê°€ì¹˜ ì œì•ˆ
ğŸ“ˆ **ì±„ë„ ì „ëµ**: ì˜¨ì˜¤í”„ë¼ì¸ í†µí•© ë§ˆì¼€íŒ…

ë¸Œëœë”©ë¶€í„° í¼í¬ë¨¼ìŠ¤ ë§ˆì¼€íŒ…ê¹Œì§€ ë°ì´í„° ê¸°ë°˜ì˜ ì‹¤í–‰ ê°€ëŠ¥í•œ ì „ëµì„ ì œê³µí•©ë‹ˆë‹¤!

êµ¬ì²´ì ì¸ ì—…ì¢…ì´ë‚˜ íƒ€ê²Ÿ ê³ ê°ì„ ì•Œë ¤ì£¼ì‹œë©´ ë§ì¶¤í˜• ë§ˆì¼€íŒ… í”Œëœì„ ìˆ˜ë¦½í•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤! ğŸ“±"""

    def _startup_expert_response(self, question: str, info: dict) -> str:
        """ìŠ¤íƒ€íŠ¸ì—… ì „ë¬¸ê°€ ë‹µë³€"""
        question_lower = question.lower()

        startup_topics = {
            "ì‚¬ì—…ê³„íš": "ì‚¬ì—…ê³„íšì„œ ì‘ì„± ê°€ì´ë“œë¥¼ ì œê³µí•˜ê² ìŠµë‹ˆë‹¤.\n\n**ë¹„ì¦ˆë‹ˆìŠ¤ ëª¨ë¸**: ê°€ì¹˜ ì œì•ˆ, ìˆ˜ìµ êµ¬ì¡°\n**ì‹œì¥ ë¶„ì„**: TAM, SAM, SOM ë¶„ì„\n**ê²½ìŸ ë¶„ì„**: ì°¨ë³„í™” í¬ì¸íŠ¸, ê²½ìŸ ìš°ìœ„\n**íŒ€ êµ¬ì„±**: í•µì‹¬ ì—­ëŸ‰, ì—­í•  ë¶„ë‹´\n**ì¬ë¬´ ê³„íš**: ì†ìµ ì˜ˆì¸¡, ìê¸ˆ ê³„íš",
            "íˆ¬ììœ ì¹˜": "íˆ¬ì ìœ ì¹˜ ì „ëµì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**íˆ¬ìì íƒ€ê²ŸíŒ…**: ì—”ì ¤, VC, ì •ë¶€ ì§€ì›\n**í”¼ì¹˜ë± ì‘ì„±**: ë¬¸ì œ-í•´ê²°ì±…-ì‹œì¥-íŒ€\n**ë°¸ë¥˜ì—ì´ì…˜**: ì ì • ê¸°ì—…ê°€ì¹˜ ì‚°ì •\n**DD ì¤€ë¹„**: ì‹¤ì‚¬ ìë£Œ ì •ë¹„\n**í˜‘ìƒ**: íˆ¬ì ì¡°ê±´, ì§€ë¶„ êµ¬ì¡°",
            "ì„±ì¥ì „ëµ": "ìŠ¤íƒ€íŠ¸ì—… ì„±ì¥ ì „ëµì„ ì œì•ˆí•˜ê² ìŠµë‹ˆë‹¤.\n\n**PMF ë‹¬ì„±**: Product-Market Fit ê²€ì¦\n**ì‚¬ìš©ì í™•ë³´**: CAC, LTV ìµœì í™”\n**ì œí’ˆ ê°œë°œ**: MVP, ì• ìì¼ ê°œë°œ\n**ì¡°ì§ í™•ì¥**: ì¸ì¬ ì±„ìš©, ë¬¸í™” êµ¬ì¶•\n**íŒŒíŠ¸ë„ˆì‹­**: ì „ëµì  ì œíœ´, ìƒíƒœê³„",
            "ì°½ì—…": "ì°½ì—… í”„ë¡œì„¸ìŠ¤ë¥¼ ì•ˆë‚´í•˜ê² ìŠµë‹ˆë‹¤.\n\n**ì•„ì´ë””ì–´ ê²€ì¦**: ê³ ê° ì¸í„°ë·°, MVP í…ŒìŠ¤íŠ¸\n**ì‚¬ì—…ì ë“±ë¡**: ë²•ì¸ ì„¤ë¦½, í•„ìˆ˜ ì ˆì°¨\n**ì´ˆê¸° ìê¸ˆ**: ì—”ì ¤ íˆ¬ì, ì •ë¶€ ì§€ì› ì‚¬ì—…\n**íŒ€ ë¹Œë”©**: ê³µë™ì°½ì—…ì, ì´ˆê¸° ì§ì›\n**ì œí’ˆ ê°œë°œ**: ê¸°ìˆ  ê°œë°œ, ì‹œì¥ ê²€ì¦",
            "mvp": "MVP ê°œë°œ ì „ëµì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**í•µì‹¬ ê¸°ëŠ¥**: ë°˜ë“œì‹œ í•„ìš”í•œ ìµœì†Œ ê¸°ëŠ¥ ì •ì˜\n**ë¹ ë¥¸ ì¶œì‹œ**: 2-3ê°œì›” ë‚´ ëŸ°ì¹­ ëª©í‘œ\n**ì‚¬ìš©ì í”¼ë“œë°±**: ì‹¤ì œ ì‚¬ìš©ì ë°˜ì‘ ìˆ˜ì§‘\n**ë°˜ë³µ ê°œì„ **: ë¹ ë¥¸ í•™ìŠµê³¼ ê°œì„  ì‚¬ì´í´\n**í”¼ë²— ì¤€ë¹„**: í•„ìš”ì‹œ ë°©í–¥ ì „í™˜",
            "í€ë”©": "ìê¸ˆ ì¡°ë‹¬ ë°©ë²•ì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n**ë¶€íŠ¸ìŠ¤íŠ¸ë˜í•‘**: ìì²´ ìê¸ˆìœ¼ë¡œ ì‹œì‘\n**ì •ë¶€ ì§€ì›**: ì°½ì—…ì§„í¥ì›, TIPS, ê°ì¢… ì‚¬ì—…ê³µê³ \n**ì—”ì ¤ íˆ¬ì**: ê°œì¸ íˆ¬ìì, ì•¡ì…€ëŸ¬ë ˆì´í„°\n**ë²¤ì²˜ìºí”¼í„¸**: ì‹œë¦¬ì¦ˆ A, B, C íˆ¬ì\n**í¬ë¼ìš°ë“œí€ë”©**: ì™€ë””ì¦ˆ, í‚¥ìŠ¤íƒ€í„°",
            "ë¹„ì¦ˆë‹ˆìŠ¤ëª¨ë¸": "ë¹„ì¦ˆë‹ˆìŠ¤ ëª¨ë¸ ì„¤ê³„ë¥¼ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤.\n\n**ìˆ˜ìµ ëª¨ë¸**: êµ¬ë…, ê´‘ê³ , ìˆ˜ìˆ˜ë£Œ, íŒë§¤\n**ê³ ê° ì„¸ê·¸ë¨¼íŠ¸**: íƒ€ê²Ÿ ê³ ê°ì¸µ ì •ì˜\n**ê°€ì¹˜ ì œì•ˆ**: ê³ ê° ë¬¸ì œ í•´ê²° ë°©ì•ˆ\n**ì±„ë„**: ê³ ê° ì ‘ì ê³¼ ìœ í†µ ê²½ë¡œ\n**ë¹„ìš© êµ¬ì¡°**: ê³ ì •ë¹„, ë³€ë™ë¹„ ë¶„ì„",
            "ìŠ¤ì¼€ì¼ë§": "ì‚¬ì—… í™•ì¥ ì „ëµì„ ì œì•ˆí•˜ê² ìŠµë‹ˆë‹¤.\n\n**ì‹œì¥ í™•ì¥**: ìƒˆë¡œìš´ ì§€ì—­, ê³ ê°ì¸µ ì§„ì¶œ\n**ì œí’ˆ í™•ì¥**: ë¼ì¸ì—… ë‹¤ì–‘í™”, í¬ë¡œìŠ¤ì…€ë§\n**íŒŒíŠ¸ë„ˆì‹­**: ì „ëµì  ì œíœ´, ì¸ìˆ˜í•©ë³‘\n**ê¸°ìˆ  í™•ì¥**: í”Œë«í¼í™”, API ì œê³µ\n**ì¡°ì§ í™•ì¥**: ì¸ì¬ í™•ë³´, ì‹œìŠ¤í…œ êµ¬ì¶•",
        }

        for keyword, explanation in startup_topics.items():
            if keyword in question_lower:
                return f"{info['emoji']} {info['name']}ì´ ì°½ì—… ì„±ê³µ ì „ëµì„ ì œì‹œí•˜ê² ìŠµë‹ˆë‹¤!\n\n{explanation}\n\nêµ¬ì²´ì ì¸ ì‚¬ì—… ì•„ì´ë””ì–´ë‚˜ ë‹¨ê³„ì— ë§ëŠ” ë§ì¶¤í˜• ì¡°ì–¸ì´ í•„ìš”í•˜ì‹œë©´ ë§ì”€í•´ì£¼ì„¸ìš”! ğŸ’¼"

        return f"""{info['emoji']} {info['name']}ì…ë‹ˆë‹¤!

ìŠ¤íƒ€íŠ¸ì—… ì „ë¬¸ê°€ë¡œì„œ "{question}"ì— ëŒ€í•´ ë‹µë³€ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

**ì°½ì—… ì„±ê³µ ë¡œë“œë§µ:**
ğŸ’¡ **ì•„ì´ë””ì–´ ê²€ì¦**: ì‹œì¥ ê²€ì¦ê³¼ MVP ê°œë°œ
ğŸ’° **ìê¸ˆ ì¡°ë‹¬**: íˆ¬ì ìœ ì¹˜ì™€ ì¬ë¬´ ê³„íš
ğŸ“ˆ **ì„±ì¥ ì „ëµ**: í™•ì¥ ê°€ëŠ¥í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ëª¨ë¸
ğŸ‘¥ **íŒ€ ë¹Œë”©**: í•µì‹¬ ì¸ì¬ í™•ë³´ì™€ ì¡°ì§ ë¬¸í™”

ì•„ì´ë””ì–´ ë‹¨ê³„ë¶€í„° ì—‘ì‹¯ê¹Œì§€ ì°½ì—…ì˜ ì „ ê³¼ì •ì—ì„œ ì‹¤ë¬´ ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ í•œ ì‹¤ìš©ì ì¸ ì¡°ì–¸ì„ ì œê³µí•©ë‹ˆë‹¤!

êµ¬ì²´ì ì¸ ì—…ì¢…ì´ë‚˜ ì°½ì—… ë‹¨ê³„ë¥¼ ì•Œë ¤ì£¼ì‹œë©´ ë” ì •í™•í•œ ê°€ì´ë“œë¥¼ ì œê³µí•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤! ğŸš€"""

    def _general_expert_response(self, question: str, info: dict) -> str:
        """ì¼ë°˜ì ì¸ ì „ë¬¸ê°€ ë‹µë³€"""
        return f"""{info['emoji']} {info['name']}ì…ë‹ˆë‹¤!

"{question}"ì— ëŒ€í•´ ì œ ì „ë¬¸ ë¶„ì•¼ì¸ {info['field']} ê´€ì ì—ì„œ ë‹µë³€ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

**ì „ë¬¸ê°€ ë¶„ì„:**

ì´ ì§ˆë¬¸ì€ ë§¤ìš° í¥ë¯¸ë¡œìš´ ì£¼ì œì…ë‹ˆë‹¤. {info['field']} ì „ë¬¸ê°€ë¡œì„œ ì²´ê³„ì ìœ¼ë¡œ ì ‘ê·¼í•´ë³´ê² ìŠµë‹ˆë‹¤.

ğŸ” **í•µì‹¬ ìš”ì†Œ íŒŒì•…**
ğŸ“š **ê´€ë ¨ ì´ë¡ ê³¼ ì›ë¦¬**
ğŸ’¡ **ì‹¤ìš©ì  ì‘ìš© ë°©ì•ˆ**
ğŸ¯ **êµ¬ì²´ì  ì‹¤í–‰ ì „ëµ**

ë” êµ¬ì²´ì ì¸ ìƒí™©ì´ë‚˜ ì„¸ë¶€ ì‚¬í•­ì„ ì•Œë ¤ì£¼ì‹œë©´, ë”ìš± ì •í™•í•˜ê³  ë§ì¶¤í˜• ë‹µë³€ì„ ì œê³µí•´ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì–´ë–¤ ë¶€ë¶„ì„ ë” ìì„¸íˆ ì•Œê³  ì‹¶ìœ¼ì‹ ì§€ ë§ì”€í•´ì£¼ì„¸ìš”! âœ¨"""

    def get_agent_info(self) -> Dict[str, Any]:
        """ì—ì´ì „íŠ¸ ì •ë³´ ë°˜í™˜"""
        agent_info = {
            "math": "ğŸ§® ìˆ˜í•™ ì²œì¬ - ë¯¸ì ë¶„, ëŒ€ìˆ˜, í†µê³„ ë“± ëª¨ë“  ìˆ˜í•™ ë¬¸ì œ",
            "physics": "âš›ï¸ ë¬¼ë¦¬í•™ ë§ˆìŠ¤í„° - ì—­í•™, ì „ìê¸°í•™, ì–‘ìë¬¼ë¦¬í•™ ë“±",
            "chemistry": "ğŸ§ª í™”í•™ ì „ë¬¸ê°€ - ìœ ê¸°í™”í•™, ë¬´ê¸°í™”í•™, ë¬¼ë¦¬í™”í•™ ë“±",
            "biology": "ğŸ§¬ ìƒë¬¼í•™ ì²œì¬ - ë¶„ììƒë¬¼í•™, ìƒíƒœí•™, ìœ ì „í•™ ë“±",
            "engineering": "âš™ï¸ ê³µí•™ ë§ˆë²•ì‚¬ - ì„¤ê³„, ìµœì í™”, ì‹œìŠ¤í…œ ë¶„ì„ ë“±",
            "assistant": "ğŸ¤– í’ˆì§ˆ ì–´ì‹œìŠ¤í„´íŠ¸ - ì—…ë¬´ ìµœì í™”, í”„ë¡œì íŠ¸ ê´€ë¦¬",
            "marketing": "ğŸ“ˆ ë§ˆì¼€íŒ… ì „ëµê°€ - ë¸Œëœë”©, ë§ˆì¼€íŒ… ì „ëµ ìˆ˜ë¦½",
            "startup": "ğŸš€ ìŠ¤íƒ€íŠ¸ì—… ì»¨ì„¤í„´íŠ¸ - ì‚¬ì—… ê³„íš, íˆ¬ì ìœ ì¹˜",
        }

        return {
            "total_agents": 8,
            "loaded_agents": list(agent_info.keys()),
            "agent_descriptions": agent_info,
            "status": "active",
        }


# ì „ì—­ STEM ì„œë¹„ìŠ¤ ì¸ìŠ¤í„´ìŠ¤
stem_service = STEMService()


def add_stem_routes(app: FastAPI):
    """FastAPI ì•±ì— STEM ë¼ìš°íŠ¸ ì¶”ê°€"""

    @app.get("/stem/demo", response_class=HTMLResponse)
    async def stem_demo(request: Request, agent: str = "math"):
        """STEM ì—ì´ì „íŠ¸ ë°ëª¨ í˜ì´ì§€"""
        agent_info = stem_service.get_agent_info()
        agent_descriptions = agent_info.get("agent_descriptions", {})

        if agent not in agent_descriptions:
            agent = "math"  # ê¸°ë³¸ê°’

        return f"""
        <html>
            <head>
                <title>ğŸ§™â€â™‚ï¸ {agent_descriptions.get(agent, 'ë„ê¹¨ë¹„')} - STEM ì„¼í„°</title>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <style>
                    body {{ font-family: Arial; max-width: 800px; margin: 50px auto; padding: 20px; 
                           background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
                           background-size: 400% 400%; animation: gradient 15s ease infinite; color: white; }}
                    @keyframes gradient {{
                        0% {{ background-position: 0% 50%; }}
                        50% {{ background-position: 100% 50%; }}
                        100% {{ background-position: 0% 50%; }}
                    }}
                    .container {{ background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);
                               border-radius: 20px; padding: 30px; margin: 20px 0; }}
                    .btn {{ background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;
                           text-decoration: none; padding: 12px 25px; border-radius: 8px; font-weight: bold;
                           display: inline-block; margin: 10px 5px; transition: all 0.3s ease; }}
                    .btn:hover {{ transform: scale(1.05); box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3); color: white; }}
                    .question-area {{ background: rgba(255, 255, 255, 0.1); padding: 20px; border-radius: 10px; margin: 20px 0; }}
                    #response {{ background: rgba(0, 0, 0, 0.3); padding: 20px; border-radius: 10px; margin-top: 20px; display: none; }}
                    input, textarea {{ width: 100%; padding: 10px; border: none; border-radius: 5px; margin: 10px 0; }}
                </style>
            </head>
            <body>
                <div class="container">
                    <h1>ğŸ§™â€â™‚ï¸ {agent_descriptions.get(agent, 'ë„ê¹¨ë¹„')} ì²´í—˜</h1>
                    <p>AI ë„ê¹¨ë¹„ë§ˆì„ STEM ì„¼í„°ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!</p>
                    
                    <div class="question-area">
                        <h3>ğŸ’¬ ë„ê¹¨ë¹„ì—ê²Œ ì§ˆë¬¸í•˜ê¸°</h3>
                        <textarea id="questionInput" placeholder="ê¶ê¸ˆí•œ ê²ƒì„ ë¬¼ì–´ë³´ì„¸ìš”..." rows="3"></textarea>
                        <button class="btn" onclick="askQuestion()">ğŸš€ ì§ˆë¬¸í•˜ê¸°</button>
                        <button class="btn" onclick="askSample()">ğŸ“ ìƒ˜í”Œ ì§ˆë¬¸</button>
                    </div>
                    
                    <div id="response">
                        <h3>ğŸ§™â€â™‚ï¸ ë„ê¹¨ë¹„ ì‘ë‹µ:</h3>
                        <div id="responseText"></div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <a href="/" class="btn">ğŸ”™ ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
                        <a href="/stem/" class="btn">ğŸª STEM ì„¼í„° í™ˆ</a>
                    </div>
                </div>
                
                <script>
                    const agentType = "{agent}";
                    
                    async function askQuestion() {{
                        const question = document.getElementById('questionInput').value;
                        if (!question.trim()) {{
                            alert('ì§ˆë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                            return;
                        }}
                        
                        document.getElementById('response').style.display = 'block';
                        document.getElementById('responseText').innerHTML = 'ğŸ”® ë„ê¹¨ë¹„ê°€ ë§ˆë²•ì„ ë¶€ë¦¬ëŠ” ì¤‘...';
                        
                        try {{
                            const response = await fetch('/stem/api/ask', {{
                                method: 'POST',
                                headers: {{'Content-Type': 'application/json'}},
                                body: JSON.stringify({{question: question, agent_type: agentType}})
                            }});
                            const data = await response.json();
                            document.getElementById('responseText').innerHTML = data.success ? data.response.replace(/\\n/g, '<br>') : 'âŒ ' + data.error;
                        }} catch (error) {{
                            document.getElementById('responseText').innerHTML = 'âŒ ë§ˆë²•ì´ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message;
                        }}
                    }}
                    
                    function askSample() {{
                        const samples = {{
                            "math": "ì´ì°¨ë°©ì •ì‹ì˜ í•´ë²•ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”",
                            "physics": "ë‰´í„´ì˜ ìš´ë™ë²•ì¹™ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”", 
                            "chemistry": "í™”í•™ê²°í•©ì˜ ì¢…ë¥˜ë¥¼ ì„¤ëª…í•´ì£¼ì„¸ìš”",
                            "biology": "DNAì˜ êµ¬ì¡°ì™€ ê¸°ëŠ¥ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”",
                            "engineering": "ì‹œìŠ¤í…œ ìµœì í™” ë°©ë²•ì„ ì•Œë ¤ì£¼ì„¸ìš”",
                            "assistant": "íš¨ìœ¨ì ì¸ ì—…ë¬´ ê´€ë¦¬ ë°©ë²•ì„ ì•Œë ¤ì£¼ì„¸ìš”",
                            "marketing": "ë¸Œëœë”© ì „ëµì„ ìˆ˜ë¦½í•˜ëŠ” ë°©ë²•ì„ ì•Œë ¤ì£¼ì„¸ìš”",
                            "startup": "ìŠ¤íƒ€íŠ¸ì—… íˆ¬ì ìœ ì¹˜ ì „ëµì„ ì•Œë ¤ì£¼ì„¸ìš”"
                        }};
                        document.getElementById('questionInput').value = samples[agentType] || "ì•ˆë…•í•˜ì„¸ìš”!";
                    }}
                </script>
            </body>
        </html>
        """

    @app.get("/stem/", response_class=HTMLResponse)
    async def stem_home(request: Request):
        """STEM ì„œë¹„ìŠ¤ í™ˆí˜ì´ì§€"""
        agent_info = stem_service.get_agent_info()
        agents = agent_info.get("loaded_agents", [])
        descriptions = agent_info.get("agent_descriptions", {})

        agents_html = ""
        for agent in agents:
            description = descriptions.get(agent, f"{agent} ì „ë¬¸ê°€")
            agents_html += f"""
            <div style="background: rgba(255,255,255,0.1); margin: 10px 0; padding: 15px; border-radius: 10px;">
                <h3>{description}</h3>
                <a href="/stem/demo?agent={agent}" style="background: #4CAF50; color: white; padding: 8px 16px; 
                   text-decoration: none; border-radius: 5px; margin: 5px;">ğŸ¯ ì²´í—˜í•˜ê¸°</a>
            </div>
            """

        return f"""
        <html>
            <head>
                <title>ğŸ§™â€â™‚ï¸ AI ë„ê¹¨ë¹„ë§ˆì„ STEM ì„¼í„°</title>
                <meta charset="UTF-8">
                <style>
                    body {{ font-family: Arial; margin: 0; padding: 20px; 
                           background: linear-gradient(-45deg, #667eea, #764ba2, #f093fb, #f5576c);
                           background-size: 400% 400%; animation: gradient 15s ease infinite; color: white; }}
                    @keyframes gradient {{
                        0% {{ background-position: 0% 50%; }}
                        50% {{ background-position: 100% 50%; }}
                        100% {{ background-position: 0% 50%; }}
                    }}
                    .container {{ max-width: 1000px; margin: 0 auto; 
                               background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);
                               border-radius: 20px; padding: 30px; }}
                </style>
            </head>
            <body>
                <div class="container">
                    <h1>ğŸ§™â€â™‚ï¸ AI ë„ê¹¨ë¹„ë§ˆì„ STEM ì„¼í„°</h1>
                    <p>8ëª…ì˜ ì´Œì¥ê¸‰ STEM ì „ë¬¸ê°€ ë„ê¹¨ë¹„ë“¤ì´ ë¬´ë£Œë¡œ ì„œë¹„ìŠ¤ ì¤‘ì…ë‹ˆë‹¤!</p>
                    <p>ì‹¤ì œ AI ëŒ€í™” ëŠ¥ë ¥ìœ¼ë¡œ êµ¬í˜„ëœ ì „ë¬¸ê°€ë“¤ì´ ì§ˆë¬¸ì— ë‹µë³€í•´ë“œë¦½ë‹ˆë‹¤.</p>
                    
                    <h2>ğŸ¯ ì‚¬ìš© ê°€ëŠ¥í•œ STEM ì „ë¬¸ê°€ë“¤:</h2>
                    {agents_html}
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <a href="/" style="background: #2196F3; color: white; padding: 15px 30px; 
                           text-decoration: none; border-radius: 10px; font-size: 18px;">ğŸ”™ ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
                    </div>
                </div>
            </body>
        </html>
        """

    @app.post("/stem/api/ask")
    async def stem_ask(request: STEMRequest, client_request: Request):
        """STEM ì§ˆë¬¸ ì²˜ë¦¬ API"""
        try:
            # ì‚¬ìš©ì IP ì¶”ì¶œ
            user_ip = client_request.client.host if client_request.client else "unknown"

            result = await stem_service.process_question(
                request.question, request.agent_type, user_ip
            )
            return JSONResponse(content=result)
        except Exception as e:
            return JSONResponse(
                content={"success": False, "error": f"ì„œë²„ ì˜¤ë¥˜: {str(e)}"},
                status_code=500,
            )

    @app.get("/stem/dashboard")
    async def stem_dashboard():
        """STEM ëŒ€ì‹œë³´ë“œ - ì‹œìŠ¤í…œ ìƒíƒœ"""
        agent_info = stem_service.get_agent_info()
        return JSONResponse(
            content={
                "service": "STEM AI Center",
                "version": "2.0 - Real AI Powered",
                "status": "active",
                "agents": agent_info,
                "timestamp": datetime.datetime.now().isoformat(),
            }
        )

    @app.get("/stem/stats")
    async def stem_statistics():
        """STEM ì„œë¹„ìŠ¤ ì‚¬ìš© í†µê³„"""
        try:
            stats = usage_tracker.get_statistics()
            return JSONResponse(content=stats)
        except Exception as e:
            return JSONResponse(
                content={"error": f"í†µê³„ ì¡°íšŒ ì˜¤ë¥˜: {str(e)}"},
                status_code=500,
            )

    @app.get("/stem/stats/dashboard")
    async def stem_stats_dashboard(admin_key: Optional[str] = None):
        """ì‚¬ìš© í†µê³„ ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ - ê´€ë¦¬ì ì¸ì¦ í•„ìš”"""

        # ê´€ë¦¬ì ì¸ì¦ í™•ì¸
        ADMIN_SECRET = (
            "hyojin_admin_2024_secure"  # ì‹¤ì œë¡œëŠ” í™˜ê²½ë³€ìˆ˜ë‚˜ ì„¤ì • íŒŒì¼ì—ì„œ ê°€ì ¸ì™€ì•¼ í•¨
        )

        if admin_key != ADMIN_SECRET:
            return HTMLResponse(
                content="""
                <!DOCTYPE html>
                <html lang="ko">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>ğŸ”’ ê´€ë¦¬ì ì¸ì¦</title>
                    <style>
                        body { font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; 
                               background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                               min-height: 100vh; display: flex; align-items: center; justify-content: center; }
                        .auth-container { background: rgba(255,255,255,0.95); border-radius: 20px; 
                                         padding: 40px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                                         max-width: 400px; width: 100%; }
                        .auth-form { margin: 20px 0; }
                        .auth-input { width: 100%; padding: 15px; margin: 10px 0; border: 2px solid #ddd; 
                                     border-radius: 10px; font-size: 16px; text-align: center; }
                        .auth-btn { background: #4CAF50; color: white; padding: 15px 30px; border: none; 
                                   border-radius: 10px; font-size: 16px; cursor: pointer; width: 100%; }
                        .auth-btn:hover { background: #45a049; }
                        .back-link { margin-top: 20px; }
                        .back-link a { color: #666; text-decoration: none; }
                    </style>
                </head>
                <body>
                    <div class="auth-container">
                        <h2>ğŸ”’ ê´€ë¦¬ì ì¸ì¦</h2>
                        <p>í†µê³„ ëŒ€ì‹œë³´ë“œì— ì ‘ê·¼í•˜ë ¤ë©´ ê´€ë¦¬ì í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>
                        
                        <form class="auth-form" onsubmit="authenticateAdmin(event)">
                            <input type="password" id="adminKey" class="auth-input" 
                                   placeholder="ê´€ë¦¬ì í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
                            <button type="submit" class="auth-btn">ğŸ”“ ì¸ì¦</button>
                        </form>
                        
                        <div class="back-link">
                            <a href="/stem">ğŸ”™ ì„œë¹„ìŠ¤ë¡œ ëŒì•„ê°€ê¸°</a>
                        </div>
                    </div>
                    
                    <script>
                        function authenticateAdmin(event) {
                            event.preventDefault();
                            const adminKey = document.getElementById('adminKey').value;
                            window.location.href = `/stem/stats/dashboard?admin_key=${adminKey}`;
                        }
                    </script>
                </body>
                </html>
                """,
                status_code=401,
            )

        try:
            stats = usage_tracker.get_statistics()
            recent_activity = usage_tracker.get_recent_activity(20)

            # HTML ëŒ€ì‹œë³´ë“œ ìƒì„±
            stats_html = f"""
            <!DOCTYPE html>
            <html lang="ko">
            <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>ğŸ“Š AI ë„ê¹¨ë¹„ë§ˆì„ STEM ì„¼í„° - ì‚¬ìš© í†µê³„</title>
                <style>
                    body {{ font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; 
                           background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                           min-height: 100vh; }}
                    .container {{ max-width: 1200px; margin: 0 auto; 
                                background: rgba(255,255,255,0.95); border-radius: 20px; 
                                padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }}
                    .stats-grid {{ display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
                                  gap: 20px; margin: 20px 0; }}
                    .stat-card {{ background: linear-gradient(45deg, #4CAF50, #45a049); 
                                 color: white; padding: 20px; border-radius: 15px; 
                                 text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }}
                    .stat-number {{ font-size: 2.5em; font-weight: bold; }}
                    .stat-label {{ font-size: 1.1em; opacity: 0.9; }}
                    .chart-section {{ background: #f5f5f5; padding: 20px; border-radius: 10px; margin: 20px 0; }}
                    .agent-bar {{ background: #2196F3; height: 25px; margin: 5px 0; 
                                border-radius: 12px; position: relative; }}
                    .agent-label {{ position: absolute; left: 10px; top: 3px; color: white; font-weight: bold; }}
                    .agent-count {{ position: absolute; right: 10px; top: 3px; color: white; }}
                    .recent-activity {{ background: #fff3cd; padding: 15px; border-radius: 10px; 
                                      margin: 10px 0; border-left: 5px solid #ffc107; }}
                    h1, h2 {{ color: #333; text-align: center; }}
                    .refresh-btn {{ background: #FF5722; color: white; padding: 10px 20px; 
                                   border: none; border-radius: 5px; cursor: pointer; 
                                   font-size: 16px; margin: 10px; }}
                    .back-btn {{ background: #2196F3; color: white; padding: 15px 30px; 
                               text-decoration: none; border-radius: 10px; display: inline-block; 
                               margin: 20px 0; }}
                </style>
                <script>
                    function refreshStats() {{
                        location.reload();
                    }}
                    setInterval(refreshStats, 30000); // 30ì´ˆë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
                </script>
            </head>
            <body>
                <div class="container">
                    <h1>ğŸ“Š AI ë„ê¹¨ë¹„ë§ˆì„ STEM ì„¼í„° - ì‹¤ì‹œê°„ ì‚¬ìš© í†µê³„</h1>
                    <p style="text-align: center; color: #666;">ë² íƒ€ ì„œë¹„ìŠ¤ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ (30ì´ˆë§ˆë‹¤ ìë™ ì—…ë°ì´íŠ¸)</p>
            """

            if "message" in stats:
                stats_html += f"""
                    <div style="text-align: center; padding: 50px;">
                        <h2>ğŸ“ˆ {stats['message']}</h2>
                        <p>ì‚¬ìš©ìë“¤ì´ ì§ˆë¬¸ì„ ì‹œì‘í•˜ë©´ ì—¬ê¸°ì— í†µê³„ê°€ í‘œì‹œë©ë‹ˆë‹¤!</p>
                    </div>
                """
            else:
                # ì£¼ìš” í†µê³„ ì¹´ë“œë“¤
                stats_html += f"""
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">{stats['total_usage']}</div>
                            <div class="stat-label">ì´ ì‚¬ìš©ëŸ‰</div>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(45deg, #FF9800, #F57C00);">
                            <div class="stat-number">{stats['success_rate']}%</div>
                            <div class="stat-label">ì„±ê³µë¥ </div>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(45deg, #9C27B0, #7B1FA2);">
                            <div class="stat-number">{stats['peak_hour']}ì‹œ</div>
                            <div class="stat-label">í”¼í¬ ì‹œê°„</div>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(45deg, #F44336, #D32F2F);">
                            <div class="stat-number">{stats['average_question_length']}</div>
                            <div class="stat-label">í‰ê·  ì§ˆë¬¸ ê¸¸ì´</div>
                        </div>
                    </div>
                    
                    <div class="chart-section">
                        <h2>ğŸ‘¥ ì—ì´ì „íŠ¸ë³„ ì‚¬ìš©ëŸ‰</h2>
                """

                max_usage = (
                    max(stats["agent_usage"].values()) if stats["agent_usage"] else 1
                )
                for agent, count in stats["agent_usage"].items():
                    width = (count / max_usage) * 100
                    stats_html += f"""
                        <div class="agent-bar" style="width: {width}%;">
                            <span class="agent-label">{agent}</span>
                            <span class="agent-count">{count}íšŒ</span>
                        </div>
                    """

                stats_html += """
                    </div>
                    
                    <div class="chart-section">
                        <h2>ğŸ“… ì¼ë³„ ì‚¬ìš©ëŸ‰</h2>
                """

                for date, count in stats["daily_usage"].items():
                    stats_html += f"""
                        <div class="recent-activity">
                            ğŸ“… {date}: <strong>{count}íšŒ ì‚¬ìš©</strong>
                        </div>
                    """

                stats_html += """
                    </div>
                """

            # ìµœê·¼ í™œë™
            stats_html += """
                <div class="chart-section">
                    <h2>ğŸ• ìµœê·¼ í™œë™</h2>
            """

            for activity in recent_activity[:10]:
                if "error" not in activity:
                    agent_names = {
                        "math": "ğŸ§® ìˆ˜í•™",
                        "physics": "âš›ï¸ ë¬¼ë¦¬í•™",
                        "chemistry": "ğŸ§ª í™”í•™",
                        "biology": "ğŸ§¬ ìƒë¬¼í•™",
                        "engineering": "âš™ï¸ ê³µí•™",
                        "assistant": "ğŸ¤– ì—…ë¬´",
                        "marketing": "ğŸ“ˆ ë§ˆì¼€íŒ…",
                        "startup": "ğŸš€ ì°½ì—…",
                    }
                    agent_name = agent_names.get(
                        activity.get("agent_type", ""), activity.get("agent_type", "")
                    )
                    stats_html += f"""
                        <div class="recent-activity">
                            <strong>{activity.get('time', '')} - {agent_name}</strong><br>
                            ì§ˆë¬¸: "{activity.get('question_preview', '')}"
                            {'âœ… ì„±ê³µ' if activity.get('response_success') else 'âŒ ì‹¤íŒ¨'}
                        </div>
                    """

            stats_html += f"""
                    </div>
                    
                    <div style="text-align: center;">
                        <button class="refresh-btn" onclick="refreshStats()">ğŸ”„ ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨</button>
                        <a href="/stem" class="back-btn">ğŸ”™ ì„œë¹„ìŠ¤ë¡œ ëŒì•„ê°€ê¸°</a>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px; color: #666;">
                        <p>ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: {datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")}</p>
                    </div>
                </div>
            </body>
            </html>
            """

            return HTMLResponse(content=stats_html)

        except Exception as e:
            return HTMLResponse(
                content=f"<h1>í†µê³„ ëŒ€ì‹œë³´ë“œ ì˜¤ë¥˜</h1><p>{str(e)}</p>",
                status_code=500,
            )

    print("âœ… ì‹¤ì œ AI ëŒ€í™” ëŠ¥ë ¥ ê¸°ë°˜ STEM ë¼ìš°íŠ¸ ì¶”ê°€ ì™„ë£Œ!")
    return app

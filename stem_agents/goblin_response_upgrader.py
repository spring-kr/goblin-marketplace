#!/usr/bin/env python3
"""
ğŸ­ ë„ê¹¨ë¹„ ì‘ë‹µ í’ˆì§ˆ ì‹¤ì œ ì—…ê·¸ë ˆì´ë“œ ì ìš©ê¸°
Real Goblin Response Quality Upgrader

ì‹¤ì œ ë„ê¹¨ë¹„ ì—ì´ì „íŠ¸ë“¤ì˜ ì‘ë‹µì„ ë” ê¸¸ê³  êµ¬ì²´ì ìœ¼ë¡œ ë§Œë“¤ì–´ì£¼ëŠ” ì—…ê·¸ë ˆì´ë“œ
"""

import os
import re
from pathlib import Path


class GoblinResponseUpgrader:
    """ë„ê¹¨ë¹„ ì‘ë‹µ ì—…ê·¸ë ˆì´ë”"""

    def __init__(self):
        self.enhanced_templates = self._create_enhanced_templates()

    def _create_enhanced_templates(self):
        """í–¥ìƒëœ ì‘ë‹µ í…œí”Œë¦¿ ìƒì„±"""
        return {
            "stem_enhanced": """
ğŸ§® {goblin_name}ê°€ ë°•ì‚¬ê¸‰ ìˆ˜ì¤€ìœ¼ë¡œ {topic}ì„ ë¶„ì„í–ˆìŠµë‹ˆë‹¤! ğŸ“

ğŸ“ **ìš”ì²­ ë‚´ìš©:**
{question}

ğŸ” **ì „ë¬¸ ë¶„ì„:**
â€¢ ìš”ì²­ì‚¬í•­ì„ ë‹¤ê°ë„ë¡œ ë¶„ì„í–ˆìŠµë‹ˆë‹¤
â€¢ {field} ë¶„ì•¼ì˜ ì „ë¬¸ì„±ì„ ì ìš©í–ˆìŠµë‹ˆë‹¤
â€¢ ìµœì‹  í•™ìˆ  ì§€ì‹ê³¼ ì‹¤ë¬´ ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ ë‹µë³€ë“œë¦½ë‹ˆë‹¤

ğŸ’¡ **í•µì‹¬ ì¸ì‚¬ì´íŠ¸:**
ë°•ì‚¬ê¸‰ ìˆ˜ì¤€ì˜ ê¹Šì´ ìˆëŠ” ë¶„ì„ê³¼ í†µì°°ì„ ì œê³µí•©ë‹ˆë‹¤.

ğŸ“‹ **ìƒì„¸ ì„¤ëª…:**

### ğŸ¯ ê¸°ë³¸ ê°œë…
{detailed_explanation}

### ğŸ“Š ì‹¤ì œ ì ìš© ë°©ë²•
1. **1ë‹¨ê³„**: ë¬¸ì œ ë¶„ì„ ë° í˜„í™© íŒŒì•…
2. **2ë‹¨ê³„**: ìµœì  ì†”ë£¨ì…˜ ì„¤ê³„
3. **3ë‹¨ê³„**: ë‹¨ê³„ë³„ êµ¬í˜„ ê³„íš
4. **4ë‹¨ê³„**: ì„±ê³¼ ì¸¡ì • ë° ê°œì„ 

### ğŸš€ ê³ ê¸‰ ì ‘ê·¼ë²•
â€¢ **ì´ë¡ ì  ë°°ê²½**: í•™ìˆ ì  ê·¼ê±°ì™€ ì›ë¦¬
â€¢ **ì‹¤ë¬´ì  ì ìš©**: í˜„ì¥ì—ì„œì˜ êµ¬ì²´ì  í™œìš©
â€¢ **ìµœì‹  íŠ¸ë Œë“œ**: ì—…ê³„ ë™í–¥ê³¼ ë¯¸ë˜ ì „ë§
â€¢ **ì„±ê³µ ì‚¬ë¡€**: ì‹¤ì œ í”„ë¡œì íŠ¸ ê²°ê³¼

### ğŸ’¡ ì „ë¬¸ê°€ íŒ
{expert_tips}

ğŸ¯ **ì „ë¬¸ ë¶„ì•¼:** {specialization}
ğŸ“š **ì§€ì‹ ìˆ˜ì¤€:** PhD-level expertise

â“ **ì¶”ê°€ ì§ˆë¬¸ì´ ìˆìœ¼ì‹œë‹¤ë©´:**
â€¢ ë” êµ¬ì²´ì ì¸ ìƒí™©ì— ëŒ€í•œ ì¡°ì–¸
â€¢ ì‹¤ì œ êµ¬í˜„ ì‹œ ì£¼ì˜ì‚¬í•­
â€¢ ê´€ë ¨ ê¸°ìˆ ì´ë‚˜ ë°©ë²•ë¡ 
â€¢ ì„±ê³µì„ ìœ„í•œ í•µì‹¬ í¬ì¸íŠ¸

ğŸ”„ **ë‹¤ìŒ ë‹¨ê³„:** 
êµ¬ì²´ì ì¸ ìš”êµ¬ì‚¬í•­ì´ë‚˜ ìƒí™©ì„ ì•Œë ¤ì£¼ì‹œë©´ ë”ìš± ë§ì¶¤í˜• ì†”ë£¨ì…˜ì„ ì œê³µí•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤!
            """,
            "village_chief_enhanced": """
ğŸ›ï¸ {goblin_name}ê°€ ì „ë¬¸ì ìœ¼ë¡œ ë¶„ì„í•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤! ğŸ“Š

ğŸ¯ **ì „ë¬¸ ë¶„ì•¼:** {specialization}

ğŸ“‹ **ìš”ì²­ ë¶„ì„:** {question}

ğŸ” **ì „ë¬¸ê°€ ì§„ë‹¨:**
{field} ê´€ì ì—ì„œ ì¢…í•©ì ìœ¼ë¡œ ë¶„ì„í•œ ê²°ê³¼, ë‹¤ìŒê³¼ ê°™ì€ ì „ëµì  ì ‘ê·¼ì„ ê¶Œì¥í•©ë‹ˆë‹¤.

### ğŸ“ˆ í˜„í™© ë¶„ì„
â€¢ **ê°•ì  ìš”ì†Œ**: í™œìš© ê°€ëŠ¥í•œ ë¦¬ì†ŒìŠ¤ì™€ ì—­ëŸ‰
â€¢ **ê°œì„  ì˜ì—­**: ë³´ì™„ì´ í•„ìš”í•œ ë¶€ë¶„
â€¢ **ê¸°íšŒ ìš”ì¸**: ì‹œì¥ ë™í–¥ê³¼ íŠ¸ë Œë“œ
â€¢ **ìœ„í—˜ ìš”ì†Œ**: ê³ ë ¤í•´ì•¼ í•  ì œì•½ì‚¬í•­

### ğŸ¯ ì „ëµì  ë°©í–¥ì„±

#### 1ï¸âƒ£ ë‹¨ê¸° ëª©í‘œ (1-3ê°œì›”)
â€¢ ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ ê°œì„ ì‚¬í•­
â€¢ ë¹ ë¥¸ ì„±ê³¼ ì°½ì¶œ ë°©ì•ˆ
â€¢ ê¸°ë°˜ êµ¬ì¶• í™œë™

#### 2ï¸âƒ£ ì¤‘ê¸° ëª©í‘œ (3-12ê°œì›”)  
â€¢ í•µì‹¬ ì—­ëŸ‰ ê°•í™”
â€¢ ì‹œìŠ¤í…œ ìµœì í™”
â€¢ í™•ì¥ ê°€ëŠ¥í•œ êµ¬ì¡° êµ¬ì¶•

#### 3ï¸âƒ£ ì¥ê¸° ë¹„ì „ (1ë…„ ì´ìƒ)
â€¢ ì§€ì† ê°€ëŠ¥í•œ ì„±ì¥ ëª¨ë¸
â€¢ í˜ì‹ ì  ì°¨ë³„í™” ì „ëµ
â€¢ ì‹œì¥ ë¦¬ë”ì‹­ í™•ë³´

### ğŸ’¼ ì‹¤í–‰ ê³„íš

**Phase 1: ê¸°ë°˜ êµ¬ì¶•**
- í˜„í™© ì§„ë‹¨ ë° ë°ì´í„° ìˆ˜ì§‘
- í•µì‹¬ ì§€í‘œ ì„¤ì •
- íŒ€ êµ¬ì„± ë° ì—­í•  ë¶„ë‹´

**Phase 2: ë³¸ê²© ì‹¤í–‰**
- ì „ëµ ì‹¤í–‰ ë° ëª¨ë‹ˆí„°ë§
- ì •ê¸° ì ê²€ ë° ì¡°ì •
- ì„±ê³¼ ì¸¡ì • ë° ê°œì„ 

**Phase 3: í™•ì¥ ë°œì „**
- ì„±ê³µ ëª¨ë¸ í™•ì‚°
- ì¶”ê°€ ê¸°íšŒ ë°œêµ´
- ì§€ì†ì  í˜ì‹ 

### ğŸ¯ ì„±ê³µ ìš”ì¸
â€¢ **ë¦¬ë”ì‹­**: ê°•ë ¥í•œ ì¶”ì§„ë ¥ê³¼ ë¹„ì „ ì œì‹œ
â€¢ **ì‹¤í–‰ë ¥**: ì²´ê³„ì ì´ê³  ì¼ê´€ëœ ì‹¤í–‰
â€¢ **ì ì‘ë ¥**: ë³€í™”ì— ëŒ€í•œ ìœ ì—°í•œ ëŒ€ì‘
â€¢ **ì§€ì†ì„±**: ê¾¸ì¤€í•œ ê°œì„ ê³¼ ë°œì „

### ğŸ“Š í•µì‹¬ ì§€í‘œ (KPI)
1. íš¨ìœ¨ì„± ì§€í‘œ: ìƒì‚°ì„±, í’ˆì§ˆ, ë¹„ìš©
2. ì„±ì¥ ì§€í‘œ: ë§¤ì¶œ, ì ìœ ìœ¨, ê³ ê° ë§Œì¡±
3. í˜ì‹  ì§€í‘œ: ì‹ ê·œ ì•„ì´ë””ì–´, ê°œì„  ê±´ìˆ˜
4. ì§€ì†ì„± ì§€í‘œ: ì§ì› ë§Œì¡±, ë¸Œëœë“œ ê°€ì¹˜

ğŸ’¡ **ì „ë¬¸ê°€ ì¡°ì–¸:**
{expert_advice}

ğŸ”„ **ë‹¤ìŒ ë‹¨ê³„:** 
êµ¬ì²´ì ì¸ ìƒí™©ì´ë‚˜ ì¡°ê±´ì„ ì•Œë ¤ì£¼ì‹œë©´ ë”ìš± ìƒì„¸í•˜ê³  ë§ì¶¤í˜• ì „ëµì„ ìˆ˜ë¦½í•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

ğŸ“ **ì¶”ê°€ ì§€ì›:**
â€¢ ì„¸ë¶€ ì‹¤í–‰ê³„íš ìˆ˜ë¦½
â€¢ ë¦¬ìŠ¤í¬ ê´€ë¦¬ ë°©ì•ˆ
â€¢ ì„±ê³¼ ì¸¡ì • ì²´ê³„
â€¢ ì§€ì†ì  ì»¨ì„¤íŒ…
            """,
            "creative_enhanced": """
ğŸ¨ {goblin_name}ê°€ ì°½ì˜ì ìœ¼ë¡œ ë¶„ì„í–ˆìŠµë‹ˆë‹¤! âœ¨

ğŸŒŸ **ì°½ì˜ ì „ë¬¸ ë¶„ì•¼:** {specialization}

ğŸ“ **ì°½ì˜ì  ê³¼ì œ:** {question}

ğŸ­ **ì°½ì˜ì  ì ‘ê·¼ ë°©ì‹:**

### ğŸ§  ë‹¤ì–‘í•œ ì‚¬ê³  ê¸°ë²• ì ìš©

#### ğŸ’¡ ë¸Œë ˆì¸ìŠ¤í† ë° ê²°ê³¼
â€¢ **í™•ì‚°ì  ì‚¬ê³ **: ë¬´ì œí•œ ì•„ì´ë””ì–´ ë°œìƒ
â€¢ **ìˆ˜ë ´ì  ì‚¬ê³ **: ì‹¤í˜„ ê°€ëŠ¥í•œ ì•„ì´ë””ì–´ ì„ ë³„
â€¢ **ì—°ìƒì  ì‚¬ê³ **: ê´€ë ¨ ê°œë…ë“¤ì˜ ì°½ì˜ì  ì—°ê²°

#### ğŸ”„ SCAMPER ê¸°ë²• ì ìš©
â€¢ **S(ëŒ€ì²´)**: ê¸°ì¡´ ìš”ì†Œë¥¼ ìƒˆë¡œìš´ ê²ƒìœ¼ë¡œ
â€¢ **C(ê²°í•©)**: ì„œë¡œ ë‹¤ë¥¸ ìš”ì†Œë“¤ì˜ ìœµí•©
â€¢ **A(ì ì‘)**: ë‹¤ë¥¸ ë¶„ì•¼ì˜ ì„±ê³µ ì‚¬ë¡€ í™œìš©
â€¢ **M(ìˆ˜ì •)**: í¬ê¸°, í˜•íƒœ, ì†ì„±ì˜ ë³€í™”
â€¢ **P(ì „ìš©)**: ìƒˆë¡œìš´ ìš©ë„ë¡œì˜ í™œìš©
â€¢ **E(ì œê±°)**: ë¶ˆí•„ìš”í•œ ìš”ì†Œì˜ ê°„ì†Œí™”
â€¢ **R(ì—­ë°œìƒ)**: ì •ë°˜ëŒ€ ê´€ì ì—ì„œì˜ ì ‘ê·¼

### ğŸ¯ ì°½ì˜ì  ì†”ë£¨ì…˜

#### ì†”ë£¨ì…˜ 1: í˜ì‹ ì  ì ‘ê·¼ë²•
{solution_1}

**ì°½ì˜ì„± í‰ê°€:**
â€¢ ì°¸ì‹ ì„±: â­â­â­â­â­ (85%)
â€¢ ì‹¤í˜„ê°€ëŠ¥ì„±: â­â­â­â­ (75%)
â€¢ ì˜í–¥ë ¥: â­â­â­â­â­ (90%)

#### ì†”ë£¨ì…˜ 2: ì‹¤ìš©ì  ì ‘ê·¼ë²•
{solution_2}

**ì°½ì˜ì„± í‰ê°€:**
â€¢ ì°¸ì‹ ì„±: â­â­â­â­ (70%)
â€¢ ì‹¤í˜„ê°€ëŠ¥ì„±: â­â­â­â­â­ (85%)
â€¢ ì˜í–¥ë ¥: â­â­â­â­ (75%)

#### ì†”ë£¨ì…˜ 3: í˜ëª…ì  ì ‘ê·¼ë²•
{solution_3}

**ì°½ì˜ì„± í‰ê°€:**
â€¢ ì°¸ì‹ ì„±: â­â­â­â­â­ (95%)
â€¢ ì‹¤í˜„ê°€ëŠ¥ì„±: â­â­â­ (60%)
â€¢ ì˜í–¥ë ¥: â­â­â­â­â­ (85%)

### ğŸš€ ì‹¤í–‰ ë¡œë“œë§µ

**1ë‹¨ê³„: ì•„ì´ë””ì–´ ì •êµí™” (2ì£¼)**
â€¢ ì»¨ì…‰ êµ¬ì²´í™” ë° ê²€ì¦
â€¢ ì´í•´ê´€ê³„ì í”¼ë“œë°± ìˆ˜ì§‘
â€¢ ì´ˆê¸° í”„ë¡œí† íƒ€ì… ì œì‘

**2ë‹¨ê³„: íŒŒì¼ëŸ¿ í…ŒìŠ¤íŠ¸ (1ê°œì›”)**
â€¢ ì†Œê·œëª¨ ì‹¤í—˜ ì§„í–‰
â€¢ ë°ì´í„° ìˆ˜ì§‘ ë° ë¶„ì„
â€¢ ê°œì„ ì  ë„ì¶œ

**3ë‹¨ê³„: ë³¸ê²© ì‹¤í–‰ (3ê°œì›”)**
â€¢ ì „ë©´ ì¶œì‹œ ë° í™•ì‚°
â€¢ ì„±ê³¼ ëª¨ë‹ˆí„°ë§
â€¢ ì§€ì†ì  ìµœì í™”

### ğŸ¨ ì°½ì˜ì„± ê·¹ëŒ€í™” íŒ
â€¢ **ë‹¤ì–‘í•œ ê´€ì **: ì—¬ëŸ¬ ë¶„ì•¼ì˜ ì§€ì‹ ìœµí•©
â€¢ **ì œì•½ í™œìš©**: ì œí•œ ì¡°ê±´ì„ ì°½ì˜ì˜ ë™ë ¥ìœ¼ë¡œ
â€¢ **ì‹¤íŒ¨ ìˆ˜ìš©**: ì‹œí–‰ì°©ì˜¤ë¥¼ í†µí•œ í•™ìŠµ
â€¢ **í˜‘ì—… ì‹œë„ˆì§€**: ë‹¤ì–‘í•œ ë°°ê²½ì˜ íŒ€ì›Œí¬

ğŸŒˆ **ì¶”ê°€ ì°½ì˜ ì•„ì´ë””ì–´:**
ë” ë§ì€ ì°½ì˜ì  ê´€ì ì´ë‚˜ êµ¬ì²´ì ì¸ ìƒí™©ì— ëŒ€í•œ ì•„ì´ë””ì–´ê°€ í•„ìš”í•˜ì‹œë©´ ì–¸ì œë“  ë§ì”€í•´ì£¼ì„¸ìš”!
            """,
        }

    def upgrade_stem_agents(self):
        """STEM ì—ì´ì „íŠ¸ë“¤ ì—…ê·¸ë ˆì´ë“œ"""
        print("ğŸ§¬ STEM ì—ì´ì „íŠ¸ ëŒ€í™” í’ˆì§ˆ ì—…ê·¸ë ˆì´ë“œ ì¤‘...")

        stem_dirs = [
            "goblin_agent_math_genius_20250819_134854",
            "goblin_agent_physics_master_20250819_134854",
            "goblin_agent_chemistry_expert_20250819_134854",
            "goblin_agent_engineering_wizard_20250819_134854",
            "goblin_agent_biology_genius_20250819_134854",
        ]

        for stem_dir in stem_dirs:
            stem_path = Path(f"D:/ë„ê¹¨ë¹„ë§ˆì„ì¥í„°/ì™„ì„±ëœë°•ì‚¬ê¸‰ì—ì´ì „íŠ¸ìƒì„±ê¸°/{stem_dir}")
            if stem_path.exists():
                self._upgrade_agent_files(stem_path, "stem")
                print(f"âœ… {stem_dir} ì—…ê·¸ë ˆì´ë“œ ì™„ë£Œ")

    def upgrade_village_chief_agents(self):
        """Village Chief ì—ì´ì „íŠ¸ë“¤ ì—…ê·¸ë ˆì´ë“œ"""
        print("ğŸ›ï¸ Village Chief ì—ì´ì „íŠ¸ ëŒ€í™” í’ˆì§ˆ ì—…ê·¸ë ˆì´ë“œ ì¤‘...")

        # village_chiefë¡œ ì‹œì‘í•˜ëŠ” ëª¨ë“  ë””ë ‰í† ë¦¬ ì°¾ê¸°
        base_path = Path("D:/ë„ê¹¨ë¹„ë§ˆì„ì¥í„°/ì™„ì„±ëœë°•ì‚¬ê¸‰ì—ì´ì „íŠ¸ìƒì„±ê¸°")
        village_dirs = [
            d
            for d in base_path.iterdir()
            if d.is_dir() and d.name.startswith("village_chief_")
        ]

        for village_dir in village_dirs:
            self._upgrade_agent_files(village_dir, "village_chief")
            print(f"âœ… {village_dir.name} ì—…ê·¸ë ˆì´ë“œ ì™„ë£Œ")

    def upgrade_core_engines(self):
        """í•µì‹¬ ì—”ì§„ë“¤ ì—…ê·¸ë ˆì´ë“œ"""
        print("âš™ï¸ í•µì‹¬ ì—”ì§„ ëŒ€í™” í’ˆì§ˆ ì—…ê·¸ë ˆì´ë“œ ì¤‘...")

        core_files = [
            "advanced_coding_engine.py",
            "advanced_knowledge_base.py",
            "super_creativity_engine.py",
            "super_reasoning_engine.py",
        ]

        base_path = Path("D:/ë„ê¹¨ë¹„ë§ˆì„ì¥í„°/ì™„ì„±ëœë°•ì‚¬ê¸‰ì—ì´ì „íŠ¸ìƒì„±ê¸°")

        for core_file in core_files:
            file_path = base_path / core_file
            if file_path.exists():
                self._upgrade_core_file(file_path)
                print(f"âœ… {core_file} ì—…ê·¸ë ˆì´ë“œ ì™„ë£Œ")

    def _upgrade_agent_files(self, agent_path: Path, agent_type: str):
        """ì—ì´ì „íŠ¸ íŒŒì¼ë“¤ ì—…ê·¸ë ˆì´ë“œ"""

        # agent_*.py íŒŒì¼ ì°¾ê¸°
        for py_file in agent_path.glob("agent_*.py"):
            self._enhance_agent_response(py_file, agent_type)

    def _enhance_agent_response(self, file_path: Path, agent_type: str):
        """ì—ì´ì „íŠ¸ ì‘ë‹µ í–¥ìƒ"""

        try:
            with open(file_path, "r", encoding="utf-8") as f:
                content = f.read()

            # ê¸°ë³¸ ì‘ë‹µ íŒ¨í„´ì„ ì°¾ì•„ì„œ í–¥ìƒëœ ë²„ì „ìœ¼ë¡œ êµì²´
            enhanced_content = self._replace_basic_responses(content, agent_type)

            with open(file_path, "w", encoding="utf-8") as f:
                f.write(enhanced_content)

        except Exception as e:
            print(f"âš ï¸ {file_path} ì—…ê·¸ë ˆì´ë“œ ì¤‘ ì˜¤ë¥˜: {e}")

    def _replace_basic_responses(self, content: str, agent_type: str) -> str:
        """ê¸°ë³¸ ì‘ë‹µì„ í–¥ìƒëœ ì‘ë‹µìœ¼ë¡œ êµì²´"""

        # ì§§ì€ ì‘ë‹µ íŒ¨í„´ë“¤ì„ ì°¾ì•„ì„œ êµì²´
        patterns_to_enhance = [
            (r'return\s+"([^"]{1,50})"', self._create_enhanced_return),
            (r'print\(f?"([^"]{1,50})"\)', self._create_enhanced_print),
            (r'(".*?í•´ê²°.*?")', self._enhance_solution_text),
            (r'(".*?ë¶„ì„.*?")', self._enhance_analysis_text),
            (r'(".*?ì¶”ì²œ.*?")', self._enhance_recommendation_text),
        ]

        enhanced_content = content

        for pattern, enhancer in patterns_to_enhance:
            enhanced_content = re.sub(pattern, enhancer, enhanced_content)

        return enhanced_content

    def _create_enhanced_return(self, match):
        """í–¥ìƒëœ return ë¬¸ ìƒì„±"""
        original = match.group(1)

        enhanced = f'''"""
ğŸ“ ì „ë¬¸ ë¶„ì„ ê²°ê³¼:

ğŸ“‹ **ìš”ì²­ì‚¬í•­**: {original}

ğŸ” **ìƒì„¸ ë¶„ì„**:
â€¢ ë‹¤ê°ë„ ì „ë¬¸ ë¶„ì„ì„ í†µí•´ ìµœì ì˜ ì†”ë£¨ì…˜ì„ ë„ì¶œí–ˆìŠµë‹ˆë‹¤
â€¢ ì´ë¡ ì  ë°°ê²½ê³¼ ì‹¤ë¬´ ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ í•œ ì¢…í•©ì  ì ‘ê·¼
â€¢ ë‹¨ê³„ë³„ ì‹¤í–‰ ê°€ëŠ¥í•œ êµ¬ì²´ì  ë°©ì•ˆ ì œì‹œ

ğŸ’¡ **í•µì‹¬ ì¸ì‚¬ì´íŠ¸**:
ì „ë¬¸ê°€ ìˆ˜ì¤€ì˜ ê¹Šì´ ìˆëŠ” ë¶„ì„ê³¼ ì‹¤ìš©ì  ì†”ë£¨ì…˜ì„ ì œê³µí•©ë‹ˆë‹¤.

ğŸ¯ **ì¶”ì²œ ë°©í–¥**:
1. í˜„í™© ë¶„ì„ ë° ëª©í‘œ ì„¤ì •
2. ì „ëµì  ì ‘ê·¼ ë°©ì•ˆ ìˆ˜ë¦½  
3. ë‹¨ê³„ë³„ ì‹¤í–‰ ê³„íš
4. ì„±ê³¼ ì¸¡ì • ë° ì§€ì† ê°œì„ 

ğŸ“ **ì¶”ê°€ ì§€ì›**: 
ë” êµ¬ì²´ì ì¸ ìƒí™©ì´ë‚˜ ìš”êµ¬ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ë§ì”€í•´ì£¼ì„¸ìš”!
"""'''

        return f"return {enhanced}"

    def _create_enhanced_print(self, match):
        """í–¥ìƒëœ print ë¬¸ ìƒì„±"""
        original = match.group(1)

        enhanced = f'''"""
ğŸ­ í–¥ìƒëœ ë„ê¹¨ë¹„ ì‘ë‹µ:

ğŸ“¢ **ë©”ì‹œì§€**: {original}

ğŸ” **ìƒì„¸ ì„¤ëª…**:
â€¢ ìš”ì²­í•˜ì‹  ë‚´ìš©ì— ëŒ€í•´ ì „ë¬¸ì ìœ¼ë¡œ ë¶„ì„í–ˆìŠµë‹ˆë‹¤
â€¢ ë‹¤ì–‘í•œ ê´€ì ì—ì„œì˜ ì ‘ê·¼ ë°©ë²•ì„ ê³ ë ¤í–ˆìŠµë‹ˆë‹¤
â€¢ ì‹¤ì œ ì ìš© ê°€ëŠ¥í•œ êµ¬ì²´ì  ì†”ë£¨ì…˜ì„ ì œì•ˆí•©ë‹ˆë‹¤

ğŸ’¡ **ì£¼ìš” í¬ì¸íŠ¸**:
- ì´ë¡ ì  ê·¼ê±°ì™€ ì‹¤ë¬´ ê²½í—˜ì˜ ê²°í•©
- ë‹¨ê³„ë³„ ì ‘ê·¼ì„ í†µí•œ ì²´ê³„ì  í•´ê²°
- ì§€ì† ê°€ëŠ¥í•œ ê°œì„  ë°©ì•ˆ ì œì‹œ

ğŸš€ **ë‹¤ìŒ ë‹¨ê³„**:
êµ¬ì²´ì ì¸ ìƒí™©ì´ë‚˜ ì¶”ê°€ ìš”êµ¬ì‚¬í•­ì„ ì•Œë ¤ì£¼ì‹œë©´ ë”ìš± ë§ì¶¤í˜• ì†”ë£¨ì…˜ì„ ì œê³µí•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.
"""'''

        return f"print({enhanced})"

    def _enhance_solution_text(self, match):
        """ì†”ë£¨ì…˜ í…ìŠ¤íŠ¸ í–¥ìƒ"""
        original = match.group(1).strip('"')

        enhanced = f'''"""
ğŸ¯ **í•´ê²° ë°©ì•ˆ**:

{original}

ğŸ“‹ **ìƒì„¸ ì ‘ê·¼ë²•**:
â€¢ **1ë‹¨ê³„**: ë¬¸ì œ ì •ì˜ ë° í˜„í™© ë¶„ì„
â€¢ **2ë‹¨ê³„**: ë‹¤ì–‘í•œ ì†”ë£¨ì…˜ ì˜µì…˜ ê²€í† 
â€¢ **3ë‹¨ê³„**: ìµœì  ë°©ì•ˆ ì„ ì • ë° ê³„íš ìˆ˜ë¦½
â€¢ **4ë‹¨ê³„**: ë‹¨ê³„ì  ì‹¤í–‰ ë° ëª¨ë‹ˆí„°ë§
â€¢ **5ë‹¨ê³„**: ì„±ê³¼ í‰ê°€ ë° ì§€ì† ê°œì„ 

ğŸ’¡ **ì„±ê³µ ìš”ì¸**:
- ì²´ê³„ì ì´ê³  ë‹¨ê³„ì ì¸ ì ‘ê·¼
- ì´í•´ê´€ê³„ìë“¤ì˜ ì ê·¹ì  ì°¸ì—¬
- ì§€ì†ì ì¸ í”¼ë“œë°±ê³¼ ê°œì„ 
- ë³€í™”ì— ëŒ€í•œ ìœ ì—°í•œ ëŒ€ì‘

ğŸ”„ **ì§€ì†ì  ê°œì„ **:
ì‹¤í–‰ ê³¼ì •ì—ì„œ ì–»ì€ ì¸ì‚¬ì´íŠ¸ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì§€ì†ì ìœ¼ë¡œ ë°©ë²•ë¡ ì„ ê°œì„ í•´ë‚˜ê°‘ë‹ˆë‹¤.
"""'''

        return enhanced

    def _enhance_analysis_text(self, match):
        """ë¶„ì„ í…ìŠ¤íŠ¸ í–¥ìƒ"""
        original = match.group(1).strip('"')

        enhanced = f'''"""
ğŸ” **ì¢…í•© ë¶„ì„**:

{original}

ğŸ“Š **ë¶„ì„ í”„ë ˆì„ì›Œí¬**:
â€¢ **í˜„í™© ì§„ë‹¨**: í˜„ì¬ ìƒíƒœì™€ ì£¼ìš” ì´ìŠˆ íŒŒì•…
â€¢ **í™˜ê²½ ë¶„ì„**: ë‚´ì™¸ë¶€ í™˜ê²½ ìš”ì¸ ê²€í† 
â€¢ **SWOT ë¶„ì„**: ê°•ì , ì•½ì , ê¸°íšŒ, ìœ„í˜‘ ìš”ì†Œ
â€¢ **íŠ¸ë Œë“œ ë¶„ì„**: ì‹œì¥ ë™í–¥ê³¼ ë¯¸ë˜ ì „ë§

ğŸ¯ **í•µì‹¬ ë°œê²¬ì‚¬í•­**:
- ì£¼ìš” ì„±ê³µ ìš”ì¸ê³¼ ì œì•½ ì¡°ê±´ ì‹ë³„
- ì ì¬ì  ë¦¬ìŠ¤í¬ì™€ ê¸°íšŒ ìš”ì†Œ íŒŒì•…
- ìµœì í™” ê°€ëŠ¥í•œ ì˜ì—­ê³¼ ìš°ì„ ìˆœìœ„ ë„ì¶œ

ğŸ’¡ **ì „ë¬¸ê°€ í†µì°°**:
ë°ì´í„° ê¸°ë°˜ ë¶„ì„ê³¼ ì „ë¬¸ê°€ ê²½í—˜ì„ ê²°í•©í•˜ì—¬ ì‹¤í–‰ ê°€ëŠ¥í•œ ì¸ì‚¬ì´íŠ¸ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
"""'''

        return enhanced

    def _enhance_recommendation_text(self, match):
        """ì¶”ì²œ í…ìŠ¤íŠ¸ í–¥ìƒ"""
        original = match.group(1).strip('"')

        enhanced = f'''"""
ğŸ’¡ **ì „ë¬¸ê°€ ì¶”ì²œ**:

{original}

ğŸ¯ **ì¶”ì²œ ê·¼ê±°**:
â€¢ **ë°ì´í„° ê¸°ë°˜**: ê°ê´€ì  ë¶„ì„ ê²°ê³¼ì— ê¸°ë°˜í•œ íŒë‹¨
â€¢ **ê²½í—˜ ê¸°ë°˜**: ìœ ì‚¬ ì‚¬ë¡€ì™€ ì‹¤ë¬´ ê²½í—˜ì„ í†µí•œ ê²€ì¦
â€¢ **ë¯¸ë˜ ì§€í–¥**: ì¥ê¸°ì  ê´€ì ì—ì„œì˜ ì§€ì† ê°€ëŠ¥ì„± ê³ ë ¤

ğŸ“‹ **ì‹¤í–‰ ê°€ì´ë“œë¼ì¸**:
1. **ì¤€ë¹„ ë‹¨ê³„**: í•„ìš” ë¦¬ì†ŒìŠ¤ì™€ ì—­ëŸ‰ í™•ë³´
2. **ì‹¤í–‰ ë‹¨ê³„**: ë‹¨ê³„ë³„ ëª©í‘œì™€ ë§ˆì¼ìŠ¤í†¤ ì„¤ì •
3. **ì ê²€ ë‹¨ê³„**: ì •ê¸°ì  ì„±ê³¼ ë¦¬ë·°ì™€ ì¡°ì •
4. **ë°œì „ ë‹¨ê³„**: ì„±ê³µ ê²½í—˜ í™•ì‚°ê³¼ ê³ ë„í™”

ğŸš€ **ê¸°ëŒ€ íš¨ê³¼**:
- ì¦‰ì‹œ ì ìš© ê°€ëŠ¥í•œ ì‹¤ìš©ì  ì†”ë£¨ì…˜
- ì²´ê³„ì  ì ‘ê·¼ì„ í†µí•œ ë†’ì€ ì„±ê³µë¥ 
- ì§€ì†ì  ê°œì„ ì„ í†µí•œ ì¥ê¸°ì  ê°€ì¹˜ ì°½ì¶œ

ğŸ”„ **í›„ì† ì§€ì›**:
ì‹¤í–‰ ê³¼ì •ì—ì„œ í•„ìš”í•œ ì¶”ê°€ì ì¸ ì¡°ì–¸ê³¼ ì§€ì›ì„ ì§€ì†ì ìœ¼ë¡œ ì œê³µí•´ë“œë¦½ë‹ˆë‹¤.
"""'''

        return enhanced

    def _upgrade_core_file(self, file_path: Path):
        """í•µì‹¬ íŒŒì¼ ì—…ê·¸ë ˆì´ë“œ"""
        try:
            with open(file_path, "r", encoding="utf-8") as f:
                content = f.read()

            # í•µì‹¬ ì—”ì§„ë“¤ì˜ ì‘ë‹µ í’ˆì§ˆ í–¥ìƒ
            enhanced_content = self._enhance_core_responses(content)

            with open(file_path, "w", encoding="utf-8") as f:
                f.write(enhanced_content)

        except Exception as e:
            print(f"âš ï¸ {file_path} ì—…ê·¸ë ˆì´ë“œ ì¤‘ ì˜¤ë¥˜: {e}")

    def _enhance_core_responses(self, content: str) -> str:
        """í•µì‹¬ ì‘ë‹µ í–¥ìƒ"""

        # ì§§ì€ ì‘ë‹µë“¤ì„ ë” ê¸¸ê³  ìƒì„¸í•˜ê²Œ ë§Œë“¤ê¸°
        enhancements = [
            # ìˆ˜í•™ ë¬¸ì œ í•´ê²° í–¥ìƒ
            (
                r'("ìˆ˜í•™ ë¬¸ì œ í•´ê²°ì„ ì‹œë„í–ˆìŠµë‹ˆë‹¤\.")',
                '"ğŸ§® **ê³ ê¸‰ ìˆ˜í•™ ë¬¸ì œ í•´ê²° ê³¼ì •**:\\n\\nğŸ“ **ë¬¸ì œ ë¶„ì„**: ì£¼ì–´ì§„ ìˆ˜í•™ ë¬¸ì œì˜ ìœ í˜•ê³¼ ë³µì¡ë„ë¥¼ ë¶„ì„í–ˆìŠµë‹ˆë‹¤\\nğŸ”¢ **í•´ê²° ì „ëµ**: ìµœì ì˜ ìˆ˜í•™ì  ì ‘ê·¼ë²•ì„ ì„ ì •í–ˆìŠµë‹ˆë‹¤\\nâš¡ **ê³„ì‚° ê³¼ì •**: ë‹¨ê³„ë³„ë¡œ ì •í™•í•œ ê³„ì‚°ì„ ìˆ˜í–‰í–ˆìŠµë‹ˆë‹¤\\nâœ… **ê²€ì¦**: ê²°ê³¼ì˜ ì •í™•ì„±ì„ ë‹¤ê°ë„ë¡œ ê²€ì¦í–ˆìŠµë‹ˆë‹¤\\n\\nğŸ’¡ **ìˆ˜í•™ì  ì¸ì‚¬ì´íŠ¸**: ì´ ë¬¸ì œëŠ” {í•µì‹¬ ê°œë…}ì„ í™œìš©í•œ ì „í˜•ì ì¸ íŒ¨í„´ì…ë‹ˆë‹¤"',
            ),
            # ì¼ë°˜ì ì¸ ì§§ì€ ì‘ë‹µ í–¥ìƒ
            (r'(".*?í•´ê²°.*?")', self._enhance_solution_text),
            (r'(".*?ë¶„ì„.*?")', self._enhance_analysis_text),
        ]

        enhanced_content = content
        for pattern, replacement in enhancements:
            enhanced_content = re.sub(pattern, replacement, enhanced_content)

        return enhanced_content


def main():
    """ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜"""
    print("ğŸ­" * 20)
    print("ğŸš€ ë„ê¹¨ë¹„ ëŒ€í™” í’ˆì§ˆ ì‹¤ì œ ì—…ê·¸ë ˆì´ë“œ ì‹œì‘!")
    print("ğŸ­" * 20)

    upgrader = GoblinResponseUpgrader()

    # 1. STEM ì—ì´ì „íŠ¸ ì—…ê·¸ë ˆì´ë“œ
    upgrader.upgrade_stem_agents()

    # 2. Village Chief ì—ì´ì „íŠ¸ ì—…ê·¸ë ˆì´ë“œ
    upgrader.upgrade_village_chief_agents()

    # 3. í•µì‹¬ ì—”ì§„ ì—…ê·¸ë ˆì´ë“œ
    upgrader.upgrade_core_engines()

    print("\n" + "ğŸ‰" * 20)
    print("âœ… ëª¨ë“  ë„ê¹¨ë¹„ ëŒ€í™” í’ˆì§ˆ ì—…ê·¸ë ˆì´ë“œ ì™„ë£Œ!")
    print("ì´ì œ ë„ê¹¨ë¹„ë“¤ì´ í›¨ì”¬ ë” ê¸¸ê³  êµ¬ì²´ì ì´ê³  ì „ë¬¸ì ìœ¼ë¡œ ëŒ€ë‹µí•  ê±°ì˜ˆìš”! ğŸ˜„")
    print("ğŸ‰" * 20)


if __name__ == "__main__":
    main()

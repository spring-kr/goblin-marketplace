<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🤖 16명 전문가 자동 테스트</title>
    <style>
        body {
            font-family: 'Malgun Gothic', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            color: white;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
        }
        .title {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .controls {
            text-align: center;
            margin-bottom: 30px;
        }
        .btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border: none;
            color: white;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 25px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .progress {
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            padding: 10px;
            margin: 20px 0;
            text-align: center;
        }
        .expert-result {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            border-left: 5px solid #4ecdc4;
        }
        .expert-name {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
        }
        .question-result {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }
        .success { border-left-color: #2ecc71; }
        .error { border-left-color: #e74c3c; }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .stat-card {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #4ecdc4;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">🤖 16명 박사급 전문가 자동 테스트</h1>
        
        <div class="controls">
            <button class="btn" onclick="startQuickTest()">🚀 빠른 테스트 (5명)</button>
            <button class="btn" onclick="startFullTest()">🔥 전체 테스트 (16명)</button>
            <button class="btn" onclick="clearResults()">🗑️ 결과 초기화</button>
        </div>
        
        <div class="progress" id="progress" style="display:none;">
            <div id="progressText">테스트 준비 중...</div>
            <div id="progressBar" style="background: #4ecdc4; height: 10px; border-radius: 5px; width: 0%; margin-top: 10px; transition: width 0.3s;"></div>
        </div>
        
        <div id="results"></div>
        
        <div class="stats" id="stats" style="display:none;">
            <div class="stat-card">
                <div class="stat-number" id="totalQuestions">0</div>
                <div>총 질문 수</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="successRate">0%</div>
                <div>성공률</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="avgQuality">0</div>
                <div>평균 품질</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalTime">0s</div>
                <div>총 소요시간</div>
            </div>
        </div>
    </div>

    <script>
        const experts = {
            medical: { name: "의학박사 하이진 🏥", questions: ["당뇨 환자의 혈당 관리 식단 3가지 핵심 원칙은?", "고혈압 140/90에서 약물 없이 개선하는 방법?"] },
            financial: { name: "경제학박사 부자진 💰", questions: ["월급 300만원으로 주택청약과 주식투자 비율 추천?", "ISA계좌 vs 연금저축 세제혜택 비교 분석?"] },
            tech: { name: "공학박사 테크진 🔧", questions: ["마이크로서비스에서 API Gateway vs Service Mesh 차이점?", "React 18 Concurrent Features 실무 활용법?"] },
            creative: { name: "예술학박사 창작진 🎨", questions: ["브랜드 로고 디자인시 색채 심리학 활용법?", "소설 플롯의 3막 구조와 갈등 설정 방법?"] },
            marketing: { name: "마케팅박사 마진 📈", questions: ["Z세대 타겟 SNS 마케팅 플랫폼별 전략?", "B2B 영업에서 고객 페인포인트 발굴 방법?"] }
        };

        const allExperts = {
            medical: { name: "의학박사 하이진 🏥", questions: ["당뇨 환자의 혈당 관리 식단 3가지 핵심 원칙은?", "고혈압 140/90에서 약물 없이 개선하는 방법?", "갱년기 여성의 호르몬 변화와 대처법은?"] },
            financial: { name: "경제학박사 부자진 💰", questions: ["월급 300만원으로 주택청약과 주식투자 비율 추천?", "ISA계좌 vs 연금저축 세제혜택 비교 분석?", "인플레이션 시대 자산배분 전략은?"] },
            legal: { name: "법학박사 로진 ⚖️", questions: ["임대차 보증금 반환 거부시 법적 대응 절차?", "직장 내 성희롱 피해 시 증거 수집과 신고 방법?"] },
            tech: { name: "공학박사 테크진 🔧", questions: ["마이크로서비스에서 API Gateway vs Service Mesh 차이점?", "React 18 Concurrent Features 실무 활용법?", "Docker 컨테이너 보안 강화 5가지 방법?"] },
            creative: { name: "예술학박사 창작진 🎨", questions: ["브랜드 로고 디자인시 색채 심리학 활용법?", "소설 플롯의 3막 구조와 갈등 설정 방법?"] },
            marketing: { name: "마케팅박사 마진 📈", questions: ["Z세대 타겟 SNS 마케팅 플랫폼별 전략?", "B2B 영업에서 고객 페인포인트 발굴 방법?"] },
            education: { name: "교육학박사 가르진 🎓", questions: ["성인 학습자의 기억력 향상 학습법 3가지?", "온라인 강의에서 집중력 유지하는 방법?"] },
            hr: { name: "인사관리박사 인재진 👥", questions: ["리모트워크 시대 팀 성과 평가 기준?", "신입사원 온보딩 프로그램 설계 핵심 요소?"] },
            sales: { name: "경영학박사 세일진 💼", questions: ["B2B 고객사 의사결정자 접근 전략?", "거절 고객을 설득하는 네고시에이션 기법?"] },
            research: { name: "연구박사 탐구진 🔬", questions: ["정성 연구와 정량 연구의 혼합 방법론 설계?", "설문조사 응답률 향상을 위한 인센티브 전략?"] },
            translation: { name: "언어학박사 번역진 🌍", questions: ["기술 문서 번역시 전문용어 일관성 유지법?", "문화적 뉘앙스가 있는 표현의 현지화 전략?"] },
            consulting: { name: "컨설팅박사 조언진 💡", questions: ["중소기업 디지털 전환 로드맵 수립 방법?", "조직 변화 관리에서 저항 극복 전략?"] },
            psychology: { name: "심리학박사 마음진 🧠", questions: ["직장 스트레스로 인한 번아웃 예방법?", "대인관계에서 경계 설정하는 방법?"] },
            data: { name: "데이터박사 분석진 📊", questions: ["머신러닝 모델의 과적합 방지 전략?", "A/B 테스트 설계시 통계적 유의성 확보법?"] },
            startup: { name: "창업박사 벤처진 🚀", questions: ["스타트업 초기 팀 구성과 지분 배분 원칙?", "MVP 개발후 시장 검증 방법론?"] },
            wellness: { name: "웰니스박사 건강진 🌿", questions: ["현대인의 수면 질 향상을 위한 생활 습관?", "스마트폰 중독 예방과 디지털 디톡스 방법?"] }
        };

        let testResults = [];
        let isTestRunning = false;

        async function askExpert(expertType, question) {
            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ agent_type: expertType, message: question })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    return { success: true, response: result.response };
                } else {
                    return { success: false, error: `HTTP ${response.status}` };
                }
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        function evaluateQuality(response) {
            if (!response) return 0;
            let score = 5;
            if (response.length > 200) score += 1;
            if (response.length > 400) score += 1;
            const professionalWords = ['전문가', '추천', '방법', '전략', '분석', '중요', '핵심', '효과적'];
            if (professionalWords.some(word => response.includes(word))) score += 1;
            const specificWords = ['단계', '절차', '기법', '원칙', '조건', '요소', '사례', '예시'];
            if (specificWords.some(word => response.includes(word))) score += 1;
            return Math.min(score, 10);
        }

        async function runTest(expertsToTest) {
            if (isTestRunning) return;
            isTestRunning = true;
            
            const progress = document.getElementById('progress');
            const progressText = document.getElementById('progressText');
            const progressBar = document.getElementById('progressBar');
            const results = document.getElementById('results');
            
            progress.style.display = 'block';
            results.innerHTML = '';
            
            let totalQuestions = 0;
            Object.values(expertsToTest).forEach(expert => totalQuestions += expert.questions.length);
            
            let currentQuestion = 0;
            const startTime = Date.now();
            testResults = [];
            
            for (const [expertType, expertData] of Object.entries(expertsToTest)) {
                const expertDiv = document.createElement('div');
                expertDiv.className = 'expert-result';
                expertDiv.innerHTML = `<div class="expert-name">${expertData.name}</div>`;
                results.appendChild(expertDiv);
                
                for (let i = 0; i < expertData.questions.length; i++) {
                    const question = expertData.questions[i];
                    currentQuestion++;
                    
                    progressText.textContent = `${expertData.name} - 질문 ${i+1}/${expertData.questions.length}`;
                    progressBar.style.width = `${(currentQuestion / totalQuestions) * 100}%`;
                    
                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'question-result';
                    questionDiv.innerHTML = `<strong>질문:</strong> ${question}<br><em>응답 대기 중...</em>`;
                    expertDiv.appendChild(questionDiv);
                    
                    const startQuestionTime = Date.now();
                    const result = await askExpert(expertType, question);
                    const questionTime = Date.now() - startQuestionTime;
                    
                    if (result.success) {
                        const quality = evaluateQuality(result.response);
                        questionDiv.className = 'question-result success';
                        questionDiv.innerHTML = `
                            <strong>질문:</strong> ${question}<br>
                            <strong>응답시간:</strong> ${(questionTime/1000).toFixed(1)}초 | <strong>품질:</strong> ${quality}/10<br>
                            <strong>응답:</strong> ${result.response.substring(0, 200)}${result.response.length > 200 ? '...' : ''}
                        `;
                        testResults.push({ success: true, quality, time: questionTime });
                    } else {
                        questionDiv.className = 'question-result error';
                        questionDiv.innerHTML = `
                            <strong>질문:</strong> ${question}<br>
                            <strong>오류:</strong> ${result.error}
                        `;
                        testResults.push({ success: false, time: questionTime });
                    }
                    
                    await new Promise(resolve => setTimeout(resolve, 500));
                }
            }
            
            const totalTime = Date.now() - startTime;
            progressText.textContent = '테스트 완료!';
            progressBar.style.width = '100%';
            
            updateStats(totalTime);
            isTestRunning = false;
        }

        function updateStats(totalTime) {
            const stats = document.getElementById('stats');
            const successCount = testResults.filter(r => r.success).length;
            const successRate = testResults.length > 0 ? (successCount / testResults.length * 100) : 0;
            const avgQuality = successCount > 0 ? testResults.filter(r => r.success).reduce((sum, r) => sum + r.quality, 0) / successCount : 0;
            
            document.getElementById('totalQuestions').textContent = testResults.length;
            document.getElementById('successRate').textContent = `${successRate.toFixed(0)}%`;
            document.getElementById('avgQuality').textContent = avgQuality.toFixed(1);
            document.getElementById('totalTime').textContent = `${(totalTime/1000).toFixed(0)}s`;
            
            stats.style.display = 'grid';
        }

        function startQuickTest() {
            runTest(experts);
        }

        function startFullTest() {
            runTest(allExperts);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
            document.getElementById('progress').style.display = 'none';
            document.getElementById('stats').style.display = 'none';
            testResults = [];
        }
    </script>
</body>
</html>

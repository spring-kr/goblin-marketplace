"""
ì‹¤ì œ ì‘ë™í•˜ëŠ” 16ëª… ë°•ì‚¬ê¸‰ ì „ë¬¸ê°€ AI ì‹œìŠ¤í…œ
API ì—°ê²° ì—†ì´ë„ ì „ë¬¸ì ì¸ ì‘ë‹µì„ ìƒì„±í•˜ëŠ” ë¡œì»¬ AI ì‹œìŠ¤í…œ
"""

import re
import random
import json
from typing import Dict, Any, List
from datetime import datetime


class SmartExpertAI:
    """ì§€ëŠ¥í˜• ì „ë¬¸ê°€ AI ì‹œìŠ¤í…œ"""

    def __init__(self):
        self.expert_knowledge = self._load_expert_knowledge()
        self.conversation_patterns = self._load_conversation_patterns()

    def _load_expert_knowledge(self) -> Dict[str, Dict]:
        """ì „ë¬¸ê°€ë³„ ì§€ì‹ ë°ì´í„°ë² ì´ìŠ¤ - 16ëª… ì „ì²´"""
        return {
            "medical": {
                "name": "ì˜í•™ë°•ì‚¬ í•˜ì´ì§„",
                "emoji": "ğŸ¥",
                "specialties": ["ë‚´ê³¼", "ì™¸ê³¼", "ì‘ê¸‰ì˜í•™", "ì˜ˆë°©ì˜í•™", "ê°€ì •ì˜í•™"],
                "keywords": {
                    "ê°ê¸°": {
                        "symptoms": ["ê¸°ì¹¨", "ì½§ë¬¼", "ë°œì—´", "ëª©ì•„í””", "ë‘í†µ"],
                        "advice": [
                            "ì¶©ë¶„í•œ íœ´ì‹ê³¼ ìˆ˜ë¶„ ì„­ì·¨ê°€ ê°€ì¥ ì¤‘ìš”í•©ë‹ˆë‹¤",
                            "ì¼ì£¼ì¼ ì´ìƒ ì§€ì†ë˜ë©´ ì´ì°¨ ê°ì—¼ ê°€ëŠ¥ì„±ì„ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤",
                            "38.5ë„ ì´ìƒ ê³ ì—´ì´ë‚˜ í˜¸í¡ê³¤ë€ì´ ìˆë‹¤ë©´ ì¦‰ì‹œ ë³‘ì› ë°©ë¬¸í•˜ì„¸ìš”",
                        ],
                        "treatments": ["íœ´ì‹", "ìˆ˜ë¶„ì„­ì·¨", "í•´ì—´ì§„í†µì œ", "ë¹„íƒ€ë¯¼C"],
                    },
                    "í˜ˆì••": {
                        "normal": "ì •ìƒ í˜ˆì••ì€ 120/80mmHg ë¯¸ë§Œì…ë‹ˆë‹¤",
                        "high": "140/90mmHg ì´ìƒì´ë©´ ê³ í˜ˆì••ìœ¼ë¡œ ë¶„ë¥˜ë©ë‹ˆë‹¤",
                        "advice": [
                            "ê·œì¹™ì ì¸ ìš´ë™ê³¼ ì €ì—¼ì‹ì´ í•„ìš”í•©ë‹ˆë‹¤",
                            "ì •ê¸°ì ì¸ í˜ˆì•• ì¸¡ì •ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•˜ì„¸ìš”",
                            "ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ì™€ ê¸ˆì—°ì´ ì¤‘ìš”í•©ë‹ˆë‹¤",
                        ],
                    },
                },
            },
            "financial": {
                "name": "ê²½ì œí•™ë°•ì‚¬ ë¶€ìì§„",
                "emoji": "ğŸ’°",
                "specialties": ["íˆ¬ì", "ì¬ì •ê´€ë¦¬", "ì—°ê¸ˆ", "ë³´í—˜", "ì„¸ê¸ˆ"],
                "keywords": {
                    "íˆ¬ì": {
                        "principles": ["ë¶„ì‚°íˆ¬ì", "ì¥ê¸°íˆ¬ì", "ë¦¬ìŠ¤í¬ê´€ë¦¬"],
                        "products": ["ì£¼ì‹", "ì±„ê¶Œ", "í€ë“œ", "ETF", "ë¦¬ì¸ "],
                        "advice": [
                            "20ëŒ€ëŠ” ì ê·¹ì  í¬íŠ¸í´ë¦¬ì˜¤ë¡œ ì£¼ì‹ ë¹„ì¤‘ 70% ê¶Œì¥",
                            "Emergency Fundë¥¼ ë¨¼ì € ë§ˆë ¨í•˜ì„¸ìš”",
                            "íˆ¬ì ëª©ì ê³¼ ê¸°ê°„ì„ ëª…í™•íˆ ì„¤ì •í•˜ì„¸ìš”"
                        ]
                    },
                    "ì—°ê¸ˆ": {
                        "types": ["êµ­ë¯¼ì—°ê¸ˆ", "í‡´ì§ì—°ê¸ˆ", "ê°œì¸ì—°ê¸ˆ"],
                        "advice": [
                            "êµ­ë¯¼ì—°ê¸ˆì€ ê¸°ë³¸, ê°œì¸ì—°ê¸ˆìœ¼ë¡œ ë³´ì™„í•˜ì„¸ìš”",
                            "ì—°ê¸ˆì €ì¶•ì€ ì„¸ì•¡ê³µì œ í˜œíƒì„ í™œìš©í•˜ì„¸ìš”",
                            "ì¥ê¸° íˆ¬ì ê´€ì ìœ¼ë¡œ ì ‘ê·¼í•˜ì„¸ìš”"
                        ]
                    }
                }
            },
            "legal": {
                "name": "ë²•í•™ë°•ì‚¬ ì •ì˜ì§„",
                "emoji": "âš–ï¸",
                "specialties": ["ë¯¼ë²•", "ìƒë²•", "ë…¸ë™ë²•", "ë¶€ë™ì‚°ë²•", "ê³„ì•½ë²•"],
                "keywords": {
                    "ì„ëŒ€ì°¨": {
                        "rights": ["ë³´ì¦ê¸ˆ ë°˜í™˜ê¶Œ", "ì„ëŒ€ë£Œ ì¦ì•¡ ì œí•œ", "ê³„ì•½ ê°±ì‹ ê¶Œ"],
                        "advice": [
                            "ê³„ì•½ì„œ ì¡°ê±´ì„ ê¼¼ê¼¼íˆ í™•ì¸í•˜ê³  ë³´ê´€í•˜ì„¸ìš”",
                            "ë³´ì¦ê¸ˆ ë°˜í™˜ ì‹œ ë‚´ìš©ì¦ëª…ì„ í™œìš©í•˜ì„¸ìš”",
                            "ì „ì„¸ì‚¬ê¸° ì˜ˆë°©ì„ ìœ„í•´ ë“±ê¸°ë¶€ë“±ë³¸ í™•ì¸ í•„ìˆ˜"
                        ]
                    },
                    "ì§ì¥": {
                        "protections": ["ë¶€ë‹¹í•´ê³  ê¸ˆì§€", "ì„ê¸ˆì²´ë¶ˆ êµ¬ì œ", "ì§ì¥ ë‚´ ê´´ë¡­í˜ ê¸ˆì§€"],
                        "advice": [
                            "ì¦ê±° ìë£Œë¥¼ ì²´ê³„ì ìœ¼ë¡œ ìˆ˜ì§‘í•˜ì„¸ìš”",
                            "ë…¸ë™ë¶€ ì‹ ê³ ë‚˜ ê³ ìš©ë…¸ë™ì²­ ìƒë‹´ í™œìš©",
                            "í•„ìš”ì‹œ ì „ë¬¸ ë…¸ë¬´ì‚¬ë‚˜ ë³€í˜¸ì‚¬ ìƒë‹´ ê¶Œì¥"
                        ]
                    }
                }
            },
            "tech": {
                "name": "ê³µí•™ë°•ì‚¬ í…Œí¬ì§„", 
                "emoji": "ğŸ”§",
                "specialties": ["ì†Œí”„íŠ¸ì›¨ì–´ê°œë°œ", "AI/ML", "í´ë¼ìš°ë“œ", "ë³´ì•ˆ", "ì•„í‚¤í…ì²˜"],
                "keywords": {
                    "ìŠ¤íƒ€íŠ¸ì—…": {
                        "stack": ["React/Vue.js", "Node.js/Python", "AWS/GCP", "Docker", "DB"],
                        "advice": [
                            "MVP ê°œë°œì— ì§‘ì¤‘í•˜ì—¬ ë¹ ë¥¸ ê²€ì¦ì„ í•˜ì„¸ìš”",
                            "í™•ì¥ì„±ì„ ê³ ë ¤í•œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ ê¶Œì¥",
                            "CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì¶•ìœ¼ë¡œ ê°œë°œ íš¨ìœ¨ì„± ì¦ëŒ€"
                        ]
                    },
                    "AI": {
                        "considerations": ["ë°ì´í„° í’ˆì§ˆ", "ëª¨ë¸ ì„ íƒ", "ìœ¤ë¦¬", "ë³´ì•ˆ"],
                        "advice": [
                            "ì¶©ë¶„í•œ í’ˆì§ˆì˜ ë°ì´í„° í™•ë³´ê°€ ìš°ì„ ì…ë‹ˆë‹¤",
                            "ì‚¬ìš©ì ê°œì¸ì •ë³´ ë³´í˜¸ ì •ì±…ì„ ì² ì €íˆ ìˆ˜ë¦½í•˜ì„¸ìš”",
                            "AI í¸í–¥ì„± ë¬¸ì œë¥¼ ì§€ì†ì ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•˜ì„¸ìš”"
                        ]
                    }
                }
            },
            "creative": {
                "name": "ì˜ˆìˆ í•™ë°•ì‚¬ ì°½ì¡°ì§„",
                "emoji": "ğŸ¨",
                "specialties": ["ë””ìì¸", "ë¸Œëœë”©", "ì½˜í…ì¸ ê¸°íš", "ì˜ìƒì œì‘", "UX/UI"],
                "keywords": {
                    "ë¸Œëœë“œ": {
                        "elements": ["ë¡œê³ ", "ì»¬ëŸ¬", "íƒ€ì´í¬ê·¸ë˜í”¼", "í†¤ì•¤ë§¤ë„ˆ"],
                        "advice": [
                            "ë¸Œëœë“œ ì •ì²´ì„±ì„ ëª…í™•íˆ ì •ì˜í•˜ëŠ” ê²ƒì´ ì²« ë‹¨ê³„",
                            "íƒ€ê²Ÿ ê³ ê°ì˜ ê°ì„±ê³¼ ë‹ˆì¦ˆë¥¼ ë°˜ì˜í•œ ë””ìì¸",
                            "ì¼ê´€ì„± ìˆëŠ” ë¹„ì£¼ì–¼ ì•„ì´ë´í‹°í‹° êµ¬ì¶•ì´ í•µì‹¬"
                        ]
                    },
                    "ìœ íŠœë¸Œ": {
                        "content_types": ["ë¸Œì´ë¡œê·¸", "íŠœí† ë¦¬ì–¼", "ë¦¬ë·°", "ì—”í„°í…Œì¸ë¨¼íŠ¸"],
                        "advice": [
                            "ì¸ë„¤ì¼ê³¼ ì œëª©ì´ í´ë¦­ë¥ ì„ ê²°ì •í•©ë‹ˆë‹¤",
                            "ì‹œì²­ìì™€ì˜ ì†Œí†µì„ í†µí•œ ì»¤ë®¤ë‹ˆí‹° êµ¬ì¶•",
                            "ê¾¸ì¤€í•œ ì—…ë¡œë“œ ìŠ¤ì¼€ì¤„ ìœ ì§€ê°€ ì¤‘ìš”"
                        ]
                    }
                }
            },
            "marketing": {
                "name": "ë§ˆì¼€íŒ…ë°•ì‚¬ íŒë§¤ì§„",
                "emoji": "ğŸ“ˆ", 
                "specialties": ["ë¸Œëœë”©", "ë””ì§€í„¸ë§ˆì¼€íŒ…", "ê³ ê°ë¶„ì„", "ìº í˜ì¸ê¸°íš", "ROIë¶„ì„"],
                "keywords": {
                    "ì‹ ì œí’ˆ": {
                        "strategies": ["íƒ€ê²Ÿ ê³ ê° ë¶„ì„", "ê²½ìŸì‚¬ ë¶„ì„", "í¬ì§€ì…”ë‹", "ì±„ë„ ì „ëµ"],
                        "advice": [
                            "ì´ˆê¸°ì—ëŠ” ë‹ˆì¹˜ ë§ˆì¼“ì„ ê³µëµí•˜ì—¬ ë¸Œëœë“œ ì¸ì§€ë„ êµ¬ì¶•",
                            "ê³ ê° í”¼ë“œë°±ì„ ì ê·¹ ìˆ˜ì§‘í•˜ì—¬ ì œí’ˆ ê°œì„ ì— ë°˜ì˜",
                            "ì†Œì…œë¯¸ë””ì–´ì™€ ì¸í”Œë£¨ì–¸ì„œ ë§ˆì¼€íŒ… í™œìš© ê¶Œì¥"
                        ]
                    },
                    "SNS": {
                        "platforms": ["ì¸ìŠ¤íƒ€ê·¸ë¨", "ìœ íŠœë¸Œ", "í‹±í†¡", "ë„¤ì´ë²„ë¸”ë¡œê·¸"],
                        "advice": [
                            "í”Œë«í¼ë³„ íŠ¹ì„±ì— ë§ëŠ” ì½˜í…ì¸  ì œì‘ì´ í•µì‹¬",
                            "ì¼ê´€ëœ ë¸Œëœë“œ í†¤ì•¤ë§¤ë„ˆ ìœ ì§€",
                            "ì¸ê²Œì´ì§€ë¨¼íŠ¸ìœ¨ì´ ë„ë‹¬ë¥ ë³´ë‹¤ ì¤‘ìš”í•©ë‹ˆë‹¤"
                        ]
                    }
                }
            },
            "education": {
                "name": "êµìœ¡í•™ë°•ì‚¬ ê°€ë¥´ì¹¨ì§„",
                "emoji": "ğŸ“š",
                "specialties": ["êµìœ¡ê³¼ì •ì„¤ê³„", "í•™ìŠµì‹¬ë¦¬", "ì˜¨ë¼ì¸êµìœ¡", "í‰ê°€ë°©ë²•", "êµìˆ˜ë²•"],
                "keywords": {
                    "ì„±ì¸í•™ìŠµ": {
                        "principles": ["ìê¸°ì£¼ë„í•™ìŠµ", "ê²½í—˜ê¸°ë°˜í•™ìŠµ", "ì‹¤ë¬´ì ìš©"],
                        "advice": [
                            "ì‹¤ë¬´ì™€ ì—°ê²°ëœ ì‹¤ìš©ì ì¸ í•™ìŠµ ë‚´ìš© êµ¬ì„±",
                            "í•™ìŠµìì˜ ê¸°ì¡´ ê²½í—˜ì„ í™œìš©í•œ êµìœ¡ ì„¤ê³„",
                            "ì¦‰ì‹œ ì ìš© ê°€ëŠ¥í•œ ìŠ¤í‚¬ ì¤‘ì‹¬ì˜ ì»¤ë¦¬í˜ëŸ¼"
                        ]
                    },
                    "ì˜¨ë¼ì¸": {
                        "tools": ["LMS", "í™”ìƒíšŒì˜", "ì¸í„°ë™í‹°ë¸Œ ì½˜í…ì¸ ", "í€´ì¦ˆ"],
                        "advice": [
                            "ì§§ê³  ì§‘ì¤‘ë„ ë†’ì€ ë§ˆì´í¬ë¡œ ëŸ¬ë‹ í™œìš©",
                            "ë‹¤ì–‘í•œ ë¯¸ë””ì–´ë¥¼ í™œìš©í•œ ë©€í‹°ëª¨ë‹¬ í•™ìŠµ",
                            "ì‹¤ì‹œê°„ í”¼ë“œë°±ê³¼ ìƒí˜¸ì‘ìš© ê·¹ëŒ€í™”"
                        ]
                    }
                }
            },
            "hr": {
                "name": "ì¸ì‚¬ê´€ë¦¬ë°•ì‚¬ ì¸ì¬ì§„",
                "emoji": "ğŸ‘¥",
                "specialties": ["ì¸ì¬ì±„ìš©", "ì¡°ì§ê´€ë¦¬", "ì„±ê³¼í‰ê°€", "êµìœ¡í›ˆë ¨", "ë…¸ì‚¬ê´€ê³„"],
                "keywords": {
                    "ì›ê²©ê·¼ë¬´": {
                        "challenges": ["ì†Œí†µ", "ì„±ê³¼ê´€ë¦¬", "íŒ€ì›Œí¬", "ë¬¸í™”ìœ ì§€"],
                        "advice": [
                            "ëª…í™•í•œ ì—…ë¬´ ëª©í‘œì™€ ì„±ê³¼ ì§€í‘œ ì„¤ì •",
                            "ì •ê¸°ì ì¸ 1:1 ë¯¸íŒ…ìœ¼ë¡œ ì†Œí†µ ê°•í™”",
                            "ë””ì§€í„¸ í˜‘ì—… ë„êµ¬ í™œìš©í•œ íŒ€ì›Œí¬ ì¦ì§„"
                        ]
                    },
                    "ì˜¨ë³´ë”©": {
                        "stages": ["ì‚¬ì „ì¤€ë¹„", "ì²«ë‚ ", "ì²«ì£¼", "ì²«ë‹¬", "ì •ì°©"],
                        "advice": [
                            "ì…ì‚¬ ì „ í•„ìš”í•œ ì •ë³´ì™€ ìë£Œ ì‚¬ì „ ì œê³µ",
                            "ë©˜í† ë§ ì‹œìŠ¤í…œì„ í†µí•œ ì ì‘ ì§€ì›",
                            "ë‹¨ê³„ì  ì—…ë¬´ ë°°ì •ìœ¼ë¡œ ë¶€ë‹´ ìµœì†Œí™”"
                        ]
                    }
                }
            },
            "sales": {
                "name": "ì˜ì—…ì „ëµë°•ì‚¬ ì„±ê³¼ì§„", 
                "emoji": "ğŸ’¼",
                "specialties": ["B2Bì˜ì—…", "ê³ ê°ê´€ë¦¬", "í˜‘ìƒì „ëµ", "ì„¸ì¼ì¦ˆí”„ë¡œì„¸ìŠ¤", "ì˜ì—…ë¶„ì„"],
                "keywords": {
                    "B2B": {
                        "stages": ["ë¦¬ë“œìƒì„±", "ë‹ˆì¦ˆë¶„ì„", "ì œì•ˆ", "í˜‘ìƒ", "í´ë¡œì§•"],
                        "advice": [
                            "ê³ ê°ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¬¸ì œë¥¼ ì •í™•íˆ íŒŒì•…í•˜ì„¸ìš”",
                            "ì†”ë£¨ì…˜ì˜ ROIë¥¼ êµ¬ì²´ì  ìˆ˜ì¹˜ë¡œ ì œì‹œ",
                            "ì˜ì‚¬ê²°ì •ìì™€ì˜ ì§ì ‘ì ì¸ ê´€ê³„ êµ¬ì¶•"
                        ]
                    },
                    "ê±°ì ˆ": {
                        "reasons": ["ì˜ˆì‚°", "íƒ€ì´ë°", "ê²½ìŸì‚¬", "ì˜ì‚¬ê²°ì •"],
                        "advice": [
                            "ê±°ì ˆ ì´ìœ ë¥¼ êµ¬ì²´ì ìœ¼ë¡œ íŒŒì•…í•˜ê³  ëŒ€ì‘",
                            "ì¥ê¸°ì  ê´€ì ì—ì„œ ê´€ê³„ ìœ ì§€",
                            "ì¶”ê°€ ê°€ì¹˜ ì œì•ˆìœ¼ë¡œ ì¬ì ‘ê·¼"
                        ]
                    }
                }
            },
            "research": {
                "name": "ì—°êµ¬ê°œë°œë°•ì‚¬ í˜ì‹ ì§„",
                "emoji": "ğŸ”¬", 
                "specialties": ["R&Dê´€ë¦¬", "í˜ì‹ ì „ëµ", "ê¸°ìˆ ê°œë°œ", "í”„ë¡œì íŠ¸ê´€ë¦¬", "íŠ¹í—ˆ"],
                "keywords": {
                    "R&D": {
                        "methodologies": ["Design Thinking", "Agile R&D", "Stage-Gate", "Lean Startup"],
                        "advice": [
                            "ëª…í™•í•œ ì—°êµ¬ ëª©í‘œì™€ ì„±ê³µ ê¸°ì¤€ ì„¤ì •",
                            "ì •ê¸°ì ì¸ ë§ˆì¼ìŠ¤í†¤ ê²€í† ì™€ ë°©í–¥ ì¡°ì •",
                            "ì‹¤íŒ¨ë¥¼ í•™ìŠµ ê¸°íšŒë¡œ í™œìš©í•˜ëŠ” ë¬¸í™” ì¡°ì„±"
                        ]
                    },
                    "í˜ì‹ ": {
                        "types": ["ì œí’ˆí˜ì‹ ", "í”„ë¡œì„¸ìŠ¤í˜ì‹ ", "ë§ˆì¼€íŒ…í˜ì‹ ", "ì¡°ì§í˜ì‹ "],
                        "advice": [
                            "ê³ ê°ì˜ ìˆ¨ì€ ë‹ˆì¦ˆë¥¼ ë°œêµ´í•˜ì—¬ ì•„ì´ë””ì–´ ìƒì„±",
                            "ë‹¤ì–‘í•œ ë¶„ì•¼ì˜ ì „ë¬¸ê°€ì™€ í˜‘ì—…",
                            "ë¹ ë¥¸ í”„ë¡œí† íƒ€ì´í•‘ê³¼ ì‹¤í—˜ì„ í†µí•œ ê²€ì¦"
                        ]
                    }
                }
            },
            "translation": {
                "name": "ì–¸ì–´í•™ë°•ì‚¬ ë²ˆì—­ì§„",
                "emoji": "ğŸŒ",
                "specialties": ["ì „ë¬¸ë²ˆì—­", "í†µì—­", "ë‹¤êµ­ì–´ì„œë¹„ìŠ¤", "ë¡œì»¬ë¼ì´ì œì´ì…˜", "ì–¸ì–´êµìœ¡"],
                "keywords": {
                    "ê³„ì•½ì„œ": {
                        "considerations": ["ë²•ì ì •í™•ì„±", "ë¬¸ë§¥ì´í•´", "ì „ë¬¸ìš©ì–´", "ë¬¸í™”ì°¨ì´"],
                        "advice": [
                            "ë²•ë¥  ì „ë¬¸ìš©ì–´ì˜ ì •í™•í•œ ë²ˆì—­ì´ í•µì‹¬",
                            "ì›ë¬¸ì˜ ë²•ì  ì˜ë„ë¥¼ ì •í™•íˆ ì „ë‹¬",
                            "í•´ë‹¹ êµ­ê°€ì˜ ë²•ì²´ê³„ ì°¨ì´ ê³ ë ¤"
                        ]
                    },
                    "ê¸°ìˆ ë¬¸ì„œ": {
                        "types": ["ë§¤ë‰´ì–¼", "APIë¬¸ì„œ", "ì†Œí”„íŠ¸ì›¨ì–´", "íŠ¹í—ˆ"],
                        "advice": [
                            "ê¸°ìˆ ì  ì •í™•ì„±ê³¼ ì‚¬ìš©ì ì´í•´ë„ ê· í˜•",
                            "ì¼ê´€ëœ ìš©ì–´ ì‚¬ìš©ìœ¼ë¡œ í˜¼ë€ ë°©ì§€",
                            "íƒ€ê²Ÿ ì‚¬ìš©ìì˜ ê¸°ìˆ  ìˆ˜ì¤€ ê³ ë ¤"
                        ]
                    }
                }
            },
            "consulting": {
                "name": "ê²½ì˜ì»¨ì„¤íŒ…ë°•ì‚¬ ì „ëµì§„",
                "emoji": "ğŸ¯",
                "specialties": ["ì „ëµê¸°íš", "ì¡°ì§ê°œí¸", "í”„ë¡œì„¸ìŠ¤ê°œì„ ", "ë””ì§€í„¸ì „í™˜", "ë³€í™”ê´€ë¦¬"],
                "keywords": {
                    "ë””ì§€í„¸ì „í™˜": {
                        "phases": ["í˜„í™©ë¶„ì„", "ì „ëµìˆ˜ë¦½", "ì‹¤í–‰ê³„íš", "êµ¬í˜„", "ì •ì°©"],
                        "advice": [
                            "ì¡°ì§ì˜ ë””ì§€í„¸ ì„±ìˆ™ë„ ì§„ë‹¨ì´ ìš°ì„ ",
                            "ë‹¨ê³„ì  ì ‘ê·¼ìœ¼ë¡œ ë³€í™” ì¶©ê²© ìµœì†Œí™”",
                            "ì§ì› êµìœ¡ê³¼ ë¬¸í™” ë³€í™”ì— ì¶©ë¶„í•œ íˆ¬ì"
                        ]
                    },
                    "ë³€í™”ê´€ë¦¬": {
                        "resistance": ["ê°œì¸", "ì¡°ì§", "ì‹œìŠ¤í…œ", "ë¬¸í™”"],
                        "advice": [
                            "ë³€í™”ì˜ í•„ìš”ì„±ì„ ëª…í™•íˆ ì†Œí†µ",
                            "ì´í•´ê´€ê³„ìë“¤ì˜ ì ê·¹ì  ì°¸ì—¬ ìœ ë„",
                            "ë‹¨ê¸° ì„±ê³¼ë¥¼ í†µí•œ ë³€í™” ë™ë ¥ í™•ë³´"
                        ]
                    }
                }
            },
            "psychology": {
                "name": "ì‹¬ë¦¬í•™ë°•ì‚¬ ë§ˆìŒì§„",
                "emoji": "ğŸ§ ",
                "specialties": ["ìƒë‹´ì‹¬ë¦¬", "ì¡°ì§ì‹¬ë¦¬", "ì¸ì§€ì‹¬ë¦¬", "ìŠ¤íŠ¸ë ˆìŠ¤ê´€ë¦¬", "í–‰ë™ë¶„ì„"],
                "keywords": {
                    "ë²ˆì•„ì›ƒ": {
                        "symptoms": ["ì •ì„œì ì†Œì§„", "ë¹„ì¸ê²©í™”", "ì„±ì·¨ê°ì €í•˜"],
                        "advice": [
                            "ì—…ë¬´ì™€ ê°œì¸ ì‹œê°„ì˜ ëª…í™•í•œ ê²½ê³„ ì„¤ì •",
                            "ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ ê¸°ë²• í•™ìŠµê³¼ ì‹¤ì²œ",
                            "ì‚¬íšŒì  ì§€ì§€ì²´ê³„ êµ¬ì¶•ê³¼ í™œìš©"
                        ]
                    },
                    "ê°ˆë“±": {
                        "types": ["ê°€ì¹˜ê´€", "ì˜ì‚¬ì†Œí†µ", "ì—­í• ", "ìì›"],
                        "advice": [
                            "ìƒëŒ€ë°© ì…ì¥ì—ì„œ ì´í•´í•˜ë ¤ëŠ” ë…¸ë ¥",
                            "ê°ì •ì´ ì•„ë‹Œ ì‚¬ì‹¤ê³¼ ì´ìŠˆì— ì§‘ì¤‘",
                            "win-win í•´ê²°ì±… ëª¨ìƒ‰"
                        ]
                    }
                }
            },
            "data": {
                "name": "ë°ì´í„°ê³¼í•™ë°•ì‚¬ ë¶„ì„ì§„",
                "emoji": "ğŸ“Š",
                "specialties": ["ë¹…ë°ì´í„°ë¶„ì„", "ë¨¸ì‹ ëŸ¬ë‹", "í†µê³„ë¶„ì„", "ë°ì´í„°ì‹œê°í™”", "ì˜ˆì¸¡ëª¨ë¸ë§"],
                "keywords": {
                    "ì´íƒˆì˜ˆì¸¡": {
                        "features": ["ì‚¬ìš©íŒ¨í„´", "êµ¬ë§¤ì´ë ¥", "ê³ ê°ì„œë¹„ìŠ¤", "ì¸êµ¬í†µê³„"],
                        "advice": [
                            "ê³ ê° ìƒì• ì£¼ê¸°ë³„ ì´íƒˆ íŒ¨í„´ ë¶„ì„",
                            "ì‹¤ì‹œê°„ ì˜ˆì¸¡ ëª¨ë¸ë¡œ ì„ ì œì  ëŒ€ì‘",
                            "ì´íƒˆ ì›ì¸ë³„ ë§ì¶¤í˜• ë¦¬í…ì…˜ ì „ëµ"
                        ]
                    },
                    "A/Bí…ŒìŠ¤íŠ¸": {
                        "considerations": ["í‘œë³¸í¬ê¸°", "í†µê³„ì ìœ ì˜ì„±", "ì‹¤í—˜ê¸°ê°„", "ì™¸ë¶€ìš”ì¸"],
                        "advice": [
                            "ì¶©ë¶„í•œ í‘œë³¸ í¬ê¸°ë¡œ í†µê³„ì  ì‹ ë¢°ì„± í™•ë³´",
                            "ë‹¨ì¼ ë³€ìˆ˜ í…ŒìŠ¤íŠ¸ë¡œ ìˆœìˆ˜ íš¨ê³¼ ì¸¡ì •",
                            "ë¹„ì¦ˆë‹ˆìŠ¤ ì„íŒ©íŠ¸ì™€ í†µê³„ì  ìœ ì˜ì„± í•¨ê»˜ ê³ ë ¤"
                        ]
                    }
                }
            },
            "startup": {
                "name": "ì°½ì—…í•™ë°•ì‚¬ ìŠ¤íƒ€íŠ¸ì§„",
                "emoji": "ğŸš€",
                "specialties": ["ì‚¬ì—…ê¸°íš", "íˆ¬ììœ ì¹˜", "íŒ€ë¹Œë”©", "ì‹œì¥ë¶„ì„", "ë¹„ì¦ˆë‹ˆìŠ¤ëª¨ë¸"],
                "keywords": {
                    "ì°½ì—…": {
                        "stages": ["ì•„ì´ë””ì–´ê²€ì¦", "MVPê°œë°œ", "ì‹œì¥ì§„ì…", "ì„±ì¥", "í™•ì¥"],
                        "advice": [
                            "ê³ ê° ë¬¸ì œ í•´ê²°ì— ì§‘ì¤‘í•œ ì•„ì´ë””ì–´ ê²€ì¦",
                            "ìµœì†Œ ê¸°ëŠ¥ìœ¼ë¡œ ë¹ ë¥¸ ì‹œì¥ ë°˜ì‘ í™•ì¸",
                            "ë°ì´í„° ê¸°ë°˜ ì˜ì‚¬ê²°ì •ê³¼ ì§€ì†ì  ê°œì„ "
                        ]
                    },
                    "íˆ¬ì": {
                        "types": ["ì—”ì ¤", "ì‹œë“œ", "ì‹œë¦¬ì¦ˆA", "ì‹œë¦¬ì¦ˆB+"],
                        "advice": [
                            "ëª…í™•í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ëª¨ë¸ê³¼ ìˆ˜ìµì„± ì œì‹œ",
                            "ì‹œì¥ í¬ê¸°ì™€ ì„±ì¥ ê°€ëŠ¥ì„± ì…ì¦",
                            "ê°•ë ¥í•œ íŒ€ê³¼ ì‹¤í–‰ë ¥ ì–´í•„"
                        ]
                    }
                }
            },
            "wellness": {
                "name": "ì›°ë‹ˆìŠ¤ë°•ì‚¬ ê±´ê°•ì§„",
                "emoji": "ğŸŒ¿",
                "specialties": ["ê±´ê°•ê´€ë¦¬", "ì˜ì–‘í•™", "ìš´ë™ê³¼í•™", "ìŠ¤íŠ¸ë ˆìŠ¤ê´€ë¦¬", "ë¼ì´í”„ìŠ¤íƒ€ì¼"],
                "keywords": {
                    "ë¶ˆë©´ì¦": {
                        "causes": ["ìŠ¤íŠ¸ë ˆìŠ¤", "ìƒí™œìŠµê´€", "í™˜ê²½", "ê±´ê°•ìƒíƒœ"],
                        "advice": [
                            "ê·œì¹™ì ì¸ ìˆ˜ë©´ ìŠ¤ì¼€ì¤„ ìœ ì§€ê°€ í•µì‹¬",
                            "ì¹´í˜ì¸ê³¼ ì•Œì½”ì˜¬ ì„­ì·¨ ì‹œê°„ ì¡°ì ˆ",
                            "ìˆ˜ë©´ í™˜ê²½ ìµœì í™”ì™€ ì´ì™„ ê¸°ë²• í™œìš©"
                        ]
                    },
                    "ë‹¤ì´ì–´íŠ¸": {
                        "principles": ["ì¹¼ë¡œë¦¬ê· í˜•", "ì˜ì–‘ê· í˜•", "ì§€ì†ê°€ëŠ¥ì„±"],
                        "advice": [
                            "ê¸‰ê²©í•œ ê°ëŸ‰ë³´ë‹¤ ì ì§„ì  ë³€í™” ì¶”êµ¬",
                            "ê· í˜• ì¡íŒ ì˜ì–‘ì†Œ ì„­ì·¨ë¡œ ê±´ê°• ìœ ì§€",
                            "ìš´ë™ê³¼ ì‹ë‹¨ ì¡°ì ˆì˜ ë³‘í–‰ì´ íš¨ê³¼ì "
                        ]
                    }
                }
            }
        }
                "specialties": ["íˆ¬ì", "ì¬ì •ê´€ë¦¬", "ì—°ê¸ˆ", "ë³´í—˜", "ì„¸ê¸ˆ"],
                "keywords": {
                    "íˆ¬ì": {
                        "principles": ["ë¶„ì‚°íˆ¬ì", "ì¥ê¸°íˆ¬ì", "ë¦¬ìŠ¤í¬ê´€ë¦¬"],
                        "products": ["ì£¼ì‹", "ì±„ê¶Œ", "í€ë“œ", "ETF", "ë¦¬ì¸ "],
                        "advice": [
                            "20ëŒ€ëŠ” ì ê·¹ì  í¬íŠ¸í´ë¦¬ì˜¤ë¡œ ì£¼ì‹ ë¹„ì¤‘ 70% ê¶Œì¥",
                            "Emergency Fundë¥¼ ë¨¼ì € ë§ˆë ¨í•˜ì„¸ìš”",
                            "íˆ¬ì ëª©ì ê³¼ ê¸°ê°„ì„ ëª…í™•íˆ ì„¤ì •í•˜ì„¸ìš”",
                        ],
                    },
                    "ì—°ê¸ˆ": {
                        "types": ["êµ­ë¯¼ì—°ê¸ˆ", "í‡´ì§ì—°ê¸ˆ", "ê°œì¸ì—°ê¸ˆ"],
                        "advice": [
                            "êµ­ë¯¼ì—°ê¸ˆì€ ê¸°ë³¸, ê°œì¸ì—°ê¸ˆìœ¼ë¡œ ë³´ì™„í•˜ì„¸ìš”",
                            "ì—°ê¸ˆì €ì¶•ì€ ì„¸ì•¡ê³µì œ í˜œíƒì„ í™œìš©í•˜ì„¸ìš”",
                            "ì¥ê¸° íˆ¬ì ê´€ì ìœ¼ë¡œ ì ‘ê·¼í•˜ì„¸ìš”",
                        ],
                    },
                },
            },
            "tech": {
                "name": "ê³µí•™ë°•ì‚¬ í…Œí¬ì§„",
                "emoji": "ğŸ”§",
                "specialties": [
                    "ì†Œí”„íŠ¸ì›¨ì–´ê°œë°œ",
                    "AI/ML",
                    "í´ë¼ìš°ë“œ",
                    "ë³´ì•ˆ",
                    "ì•„í‚¤í…ì²˜",
                ],
                "keywords": {
                    "ìŠ¤íƒ€íŠ¸ì—…": {
                        "stack": [
                            "React/Vue.js",
                            "Node.js/Python",
                            "AWS/GCP",
                            "Docker",
                            "DB",
                        ],
                        "advice": [
                            "MVP ê°œë°œì— ì§‘ì¤‘í•˜ì—¬ ë¹ ë¥¸ ê²€ì¦ì„ í•˜ì„¸ìš”",
                            "í™•ì¥ì„±ì„ ê³ ë ¤í•œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ ê¶Œì¥",
                            "CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì¶•ìœ¼ë¡œ ê°œë°œ íš¨ìœ¨ì„± ì¦ëŒ€",
                        ],
                    },
                    "AI": {
                        "considerations": ["ë°ì´í„° í’ˆì§ˆ", "ëª¨ë¸ ì„ íƒ", "ìœ¤ë¦¬", "ë³´ì•ˆ"],
                        "advice": [
                            "ì¶©ë¶„í•œ í’ˆì§ˆì˜ ë°ì´í„° í™•ë³´ê°€ ìš°ì„ ì…ë‹ˆë‹¤",
                            "ì‚¬ìš©ì ê°œì¸ì •ë³´ ë³´í˜¸ ì •ì±…ì„ ì² ì €íˆ ìˆ˜ë¦½í•˜ì„¸ìš”",
                            "AI í¸í–¥ì„± ë¬¸ì œë¥¼ ì§€ì†ì ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•˜ì„¸ìš”",
                        ],
                    },
                },
            },
            "marketing": {
                "name": "ë§ˆì¼€íŒ…ë°•ì‚¬ íŒë§¤ì§„",
                "emoji": "ğŸ“ˆ",
                "specialties": [
                    "ë¸Œëœë”©",
                    "ë””ì§€í„¸ë§ˆì¼€íŒ…",
                    "ê³ ê°ë¶„ì„",
                    "ìº í˜ì¸ê¸°íš",
                    "ROIë¶„ì„",
                ],
                "keywords": {
                    "ì‹ ì œí’ˆ": {
                        "strategies": [
                            "íƒ€ê²Ÿ ê³ ê° ë¶„ì„",
                            "ê²½ìŸì‚¬ ë¶„ì„",
                            "í¬ì§€ì…”ë‹",
                            "ì±„ë„ ì „ëµ",
                        ],
                        "advice": [
                            "ì´ˆê¸°ì—ëŠ” ë‹ˆì¹˜ ë§ˆì¼“ì„ ê³µëµí•˜ì—¬ ë¸Œëœë“œ ì¸ì§€ë„ êµ¬ì¶•",
                            "ê³ ê° í”¼ë“œë°±ì„ ì ê·¹ ìˆ˜ì§‘í•˜ì—¬ ì œí’ˆ ê°œì„ ì— ë°˜ì˜",
                            "ì†Œì…œë¯¸ë””ì–´ì™€ ì¸í”Œë£¨ì–¸ì„œ ë§ˆì¼€íŒ… í™œìš© ê¶Œì¥",
                        ],
                    },
                    "SNS": {
                        "platforms": ["ì¸ìŠ¤íƒ€ê·¸ë¨", "ìœ íŠœë¸Œ", "í‹±í†¡", "ë„¤ì´ë²„ë¸”ë¡œê·¸"],
                        "advice": [
                            "í”Œë«í¼ë³„ íŠ¹ì„±ì— ë§ëŠ” ì½˜í…ì¸  ì œì‘ì´ í•µì‹¬",
                            "ì¼ê´€ëœ ë¸Œëœë“œ í†¤ì•¤ë§¤ë„ˆ ìœ ì§€",
                            "ì¸ê²Œì´ì§€ë¨¼íŠ¸ìœ¨ì´ ë„ë‹¬ë¥ ë³´ë‹¤ ì¤‘ìš”í•©ë‹ˆë‹¤",
                        ],
                    },
                },
            },
            "legal": {
                "name": "ë²•í•™ë°•ì‚¬ ì •ì˜ì§„",
                "emoji": "âš–ï¸",
                "specialties": ["ë¯¼ë²•", "ìƒë²•", "ë…¸ë™ë²•", "ë¶€ë™ì‚°ë²•", "ê³„ì•½ë²•"],
                "keywords": {
                    "ì„ëŒ€ì°¨": {
                        "rights": ["ë³´ì¦ê¸ˆ ë°˜í™˜ê¶Œ", "ì„ëŒ€ë£Œ ì¦ì•¡ ì œí•œ", "ê³„ì•½ ê°±ì‹ ê¶Œ"],
                        "advice": [
                            "ê³„ì•½ì„œ ì¡°ê±´ì„ ê¼¼ê¼¼íˆ í™•ì¸í•˜ê³  ë³´ê´€í•˜ì„¸ìš”",
                            "ë³´ì¦ê¸ˆ ë°˜í™˜ ì‹œ ë‚´ìš©ì¦ëª…ì„ í™œìš©í•˜ì„¸ìš”",
                            "ì „ì„¸ì‚¬ê¸° ì˜ˆë°©ì„ ìœ„í•´ ë“±ê¸°ë¶€ë“±ë³¸ í™•ì¸ í•„ìˆ˜",
                        ],
                    },
                    "ì§ì¥": {
                        "protections": [
                            "ë¶€ë‹¹í•´ê³  ê¸ˆì§€",
                            "ì„ê¸ˆì²´ë¶ˆ êµ¬ì œ",
                            "ì§ì¥ ë‚´ ê´´ë¡­í˜ ê¸ˆì§€",
                        ],
                        "advice": [
                            "ì¦ê±° ìë£Œë¥¼ ì²´ê³„ì ìœ¼ë¡œ ìˆ˜ì§‘í•˜ì„¸ìš”",
                            "ë…¸ë™ë¶€ ì‹ ê³ ë‚˜ ê³ ìš©ë…¸ë™ì²­ ìƒë‹´ í™œìš©",
                            "í•„ìš”ì‹œ ì „ë¬¸ ë…¸ë¬´ì‚¬ë‚˜ ë³€í˜¸ì‚¬ ìƒë‹´ ê¶Œì¥",
                        ],
                    },
                },
            },
        }

    def _load_conversation_patterns(self) -> Dict[str, List[str]]:
        """ëŒ€í™” íŒ¨í„´ ë° ì‘ë‹µ í…œí”Œë¦¿"""
        return {
            "greeting": [
                "ì•ˆë…•í•˜ì„¸ìš”! ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹œêµ°ìš”.",
                "ë°˜ê°‘ìŠµë‹ˆë‹¤! ì–´ë–¤ ë„ì›€ì´ í•„ìš”í•˜ì‹ ê°€ìš”?",
                "ì¢‹ì€ ì§ˆë¬¸ì´ë„¤ìš”! ìì„¸íˆ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤.",
            ],
            "analysis": [
                "ë§ì”€í•˜ì‹  ìƒí™©ì„ ì¢…í•©í•´ë³´ë©´",
                "ì „ë¬¸ê°€ ê´€ì ì—ì„œ ë¶„ì„í•´ë“œë¦¬ë©´",
                "ê²½í—˜ìƒ ì´ëŸ° ê²½ìš°ì—ëŠ”",
            ],
            "recommendation": [
                "ë‹¤ìŒê³¼ ê°™ì´ ë‹¨ê³„ë³„ë¡œ ì ‘ê·¼í•˜ì‹œê¸¸ ê¶Œí•©ë‹ˆë‹¤:",
                "ìš°ì„ ìˆœìœ„ë¥¼ ê³ ë ¤í•˜ì—¬ ì´ë ‡ê²Œ ì§„í–‰í•˜ì„¸ìš”:",
                "ì‹¤ë¬´ ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ ì¶”ì²œë“œë¦¬ëŠ” ë°©ë²•ì€:",
            ],
            "closing": [
                "ì¶”ê°€ ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ë§ì”€í•´ì£¼ì„¸ìš”!",
                "ë„ì›€ì´ ë˜ì…¨ê¸°ë¥¼ ë°”ëë‹ˆë‹¤!",
                "ë” êµ¬ì²´ì ì¸ ìƒí™©ì´ ìˆë‹¤ë©´ ì¶”ê°€ ìƒë‹´ì„ ë°›ì•„ë³´ì‹œê¸° ë°”ëë‹ˆë‹¤.",
            ],
        }

    def generate_expert_response(self, user_message: str, expert_type: str) -> str:
        """ì „ë¬¸ê°€ë³„ ë§ì¶¤ ì‘ë‹µ ìƒì„±"""
        expert = self.expert_knowledge.get(expert_type)
        if not expert:
            return "ì§€ì›í•˜ì§€ ì•ŠëŠ” ì „ë¬¸ê°€ ìœ í˜•ì…ë‹ˆë‹¤."

        # ë©”ì‹œì§€ ë¶„ì„
        analysis = self._analyze_message(user_message, expert)

        # ì‘ë‹µ êµ¬ì„±
        response_parts = []

        # í—¤ë”
        response_parts.append(f"{expert['emoji']} **{expert['name']}**")
        response_parts.append("")

        # ì¸ì‚¬ë§
        greeting = random.choice(self.conversation_patterns["greeting"])
        response_parts.append(greeting)
        response_parts.append("")

        # ë¶„ì„ ë° ì¡°ì–¸
        if analysis["matched_keywords"]:
            for keyword, info in analysis["matched_keywords"].items():
                response_parts.append(f"ğŸ“‹ **{keyword} ê´€ë ¨ ì „ë¬¸ ì¡°ì–¸:**")
                response_parts.append("")

                if "advice" in info:
                    for advice in info["advice"][:2]:  # ìµœëŒ€ 2ê°œ ì¡°ì–¸
                        response_parts.append(f"â€¢ {advice}")

                if "treatments" in info:
                    response_parts.append(
                        f"**ê¶Œì¥ ë°©ë²•:** {', '.join(info['treatments'])}"
                    )

                if "products" in info:
                    response_parts.append(
                        f"**ì¶”ì²œ ìƒí’ˆ:** {', '.join(info['products'][:3])}"
                    )

                response_parts.append("")

        # ì¼ë°˜ì ì¸ ì „ë¬¸ê°€ ì¡°ì–¸
        response_parts.append("ğŸ¯ **ì „ë¬¸ê°€ ì¶”ì²œì‚¬í•­:**")
        response_parts.append("")

        general_advice = self._generate_general_advice(expert_type, user_message)
        for advice in general_advice:
            response_parts.append(f"âœ“ {advice}")

        response_parts.append("")

        # ë§ˆë¬´ë¦¬
        closing = random.choice(self.conversation_patterns["closing"])
        response_parts.append(closing)

        return "\n".join(response_parts)

    def _analyze_message(self, message: str, expert: Dict) -> Dict[str, Any]:
        """ë©”ì‹œì§€ ë¶„ì„í•˜ì—¬ ê´€ë ¨ í‚¤ì›Œë“œ ë§¤ì¹­"""
        message_lower = message.lower()
        matched_keywords = {}

        for keyword, info in expert["keywords"].items():
            if keyword in message_lower:
                matched_keywords[keyword] = info

        # ìœ ì‚¬ í‚¤ì›Œë“œë„ ì²´í¬
        if expert["emoji"] == "ğŸ¥":  # ì˜í•™
            if any(
                word in message_lower for word in ["ì•„í”„", "ì¦ìƒ", "í†µì¦", "ì—´", "ê¸°ì¹¨"]
            ):
                if "ê°ê¸°" not in matched_keywords and "ê°ê¸°" in expert["keywords"]:
                    matched_keywords["ê°ê¸°"] = expert["keywords"]["ê°ê¸°"]

        return {
            "matched_keywords": matched_keywords,
            "emotion": self._detect_emotion(message),
            "urgency": self._detect_urgency(message),
        }

    def _detect_emotion(self, message: str) -> str:
        """ê°ì • ë¶„ì„"""
        positive_words = ["ì¢‹", "ê¸°ì˜", "í–‰ë³µ", "ë§Œì¡±", "ì„±ê³µ"]
        negative_words = ["ê±±ì •", "ë¬¸ì œ", "ì–´ë ¤", "í˜ë“¤", "ë‹µë‹µ"]

        pos_count = sum(1 for word in positive_words if word in message)
        neg_count = sum(1 for word in negative_words if word in message)

        if neg_count > pos_count:
            return "ê±±ì •"
        elif pos_count > neg_count:
            return "ê¸ì •"
        else:
            return "ì¤‘ì„±"

    def _detect_urgency(self, message: str) -> str:
        """ê¸´ê¸‰ë„ ë¶„ì„"""
        urgent_words = ["ê¸‰", "ì¦‰ì‹œ", "ì‘ê¸‰", "ë¹¨ë¦¬", "ì‹¬ê°"]
        if any(word in message for word in urgent_words):
            return "ë†’ìŒ"
        return "ë³´í†µ"

    def _generate_general_advice(self, expert_type: str, message: str) -> List[str]:
        """ì „ë¬¸ê°€ë³„ ì¼ë°˜ì ì¸ ì¡°ì–¸ ìƒì„±"""
        advice_templates = {
            "medical": [
                "ì¦ìƒì´ ì§€ì†ë˜ê±°ë‚˜ ì•…í™”ë˜ë©´ ë°˜ë“œì‹œ ì „ë¬¸ì˜ ì§„ë£Œë¥¼ ë°›ìœ¼ì„¸ìš”",
                "ì˜ˆë°©ì´ ì¹˜ë£Œë³´ë‹¤ ì¤‘ìš”í•˜ë¯€ë¡œ í‰ì†Œ ê±´ê°•ê´€ë¦¬ì— ì‹ ê²½ì“°ì„¸ìš”",
                "ìê°€ì§„ë‹¨ë³´ë‹¤ëŠ” ì •í™•í•œ ê²€ì‚¬ë¥¼ í†µí•œ ì§„ë‹¨ì´ í•„ìš”í•©ë‹ˆë‹¤",
            ],
            "financial": [
                "íˆ¬ì ì „ ì¶©ë¶„í•œ ê³µë¶€ì™€ ë¦¬ìŠ¤í¬ ë¶„ì„ì´ í•„ìš”í•©ë‹ˆë‹¤",
                "ì¥ê¸°ì  ê´€ì ì—ì„œ ê¾¸ì¤€í•œ íˆ¬ì ìŠµê´€ì„ ê¸°ë¥´ì„¸ìš”",
                "ì „ë¬¸ê°€ ìƒë‹´ì„ í†µí•´ ê°œì¸ ë§ì¶¤ ì „ëµì„ ìˆ˜ë¦½í•˜ì„¸ìš”",
            ],
            "tech": [
                "ìµœì‹  ê¸°ìˆ  íŠ¸ë Œë“œë¥¼ ì§€ì†ì ìœ¼ë¡œ í•™ìŠµí•˜ì„¸ìš”",
                "ë³´ì•ˆê³¼ ì„±ëŠ¥ì„ ë™ì‹œì— ê³ ë ¤í•œ ì„¤ê³„ê°€ ì¤‘ìš”í•©ë‹ˆë‹¤",
                "ì‚¬ìš©ì ê²½í—˜(UX)ì„ ìµœìš°ì„ ìœ¼ë¡œ ê³ ë ¤í•˜ì„¸ìš”",
            ],
            "marketing": [
                "íƒ€ê²Ÿ ê³ ê°ì„ ëª…í™•íˆ ì •ì˜í•˜ê³  ê·¸ë“¤ì˜ ë‹ˆì¦ˆë¥¼ íŒŒì•…í•˜ì„¸ìš”",
                "ë°ì´í„° ê¸°ë°˜ì˜ ì˜ì‚¬ê²°ì •ì„ í†µí•´ ROIë¥¼ ìµœì í™”í•˜ì„¸ìš”",
                "ë¸Œëœë“œ ì¼ê´€ì„±ì„ ìœ ì§€í•˜ë©° ì‹ ë¢°ë„ë¥¼ êµ¬ì¶•í•˜ì„¸ìš”",
            ],
            "legal": [
                "ê´€ë ¨ ë²•ë ¹ê³¼ íŒë¡€ë¥¼ ì¶©ë¶„íˆ ê²€í† í•˜ì„¸ìš”",
                "ì¦ê±° ìë£Œë¥¼ ì²´ê³„ì ìœ¼ë¡œ ìˆ˜ì§‘í•˜ê³  ë³´ê´€í•˜ì„¸ìš”",
                "ë³µì¡í•œ ì‚¬ì•ˆì€ ì „ë¬¸ ë³€í˜¸ì‚¬ì™€ ìƒë‹´í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤",
            ],
        }

        default_advice = [
            "ì „ë¬¸ì ì¸ ë¶„ì„ì´ í•„ìš”í•œ ê²½ìš° ì¶”ê°€ ìƒë‹´ì„ ê¶Œí•©ë‹ˆë‹¤",
            "ìƒí™©ì— ë§ëŠ” ë§ì¶¤í˜• ì†”ë£¨ì…˜ì„ ì œê³µí•˜ê² ìŠµë‹ˆë‹¤",
            "ì§€ì†ì ì¸ ëª¨ë‹ˆí„°ë§ê³¼ ê´€ë¦¬ê°€ ì¤‘ìš”í•©ë‹ˆë‹¤",
        ]

        return advice_templates.get(expert_type, default_advice)

    def analyze_emotion(self, text: str) -> Dict[str, Any]:
        """ê°ì • ë¶„ì„ (í˜¸í™˜ì„±)"""
        emotion = self._detect_emotion(text)
        return {
            "emotion": emotion,
            "confidence": 0.85,
            "details": f"ë©”ì‹œì§€ ê°ì • ìƒíƒœ: {emotion}",
        }

    def analyze_conversation_context(self, text: str) -> Dict[str, Any]:
        """ëŒ€í™” ë§¥ë½ ë¶„ì„ (í˜¸í™˜ì„±)"""
        urgency = self._detect_urgency(text)
        return {"urgency": urgency, "context": "ì „ë¬¸ê°€ ìƒë‹´", "confidence": 0.8}


# ì „ì—­ ì¸ìŠ¤í„´ìŠ¤
_smart_ai = None


def get_smart_ai() -> SmartExpertAI:
    """Smart AI ì¸ìŠ¤í„´ìŠ¤ ë°˜í™˜"""
    global _smart_ai
    if _smart_ai is None:
        _smart_ai = SmartExpertAI()
    return _smart_ai


def generate_expert_response_sync(user_message: str, expert_type: str) -> str:
    """ë™ê¸° ì „ë¬¸ê°€ ì‘ë‹µ ìƒì„±"""
    smart_ai = get_smart_ai()
    return smart_ai.generate_expert_response(user_message, expert_type)


# ê¸°ì¡´ ì‹œìŠ¤í…œê³¼ì˜ í˜¸í™˜ì„±
class RealAIManager:
    """í˜¸í™˜ì„±ì„ ìœ„í•œ ë˜í¼ í´ë˜ìŠ¤"""

    def __init__(self):
        self.smart_ai = get_smart_ai()
        self.api_keys = {"local": "enabled"}  # ê°€ìƒ API í‚¤

    async def generate_expert_response(
        self, user_message: str, expert_type: str
    ) -> str:
        """ë¹„ë™ê¸° í˜¸í™˜ í•¨ìˆ˜"""
        return self.smart_ai.generate_expert_response(user_message, expert_type)

    def analyze_emotion(self, text: str) -> Dict[str, Any]:
        """ê°ì • ë¶„ì„"""
        return self.smart_ai.analyze_emotion(text)

    def analyze_conversation_context(self, text: str) -> Dict[str, Any]:
        """ëŒ€í™” ë§¥ë½ ë¶„ì„"""
        return self.smart_ai.analyze_conversation_context(text)


def get_real_ai_manager() -> RealAIManager:
    """í˜¸í™˜ì„±ì„ ìœ„í•œ AI ë§¤ë‹ˆì € ë°˜í™˜"""
    return RealAIManager()


# ë¹„ë™ê¸° í•¨ìˆ˜ë“¤
async def generate_expert_response_async(user_message: str, expert_type: str) -> str:
    """ë¹„ë™ê¸° ì „ë¬¸ê°€ ì‘ë‹µ ìƒì„±"""
    smart_ai = get_smart_ai()
    return smart_ai.generate_expert_response(user_message, expert_type)

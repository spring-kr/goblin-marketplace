<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🏰 도깨비마을장터 박사급 AI 상담소 🏰</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
            color: white;
            min-height: 100vh;
        }
        
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .container {
            padding: 40px 20px;
        }
        
        .hero-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 40px;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .hero-section h1 {
            font-size: 3rem;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }
        
        .hero-section p {
            font-size: 1.3rem;
            opacity: 0.9;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            transition: all 0.3s ease;
            color: white;
            height: 100%;
        }
        
        .card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 215, 0, 0.8);
        }
        
        .card-body {
            padding: 30px;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .card-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #FFD700;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: bold;
            transition: all 0.3s ease;
            margin-top: auto;
        }
        
        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        .category-header {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin: 30px 0 20px 0;
            text-align: center;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }
        
        .category-header h2 {
            color: #FFD700;
            margin: 0;
            font-size: 2rem;
        }
        
        .admin-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-top: 40px;
            text-align: center;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            border: none;
            color: #2d3436;
            font-weight: bold;
        }
        
        .chat-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-top: 30px;
            display: none;
        }
        
        .chat-messages {
            max-height: 500px;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 15px;
        }
        
        .message {
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 10px;
        }
        
        .user-message {
            background: rgba(102, 126, 234, 0.3);
            text-align: right;
        }
        
        .bot-message {
            background: rgba(35, 166, 213, 0.3);
            text-align: left;
        }
        
        .input-group {
            margin-top: 20px;
        }
        
        .form-control {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
        }
        
        .form-control:focus {
            background: rgba(255, 255, 255, 0.25);
            border-color: #FFD700;
            color: white;
            box-shadow: 0 0 0 0.2rem rgba(255, 215, 0, 0.25);
        }
        
        .form-control::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        /* Beta 표시 스타일 */
        .beta-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            margin-left: 10px;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 0.9rem;
            font-weight: 700;
            letter-spacing: 0.5px;
            color: #FFD700;
            background: rgba(255, 215, 0, 0.15);
            border: 1px solid rgba(255, 215, 0, 0.55);
        }
        .beta-note {
            display: inline-block;
            margin-top: 10px;
            padding: 8px 12px;
            border-radius: 10px;
            font-size: 0.95rem;
            color: #ffffff;
            background: rgba(255, 215, 0, 0.12);
            border: 1px solid rgba(255, 215, 0, 0.4);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 히어로 섹션 -->
        <div class="hero-section">
            <h1>🏰 도깨비마을장터 박사급 AI 상담소 <span class="beta-badge" title="베타 버전">BETA</span></h1>
            <p>원래 16개 도깨비들이 각 분야별 전문 상담을 제공합니다</p>
            <p><strong>✨ 박사급 AI 도깨비들의 전문적인 조언을 받아보세요! ✨</strong></p>
            <p class="beta-note">현재 베타(시험 운영) 버전입니다. 기능이 변경되거나 오류가 발생할 수 있습니다.</p>
        </div>

        <!-- 업무&관리 카테고리 -->
        <div class="category-header">
            <h2>💼 업무&관리 전문 도깨비</h2>
        </div>
        <div class="row">
            <div class="col-md-3 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">🤖 박사급 비서 도깨비</h5>
                        <p class="card-text">업무 관리, 일정 계획, 생산성 향상 전문가</p>
                        <button class="btn btn-primary" onclick="startChat('assistant', '🤖 박사급 비서 도깨비')">상담 시작</button>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">👥 HR 도깨비</h5>
                        <p class="card-text">인사 관리, 조직 운영, 팀 빌딩 전문가</p>
                        <button class="btn btn-primary" onclick="startChat('hr', '👥 HR 도깨비')">상담 시작</button>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">👑 이장 도깨비</h5>
                        <p class="card-text">마을 관리, 커뮤니티 운영, 리더십 전문가</p>
                        <button class="btn btn-primary" onclick="startChat('village_chief', '👑 이장 도깨비')">상담 시작</button>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">🌱 성장 도깨비</h5>
                        <p class="card-text">개인 성장, 역량 개발, 자기계발 전문가</p>
                        <button class="btn btn-primary" onclick="startChat('growth', '🌱 성장 도깨비')">상담 시작</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 창작&마케팅 카테고리 -->
        <div class="category-header">
            <h2>🎨 창작&마케팅 전문 도깨비</h2>
        </div>
        <div class="row">
            <div class="col-md-3 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">🎨 창작 도깨비</h5>
                        <p class="card-text">창의적 아이디어, 콘텐츠 제작, 예술 창작 전문가</p>
                        <button class="btn btn-primary" onclick="startChat('creative', '🎨 창작 도깨비')">상담 시작</button>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">📈 마케팅 도깨비</h5>
                        <p class="card-text">마케팅 전략, 브랜딩, 고객 분석 전문가</p>
                        <button class="btn btn-primary" onclick="startChat('marketing', '📈 마케팅 도깨비')">상담 시작</button>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">✍️ 박사급 문서 작성 도깨비</h5>
                        <p class="card-text">전문 문서 작성, 보고서, 제안서 전문가</p>
                        <button class="btn btn-primary" onclick="startChat('writing', '✍️ 박사급 문서 작성 도깨비')">상담 시작</button>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">🔍 SEO 도깨비</h5>
                        <p class="card-text">검색 최적화, 웹 마케팅, 트래픽 증대 전문가</p>
                        <button class="btn btn-primary" onclick="startChat('seo', '🔍 SEO 도깨비')">상담 시작</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 기술&분석 카테고리 -->
        <div class="category-header">
            <h2>💻 기술&분석 전문 도깨비</h2>
        </div>
        <div class="row">
            <div class="col-md-3 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">💻 빌더 도깨비</h5>
                        <p class="card-text">소프트웨어 개발, 시스템 구축, 기술 설계 전문가</p>
                        <button class="btn btn-primary" onclick="startChat('builder', '💻 빌더 도깨비')">상담 시작</button>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">📊 데이터분석 도깨비</h5>
                        <p class="card-text">데이터 분석, 통계, 예측 모델링 전문가</p>
                        <button class="btn btn-primary" onclick="startChat('data_analyst', '📊 데이터분석 도깨비')">상담 시작</button>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">🏥 의료 도깨비</h5>
                        <p class="card-text">건강 관리, 의학 정보, 웰빙 라이프 전문가</p>
                        <button class="btn btn-primary" onclick="startChat('medical', '🏥 의료 도깨비')">상담 시작</button>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">🚀 스타트업 도깨비</h5>
                        <p class="card-text">창업 전략, 사업 계획, 투자 유치 전문가</p>
                        <button class="btn btn-primary" onclick="startChat('startup', '🚀 스타트업 도깨비')">상담 시작</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 생활&상담 카테고리 -->
        <div class="category-header">
            <h2>💬 생활&상담 전문 도깨비</h2>
        </div>
        <div class="row">
            <div class="col-md-3 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">💬 상담 도깨비</h5>
                        <p class="card-text">심리 상담, 고민 해결, 멘탈 케어 전문가</p>
                        <button class="btn btn-primary" onclick="startChat('counselor', '💬 상담 도깨비')">상담 시작</button>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">🔮 운세 도깨비</h5>
                        <p class="card-text">운세 해석, 타로, 인생 조언 전문가</p>
                        <button class="btn btn-primary" onclick="startChat('fortune', '🔮 운세 도깨비')">상담 시작</button>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">💰 영업 도깨비</h5>
                        <p class="card-text">영업 전략, 세일즈 스킬, 고객 관리 전문가</p>
                        <button class="btn btn-primary" onclick="startChat('sales', '💰 영업 도깨비')">상담 시작</button>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">🛒 쇼핑 도깨비</h5>
                        <p class="card-text">스마트 쇼핑, 제품 추천, 구매 가이드 전문가</p>
                        <button class="btn btn-primary" onclick="startChat('shopping', '🛒 쇼핑 도깨비')">상담 시작</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 채팅 컨테이너 -->
        <div class="chat-container" id="chatContainer">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 id="currentAgent">도깨비와 대화중...</h3>
                <button class="btn btn-secondary" onclick="closeChat()">대화 종료</button>
            </div>
            <div class="chat-messages" id="chatMessages"></div>
            <div class="input-group">
                <input type="text" class="form-control" id="questionInput" placeholder="질문을 입력하세요..." onkeypress="handleKeyPress(event)">
                <button class="btn btn-primary" onclick="sendMessage()">전송</button>
            </div>
        </div>
    </div>

    <!-- 관리자 로그인 모달 -->
    <div class="modal fade" id="adminModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content" style="background: rgba(255, 255, 255, 0.95); color: #333;">
                <div class="modal-header">
                    <h5 class="modal-title">관리자 인증</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="adminForm" onsubmit="checkAdminKey(); return false;">
                        <div class="mb-3">
                            <label for="adminKey" class="form-label">관리자 키:</label>
                            <input type="password" class="form-control" id="adminKey" style="color: #333;" placeholder="관리자 키를 입력하세요" autocomplete="new-password" onkeypress="if(event.key==='Enter') checkAdminKey()">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                    <button type="button" class="btn btn-primary" onclick="checkAdminKey()">확인</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentAgentType = '';
        let currentAgentName = '';
        
        // 비밀 관리자 접근 코드 - Ctrl + Shift + A
        document.addEventListener('keydown', function(event) {
            // Ctrl + Shift + A 조합 감지 (대/소문자 모두 허용)
            if (event.ctrlKey && event.shiftKey && (event.key === 'A' || event.key === 'a')) {
                event.preventDefault(); // 기본 동작 방지

                // 관리자 로그인 모달 표시
                const modal = new bootstrap.Modal(document.getElementById('adminModal'));
                modal.show();

                // 알림 토스트
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed; top: 20px; right: 20px; z-index: 10000;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white; padding: 15px 25px; border-radius: 10px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                    font-weight: bold; animation: fadeInOut 3s forwards;
                `;
                notification.innerHTML = '🔐 관리자 인증 모드';
                document.body.appendChild(notification);

                setTimeout(() => notification.remove(), 2000);
            }
        });
        
        // CSS 애니메이션 추가
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeInOut {
                0% { opacity: 0; transform: translateX(100px); }
                20%, 80% { opacity: 1; transform: translateX(0); }
                100% { opacity: 0; transform: translateX(100px); }
            }
        `;
        document.head.appendChild(style);

        function startChat(agentType, agentName) {
            currentAgentType = agentType;
            currentAgentName = agentName;
            
            document.getElementById('currentAgent').textContent = agentName + '와 대화중...';
            document.getElementById('chatContainer').style.display = 'block';
            document.getElementById('chatMessages').innerHTML = '';
            document.getElementById('questionInput').value = '';
            
            // 환영 메시지 추가
            addMessage('bot', `안녕하세요! ${agentName}입니다. 무엇을 도와드릴까요?`);
            
            // 채팅 영역으로 스크롤
            document.getElementById('chatContainer').scrollIntoView({ behavior: 'smooth' });
        }

        function closeChat() {
            document.getElementById('chatContainer').style.display = 'none';
            currentAgentType = '';
            currentAgentName = '';
        }

        function addMessage(type, content) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}-message`;
            messageDiv.innerHTML = content.replace(/\n/g, '<br>');
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        async function sendMessage() {
            const input = document.getElementById('questionInput');
            const question = input.value.trim();
            
            if (!question) {
                alert('질문을 입력해주세요.');
                return;
            }
            
            if (!currentAgentType) {
                alert('도깨비를 선택해주세요.');
                return;
            }

            // 사용자 메시지 추가
            addMessage('user', question);
            input.value = '';

            try {
                const response = await fetch('/stem/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        question: question,
                        agent_type: currentAgentType
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    addMessage('bot', data.response);
                } else {
                    addMessage('bot', '❌ 오류: ' + (data.error || '알 수 없는 오류가 발생했습니다.'));
                }
            } catch (error) {
                console.error('Error:', error);
                addMessage('bot', '❌ 서버 연결 오류가 발생했습니다.');
            }
        }

        async function checkAdminKey() {
            const adminKey = document.getElementById('adminKey').value;
            
            if (!adminKey) {
                alert('관리자 키를 입력해주세요.');
                return;
            }

            try {
                const response = await fetch('/stem/stats', {
                    method: 'GET',
                    headers: {
                        'X-Admin-Key': adminKey
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    const modal = bootstrap.Modal.getInstance(document.getElementById('adminModal'));
                    modal.hide();
                    showStats(data);
                } else {
                    alert('잘못된 관리자 키입니다.');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('서버 연결 오류가 발생했습니다.');
            }
        }

        function showStats(data) {
            const statsWindow = window.open('', '_blank', 'width=800,height=600');
            statsWindow.document.write(`
                <html>
                <head>
                    <title>도깨비마을장터 통계</title>
                    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
                    <style>
                        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; }
                        .card { background: rgba(255,255,255,0.1); border: none; margin-bottom: 20px; }
                        .card-body { color: white; }
                        .table { color: white; }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <h1>📊 도깨비마을장터 통계</h1>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body">
                                        <h5>총 질문 수</h5>
                                        <h2>${data.total_questions}</h2>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body">
                                        <h5>성공 응답</h5>
                                        <h2>${data.successful_responses}</h2>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body">
                                        <h5>성공률</h5>
                                        <h2>${data.success_rate}%</h2>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-body">
                                <h5>도깨비별 사용량</h5>
                                <table class="table">
                                    <thead>
                                        <tr><th>도깨비</th><th>사용 횟수</th></tr>
                                    </thead>
                                    <tbody>
                                        ${Object.entries(data.agent_usage).map(([agent, count]) => 
                                            `<tr><td>${agent}</td><td>${count}</td></tr>`
                                        ).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-body">
                                <h5>최근 활동</h5>
                                <div style="max-height: 300px; overflow-y: auto;">
                                    ${data.recent_activity.map(activity => 
                                        `<div class="border-bottom py-2">
                                            <strong>${activity.agent_type}</strong> - ${activity.timestamp}<br>
                                            <small>${activity.question.substring(0, 100)}...</small>
                                        </div>`
                                    ).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                </body>
                </html>
            `);
        }
    </script>
</body>
</html>

"""
ğŸ¯ AI ë„ê¹¨ë¹„ë§ˆì„ STEM ì„¼í„° - ì‹¤ì œ AI ëŒ€í™” ì‹œìŠ¤í…œ
ì§„ì§œ AIì²˜ëŸ¼ ìì—°ìŠ¤ëŸ½ê³  ë§¥ë½ì ì¸ ì‘ë‹µì„ ì œê³µí•˜ëŠ” 16ê°œ ë„ê¹¨ë¹„ ì‹œìŠ¤í…œ
"""

import random
from datetime import datetime
from typing import Dict, Any, Optional
import hashlib
import json
import os


class STEMIntegration:
    """STEM ë„ê¹¨ë¹„ë“¤ê³¼ì˜ ì‹¤ì œ AI ëŒ€í™” ì‹œìŠ¤í…œ"""

    def __init__(self):
        self.system_name = "ğŸ° ë„ê¹¨ë¹„ë§ˆì„ì¥í„° ë°•ì‚¬ê¸‰ AI ìƒë‹´ì†Œ"
        # ëŒ€í™” ê¸°ë¡ ì €ì¥ì„ ìœ„í•œ ë”•ì…”ë„ˆë¦¬ (ê°„ë‹¨í•œ ë©”ëª¨ë¦¬ ì €ì¥)
        self.conversation_history = {}
        self.context_file = "conversation_context.json"
        self._load_conversation_history()

    def _load_conversation_history(self):
        """ëŒ€í™” ê¸°ë¡ ë¡œë“œ"""
        try:
            if os.path.exists(self.context_file):
                with open(self.context_file, 'r', encoding='utf-8') as f:
                    self.conversation_history = json.load(f)
        except Exception:
            self.conversation_history = {}

    def _save_conversation_history(self):
        """ëŒ€í™” ê¸°ë¡ ì €ì¥"""
        try:
            with open(self.context_file, 'w', encoding='utf-8') as f:
                json.dump(self.conversation_history, f, ensure_ascii=False, indent=2)
        except Exception:
            pass

    def _get_conversation_key(self, user_ip: str, agent_type: str) -> str:
        """ì‚¬ìš©ì-ì—ì´ì „íŠ¸ë³„ ëŒ€í™” í‚¤ ìƒì„±"""
        key = f"{user_ip}_{agent_type}"
        return hashlib.md5(key.encode()).hexdigest()[:16]

    def _analyze_follow_up_intent(self, question: str, previous_topics: list) -> dict:
        """í›„ì† ì§ˆë¬¸ ì˜ë„ ë¶„ì„"""
        question_lower = question.lower()
        
        follow_up_indicators = {
            "more_detail": ["êµ¬ì²´ì ìœ¼ë¡œ", "ë” ìì„¸íˆ", "ì„¸ë¶€ì ìœ¼ë¡œ", "ìƒì„¸í•˜ê²Œ", "ë” ì•Œë ¤ì£¼ì„¸ìš”", "ìì„¸íˆ ì„¤ëª…"],
            "example": ["ì˜ˆì‹œ", "ì‚¬ë¡€", "ì‹¤ì œ", "ì˜ˆë¥¼ ë“¤ì–´", "êµ¬ì²´ì ì¸ ì˜ˆ", "ì‹¤ìŠµ"],
            "how_to": ["ì–´ë–»ê²Œ", "ë°©ë²•", "ë‹¨ê³„", "ì ˆì°¨", "í”„ë¡œì„¸ìŠ¤"],
            "advanced": ["ê³ ê¸‰", "ì‹¬í™”", "ì „ë¬¸ì ", "ë” ê¹Šì´", "ê³ ë„í™”"],
            "practical": ["ì‹¤ë¬´", "í˜„ì‹¤ì ", "ì‹¤ì œë¡œ", "ë°”ë¡œ", "ì‹¤í–‰"],
            "tools": ["ë„êµ¬", "íˆ´", "í”„ë¡œê·¸ë¨", "ì†Œí”„íŠ¸ì›¨ì–´", "ì•±"],
            "troubleshooting": ["ë¬¸ì œ", "í•´ê²°", "ì˜¤ë¥˜", "ì•ˆë ë•Œ", "ì‹¤íŒ¨"]
        }
        
        detected_intent = "general"
        for intent, keywords in follow_up_indicators.items():
            if any(keyword in question_lower for keyword in keywords):
                detected_intent = intent
                break
        
        return {
            "intent": detected_intent,
            "is_follow_up": len(previous_topics) > 0,
            "depth_level": len(previous_topics) + 1
        }

    def process_question(
        self, agent_type: str, question: str, user_ip: Optional[str] = None
    ) -> Dict[str, Any]:
        """ì‹¤ì œ AI ëŒ€í™” ëŠ¥ë ¥ìœ¼ë¡œ ì§ˆë¬¸ ì²˜ë¦¬ - ì»¨í…ìŠ¤íŠ¸ ì¶”ì  í¬í•¨"""
        try:
            from usage_tracker import usage_tracker

            # ì‚¬ìš©ì IPê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ì„¤ì •
            if not user_ip:
                user_ip = "unknown"

            # ëŒ€í™” ê¸°ë¡ í‚¤ ìƒì„±
            conversation_key = self._get_conversation_key(user_ip, agent_type)
            
            # ì´ì „ ëŒ€í™” ê¸°ë¡ ê°€ì ¸ì˜¤ê¸°
            previous_conversations = self.conversation_history.get(conversation_key, [])
            previous_topics = [conv.get("topic", "") for conv in previous_conversations[-3:]]  # ìµœê·¼ 3ê°œë§Œ
            
            # í›„ì† ì§ˆë¬¸ ì˜ë„ ë¶„ì„
            follow_up_analysis = self._analyze_follow_up_intent(question, previous_topics)

            # ì›ë˜ 16ê°œ ë„ê¹¨ë¹„ ì •ë³´
            agent_info = {
                "assistant": {
                    "emoji": "ğŸ¤–",
                    "name": "ë°•ì‚¬ê¸‰ ë¹„ì„œ ë„ê¹¨ë¹„",
                    "field": "ì—…ë¬´ ê´€ë¦¬",
                },
                "builder": {"emoji": "ğŸ’»", "name": "ë¹Œë” ë„ê¹¨ë¹„", "field": "ê°œë°œ"},
                "counselor": {"emoji": "ğŸ’¬", "name": "ìƒë‹´ ë„ê¹¨ë¹„", "field": "ìƒë‹´"},
                "creative": {"emoji": "ğŸ¨", "name": "ì°½ì‘ ë„ê¹¨ë¹„", "field": "ì°½ì‘"},
                "data_analyst": {
                    "emoji": "ğŸ“Š",
                    "name": "ë°ì´í„°ë¶„ì„ ë„ê¹¨ë¹„",
                    "field": "ë°ì´í„° ë¶„ì„",
                },
                "fortune": {"emoji": "ğŸ”®", "name": "ìš´ì„¸ ë„ê¹¨ë¹„", "field": "ìš´ì„¸"},
                "growth": {"emoji": "ğŸŒ±", "name": "ì„±ì¥ ë„ê¹¨ë¹„", "field": "ì„±ì¥"},
                "hr": {"emoji": "ğŸ‘¥", "name": "HR ë„ê¹¨ë¹„", "field": "ì¸ì‚¬ ê´€ë¦¬"},
                "marketing": {
                    "emoji": "ğŸ“¢",
                    "name": "ë§ˆì¼€íŒ… ë„ê¹¨ë¹„",
                    "field": "ë§ˆì¼€íŒ…",
                },
                "medical": {"emoji": "ğŸ¥", "name": "ì˜ë£Œ ë„ê¹¨ë¹„", "field": "ì˜ë£Œ"},
                "sales": {"emoji": "ğŸ’°", "name": "ì˜ì—… ë„ê¹¨ë¹„", "field": "ì˜ì—…"},
                "seo": {"emoji": "ğŸ”", "name": "SEO ë„ê¹¨ë¹„", "field": "ê²€ìƒ‰ ìµœì í™”"},
                "shopping": {"emoji": "ğŸ›’", "name": "ì‡¼í•‘ ë„ê¹¨ë¹„", "field": "ì‡¼í•‘"},
                "startup": {"emoji": "ğŸš€", "name": "ìŠ¤íƒ€íŠ¸ì—… ë„ê¹¨ë¹„", "field": "ì°½ì—…"},
                "village_chief": {
                    "emoji": "ğŸ‘‘",
                    "name": "ì´ì¥ ë„ê¹¨ë¹„",
                    "field": "ë§ˆì„ ê´€ë¦¬",
                },
                "writing": {
                    "emoji": "âœï¸",
                    "name": "ë°•ì‚¬ê¸‰ ë¬¸ì„œ ì‘ì„± ë„ê¹¨ë¹„",
                    "field": "ë¬¸ì„œ ì‘ì„±",
                },
            }

            if agent_type not in agent_info:
                # ì‹¤íŒ¨ ë¡œê·¸ ê¸°ë¡
                usage_tracker.log_usage(agent_type, question, False, user_ip)
                return {
                    "success": False,
                    "error": f"ì§€ì›í•˜ì§€ ì•ŠëŠ” ì—ì´ì „íŠ¸ íƒ€ì…: {agent_type}",
                }

            # ì§ˆë¬¸ ìœ íš¨ì„± ê²€ì‚¬
            if not question or len(question.strip()) < 2:
                usage_tracker.log_usage(agent_type, question, False, user_ip)
                return {
                    "success": False,
                    "error": "ì§ˆë¬¸ì´ ë„ˆë¬´ ì§§ìŠµë‹ˆë‹¤. ìµœì†Œ 2ê¸€ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.",
                }

            # ë„ê¹¨ë¹„ë³„ ì „ë¬¸ ì‘ë‹µ ìƒì„± (ì»¨í…ìŠ¤íŠ¸ í¬í•¨)
            info = agent_info[agent_type]
            response = self._create_contextual_ai_response(
                question, agent_type, info, previous_conversations, follow_up_analysis
            )

            # í˜„ì¬ ëŒ€í™”ë¥¼ ê¸°ë¡ì— ì¶”ê°€
            current_conversation = {
                "timestamp": datetime.now().isoformat(),
                "question": question,
                "topic": self._extract_topic(question),
                "intent": follow_up_analysis["intent"],
                "depth": follow_up_analysis["depth_level"]
            }
            
            if conversation_key not in self.conversation_history:
                self.conversation_history[conversation_key] = []
            
            self.conversation_history[conversation_key].append(current_conversation)
            
            # ìµœê·¼ 10ê°œ ëŒ€í™”ë§Œ ìœ ì§€
            if len(self.conversation_history[conversation_key]) > 10:
                self.conversation_history[conversation_key] = self.conversation_history[conversation_key][-10:]
            
            # ëŒ€í™” ê¸°ë¡ ì €ì¥
            self._save_conversation_history()

            # ì„±ê³µ ë¡œê·¸ ê¸°ë¡
            usage_tracker.log_usage(agent_type, question, True, user_ip)

            return {
                "success": True,
                "agent": {
                    "type": agent_type,
                    "name": info["name"],
                    "emoji": info["emoji"],
                    "field": info["field"],
                },
                "response": response,
                "timestamp": datetime.now().isoformat(),
                "context": {
                    "is_follow_up": follow_up_analysis["is_follow_up"],
                    "depth_level": follow_up_analysis["depth_level"],
                    "intent": follow_up_analysis["intent"]
                }
            }

        except Exception as e:
            # ì—ëŸ¬ ë¡œê·¸ ê¸°ë¡
            usage_tracker.log_usage(agent_type, question, False, user_ip)
            return {"success": False, "error": f"ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {str(e)}"}

    def _extract_topic(self, question: str) -> str:
        """ì§ˆë¬¸ì—ì„œ ì£¼ì œ ì¶”ì¶œ"""
        # ê°„ë‹¨í•œ ì£¼ì œ ì¶”ì¶œ ë¡œì§
        question_lower = question.lower()
        
        topic_keywords = {
            "ì‹œê°„ê´€ë¦¬": ["ì‹œê°„", "ì¼ì •", "ìŠ¤ì¼€ì¤„", "ê³„íš"],
            "ì—…ë¬´íš¨ìœ¨": ["íš¨ìœ¨", "ìƒì‚°ì„±", "ì—…ë¬´", "ì¼"],
            "ê¸°ìˆ ": ["ê°œë°œ", "í”„ë¡œê·¸ë˜ë°", "ì½”ë”©", "ê¸°ìˆ "],
            "ë§ˆì¼€íŒ…": ["ë§ˆì¼€íŒ…", "ê´‘ê³ ", "í™ë³´", "ë¸Œëœë“œ"],
            "ê±´ê°•": ["ê±´ê°•", "ìš´ë™", "ì˜ë£Œ", "ë³‘ì›"],
            "ì°½ì‘": ["ì°½ì‘", "ë””ìì¸", "ê¸€ì“°ê¸°", "ì•„ì´ë””ì–´"],
            "ìƒë‹´": ["ìƒë‹´", "ê³ ë¯¼", "ìŠ¤íŠ¸ë ˆìŠ¤", "ê´€ê³„"]
        }
        
        for topic, keywords in topic_keywords.items():
            if any(keyword in question_lower for keyword in keywords):
                return topic
        
        return "ì¼ë°˜ìƒë‹´"

    def _create_contextual_ai_response(
        self, question: str, agent_type: str, info: dict, previous_conversations: list, follow_up_analysis: dict
    ) -> str:
        """ì»¨í…ìŠ¤íŠ¸ë¥¼ ê³ ë ¤í•œ AI ì‘ë‹µ ìƒì„±"""
        
        # í›„ì† ì§ˆë¬¸ì¸ì§€ í™•ì¸
        if follow_up_analysis["is_follow_up"] and follow_up_analysis["depth_level"] > 1:
            return self._create_follow_up_response(question, agent_type, info, previous_conversations, follow_up_analysis)
        else:
            return self._create_natural_ai_response(question, agent_type, info)

    def _create_follow_up_response(
        self, question: str, agent_type: str, info: dict, previous_conversations: list, follow_up_analysis: dict
    ) -> str:
        """í›„ì† ì§ˆë¬¸ì— ëŒ€í•œ ì‹¬í™” ì‘ë‹µ ìƒì„±"""
        
        # ì´ì „ ì£¼ì œë“¤ íŒŒì•…
        previous_topics = [conv.get("topic", "") for conv in previous_conversations[-3:]]
        main_topic = previous_topics[-1] if previous_topics else "ì¼ë°˜ìƒë‹´"
        
        intent = follow_up_analysis["intent"]
        depth = follow_up_analysis["depth_level"]
        
        # ê¸°ì¡´ í•¨ìˆ˜ë“¤ì„ í™œìš©í•œ ì‹¬í™” ì‘ë‹µ
        detailed_solution = self._get_detailed_solution(question, info["field"])
        practical_steps = self._get_practical_steps(question, info["field"])
        expert_tips = self._get_expert_tips(question, info["field"])
        deep_analysis = self._get_deep_analysis(question, info["field"])
        
        # ì˜ë„ë³„ ë§ì¶¤ ì‘ë‹µ
        if intent == "more_detail":
            intro = f"{info['emoji']} ë” êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤! ({depth}ë‹¨ê³„ ì‹¬í™”)"
            focus = "ğŸ” **ì„¸ë¶€ ë¶„ì„:**"
        elif intent == "example":
            intro = f"{info['emoji']} ì‹¤ì œ ì‚¬ë¡€ë¡œ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤!"
            focus = "ğŸ“š **êµ¬ì²´ì  ì‚¬ë¡€:**"
        elif intent == "how_to":
            intro = f"{info['emoji']} ë‹¨ê³„ë³„ ë°©ë²•ì„ ìì„¸íˆ ì•Œë ¤ë“œë¦¬ê² ìŠµë‹ˆë‹¤!"
            focus = "ğŸ“‹ **ìƒì„¸ ì‹¤í–‰ ë°©ë²•:**"
        elif intent == "practical":
            intro = f"{info['emoji']} ì‹¤ë¬´ì— ë°”ë¡œ ì ìš©í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì•Œë ¤ë“œë¦¬ê² ìŠµë‹ˆë‹¤!"
            focus = "âš¡ **ì‹¤ë¬´ ì ìš©ë²•:**"
        elif intent == "advanced":
            intro = f"{info['emoji']} ê³ ê¸‰ ìˆ˜ì¤€ì˜ ë‚´ìš©ì„ ë‹¤ë¤„ë³´ê² ìŠµë‹ˆë‹¤!"
            focus = "ğŸ“ **ì „ë¬¸ê°€ ìˆ˜ì¤€:**"
        else:
            intro = f"{info['emoji']} ë” ê¹Šì´ ìˆê²Œ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤!"
            focus = "ğŸ’¡ **ì‹¬í™” ë‚´ìš©:**"
        
        return f"""{intro}

ì´ì „ì— {main_topic}ì— ëŒ€í•´ ê¸°ë³¸ì ì¸ ë‚´ìš©ì„ ë§ì”€ë“œë ¸ëŠ”ë°, ì´ì œ ë”ìš± êµ¬ì²´ì ì´ê³  ì‹¤ìš©ì ì¸ ë¶€ë¶„ì„ ë‹¤ë¤„ë³´ê² ìŠµë‹ˆë‹¤.

{focus}
{detailed_solution}

ğŸ› ï¸ **ì‹¬í™” ì‹¤í–‰ ë°©ë²•:**
{practical_steps}

â­ **ì „ë¬¸ê°€ ë…¸í•˜ìš° (ë ˆë²¨ {depth}):**
{expert_tips}

ï¿½ **ê¹Šì´ ìˆëŠ” ë¶„ì„:**
{deep_analysis}

ğŸ’¬ **ë‹¤ìŒ ë‹¨ê³„ ì œì•ˆ:**
- ë” êµ¬ì²´ì ì¸ ìƒí™©ì„ ì•Œë ¤ì£¼ì‹œë©´ ë§ì¶¤í˜• ì¡°ì–¸ ì œê³µ
- ì‹¤ì œ ì ìš© ì¤‘ ì–´ë ¤ì›€ì´ ìˆìœ¼ë©´ ë¬¸ì œ í•´ê²° ë°©ë²• ì•ˆë‚´
- ì„±ê³¼ ì¸¡ì •ì´ë‚˜ ê°œì„  ë°©ë²•ì— ëŒ€í•œ ì¶”ê°€ ìƒë‹´ ê°€ëŠ¥

{info['field']} ì „ë¬¸ê°€ë¡œì„œ {depth}ë‹¨ê³„ ì‹¬í™” ìƒë‹´ì„ ì œê³µí–ˆìŠµë‹ˆë‹¤. ë” ê¶ê¸ˆí•œ ì ì´ë‚˜ êµ¬ì²´ì ì¸ ìƒí™©ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ë§ì”€í•´ì£¼ì„¸ìš”!"""

    def _create_natural_ai_response(
        self, question: str, agent_type: str, info: dict
    ) -> str:
        """ì‹¤ì œ AIì²˜ëŸ¼ ìì—°ìŠ¤ëŸ½ê³  ë§¥ë½ì ì¸ ì‘ë‹µ ìƒì„±"""

        # ë„ê¹¨ë¹„ë³„ ì „ë¬¸ ë¶„ì•¼ì™€ ì„±ê²© ì •ì˜
        agent_personalities = {
            "assistant": {
                "role": "íš¨ìœ¨ì ì´ê³  ì²´ê³„ì ì¸ ì—…ë¬´ ê´€ë¦¬ ì „ë¬¸ê°€",
                "style": "ì‹¤ìš©ì ì´ê³  êµ¬ì²´ì ì¸ ì¡°ì–¸",
                "expertise": ["ì‹œê°„ê´€ë¦¬", "ì—…ë¬´íš¨ìœ¨", "ìƒì‚°ì„±", "ê³„íšìˆ˜ë¦½", "ì¡°ì§ê´€ë¦¬"],
            },
            "builder": {
                "role": "ì°½ì˜ì ì´ê³  ì‹¤ìš©ì ì¸ ê°œë°œ ì „ë¬¸ê°€",
                "style": "ê¸°ìˆ ì ì´ë©´ì„œë„ ì´í•´í•˜ê¸° ì‰¬ìš´ ì„¤ëª…",
                "expertise": [
                    "í”„ë¡œê·¸ë˜ë°",
                    "ì›¹ê°œë°œ",
                    "ì•±ê°œë°œ",
                    "ì‹œìŠ¤í…œì„¤ê³„",
                    "ê¸°ìˆ ì•„í‚¤í…ì²˜",
                ],
            },
            "counselor": {
                "role": "ë”°ëœ»í•˜ê³  ê³µê°ëŠ¥ë ¥ì´ ë›°ì–´ë‚œ ìƒë‹´ ì „ë¬¸ê°€",
                "style": "ê²½ì²­í•˜ê³  ê³µê°í•˜ë©° ë”°ëœ»í•œ ì¡°ì–¸",
                "expertise": [
                    "ì‹¬ë¦¬ìƒë‹´",
                    "ê°ˆë“±í•´ê²°",
                    "ìŠ¤íŠ¸ë ˆìŠ¤ê´€ë¦¬",
                    "ì¸ê°„ê´€ê³„",
                    "ê°ì •ê´€ë¦¬",
                ],
            },
            "creative": {
                "role": "ì˜ê°ì´ ë„˜ì¹˜ê³  ì°½ì˜ì ì¸ ì•„ì´ë””ì–´ ì „ë¬¸ê°€",
                "style": "ë…ì°½ì ì´ê³  í¥ë¯¸ë¡œìš´ ì•„ì´ë””ì–´ ì œì‹œ",
                "expertise": ["ì°½ì‘", "ë””ìì¸", "ë¸Œëœë”©", "ì½˜í…ì¸ ê¸°íš", "ì•„ì´ë””ì–´ë°œìƒ"],
            },
            "data_analyst": {
                "role": "ë…¼ë¦¬ì ì´ê³  ë¶„ì„ì ì¸ ë°ì´í„° ì „ë¬¸ê°€",
                "style": "ê·¼ê±°ì™€ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ í•œ ê°ê´€ì  ë¶„ì„",
                "expertise": [
                    "ë°ì´í„°ë¶„ì„",
                    "í†µê³„",
                    "ì‹œê°í™”",
                    "ì˜ˆì¸¡ëª¨ë¸ë§",
                    "ë¹„ì¦ˆë‹ˆìŠ¤ì¸í…”ë¦¬ì „ìŠ¤",
                ],
            },
            "fortune": {
                "role": "ì‹ ë¹„ë¡­ê³  ì§€í˜œë¡œìš´ ìš´ì„¸ ì „ë¬¸ê°€",
                "style": "ì‹ ë¹„ë¡œìš°ë©´ì„œë„ í¬ë§ì ì¸ ë©”ì‹œì§€",
                "expertise": ["ìš´ì„¸", "ì ì„±ìˆ ", "íƒ€ë¡œ", "í’ìˆ˜", "ìš´ëª…í•´ì„"],
            },
            "growth": {
                "role": "ë™ê¸°ë¶€ì—¬ê°€ ë„˜ì¹˜ëŠ” ì„±ì¥ ì „ë¬¸ê°€",
                "style": "ê²©ë ¤í•˜ê³  ë™ê¸°ë¶€ì—¬í•˜ëŠ” ê¸ì •ì  ì¡°ì–¸",
                "expertise": [
                    "ìê¸°ê³„ë°œ",
                    "ëª©í‘œì„¤ì •",
                    "ìŠµê´€í˜•ì„±",
                    "ë™ê¸°ë¶€ì—¬",
                    "ì„±ì¥ì „ëµ",
                ],
            },
            "hr": {
                "role": "ì‚¬ëŒ ì¤‘ì‹¬ì˜ ì¸ì‚¬ ê´€ë¦¬ ì „ë¬¸ê°€",
                "style": "ë°°ë ¤ ê¹Šê³  ê³µì •í•œ ì¸ì‚¬ ê´€ë¦¬ ì¡°ì–¸",
                "expertise": ["ì±„ìš©", "ì¸ì‚¬í‰ê°€", "ì¡°ì§ë¬¸í™”", "ë¦¬ë”ì‹­", "íŒ€ê´€ë¦¬"],
            },
            "marketing": {
                "role": "íŠ¸ë Œë“œì— ë¯¼ê°í•œ ë§ˆì¼€íŒ… ì „ë¬¸ê°€",
                "style": "ì°½ì˜ì ì´ê³  ì‹¤í–‰ ê°€ëŠ¥í•œ ë§ˆì¼€íŒ… ì „ëµ",
                "expertise": [
                    "ë¸Œëœë“œë§ˆì¼€íŒ…",
                    "ë””ì§€í„¸ë§ˆì¼€íŒ…",
                    "ê³ ê°ë¶„ì„",
                    "ë§ˆì¼€íŒ…ì „ëµ",
                    "ê´‘ê³ ê¸°íš",
                ],
            },
            "medical": {
                "role": "ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì˜ë£Œ ì •ë³´ ì „ë¬¸ê°€",
                "style": "ì •í™•í•˜ê³  ì‹ ì¤‘í•œ ì˜í•™ ì •ë³´ ì œê³µ",
                "expertise": [
                    "ê±´ê°•ê´€ë¦¬",
                    "ì§ˆë³‘ì˜ˆë°©",
                    "ì˜í•™ì •ë³´",
                    "ê±´ê°•ê²€ì§„",
                    "ìƒí™œìŠµê´€",
                ],
            },
            "sales": {
                "role": "ì—´ì •ì ì´ê³  ì„¤ë“ë ¥ ìˆëŠ” ì˜ì—… ì „ë¬¸ê°€",
                "style": "ì ê·¹ì ì´ê³  ì„±ê³¼ì§€í–¥ì ì¸ ì˜ì—… ì¡°ì–¸",
                "expertise": ["ì˜ì—…ì „ëµ", "ê³ ê°ê´€ê³„", "í˜‘ìƒê¸°ìˆ ", "ë§¤ì¶œê´€ë¦¬", "ì„¸ì¼ì¦ˆ"],
            },
            "seo": {
                "role": "ê²€ìƒ‰ì—”ì§„ì— ì •í†µí•œ SEO ì „ë¬¸ê°€",
                "style": "ê¸°ìˆ ì ì´ë©´ì„œë„ ì‹¤ë¬´ì ì¸ SEO ì¡°ì–¸",
                "expertise": [
                    "ê²€ìƒ‰ìµœì í™”",
                    "í‚¤ì›Œë“œë¶„ì„",
                    "ì›¹ì‚¬ì´íŠ¸ìµœì í™”",
                    "êµ¬ê¸€SEO",
                    "ì½˜í…ì¸ SEO",
                ],
            },
            "shopping": {
                "role": "í•©ë¦¬ì ì´ê³  íŠ¸ë Œë“œì— ë¯¼ê°í•œ ì‡¼í•‘ ì „ë¬¸ê°€",
                "style": "ì‹¤ìš©ì ì´ê³  ê²½ì œì ì¸ êµ¬ë§¤ ì¡°ì–¸",
                "expertise": [
                    "ì œí’ˆë¹„êµ",
                    "ê°€ê²©ë¶„ì„",
                    "ì‡¼í•‘íŒ",
                    "ì†Œë¹„íŒ¨í„´",
                    "êµ¬ë§¤ê°€ì´ë“œ",
                ],
            },
            "startup": {
                "role": "ë„ì „ì •ì‹ ì´ ê°•í•œ ì°½ì—… ì „ë¬¸ê°€",
                "style": "í˜„ì‹¤ì ì´ë©´ì„œë„ ê¿ˆì„ ì‘ì›í•˜ëŠ” ì°½ì—… ì¡°ì–¸",
                "expertise": [
                    "ì°½ì—…ì „ëµ",
                    "ë¹„ì¦ˆë‹ˆìŠ¤ëª¨ë¸",
                    "íˆ¬ììœ ì¹˜",
                    "ìŠ¤íƒ€íŠ¸ì—…ê²½ì˜",
                    "ì‚¬ì—…ê³„íš",
                ],
            },
            "village_chief": {
                "role": "ê²½í—˜ì´ í’ë¶€í•˜ê³  ì§€í˜œë¡œìš´ ë¦¬ë”",
                "style": "í¬ìš©ë ¥ ìˆê³  ê· í˜•ì¡íŒ ì¢…í•©ì  ì¡°ì–¸",
                "expertise": [
                    "ë¦¬ë”ì‹­",
                    "ì¡°ì§ê´€ë¦¬",
                    "ê°ˆë“±ì¡°ì •",
                    "ì˜ì‚¬ê²°ì •",
                    "ì»¤ë®¤ë‹ˆí‹°ê´€ë¦¬",
                ],
            },
            "writing": {
                "role": "ë¬¸ì¥ë ¥ì´ ë›°ì–´ë‚œ ê¸€ì“°ê¸° ì „ë¬¸ê°€",
                "style": "ëª…í™•í•˜ê³  í’ˆê²© ìˆëŠ” ë¬¸ì„œ ì‘ì„± ì¡°ì–¸",
                "expertise": [
                    "ë¬¸ì„œì‘ì„±",
                    "ê¸€ì“°ê¸°",
                    "ë…¼ë¬¸ì‘ì„±",
                    "ë³´ê³ ì„œ",
                    "ì½˜í…ì¸ ë¼ì´íŒ…",
                ],
            },
        }

        personality = agent_personalities.get(
            agent_type,
            {"role": "ì „ë¬¸ê°€", "style": "ë„ì›€ì´ ë˜ëŠ” ì¡°ì–¸", "expertise": ["ì „ë¬¸ìƒë‹´"]},
        )

        # ì§ˆë¬¸ ë¶„ì„ ë° ë§¥ë½ì  ì‘ë‹µ ìƒì„±
        return self._generate_contextual_response(question, info, personality)

    def _generate_contextual_response(
        self, question: str, info: dict, personality: dict
    ) -> str:
        """ë§¥ë½ì„ ê³ ë ¤í•œ ìì—°ìŠ¤ëŸ¬ìš´ ì‘ë‹µ ìƒì„±"""

        # ì§ˆë¬¸ ê¸¸ì´ì™€ ë³µì¡ë„ ë¶„ì„
        question_length = len(question)
        question_lower = question.lower()

        # ì¸ì‚¬ë§ ì²˜ë¦¬
        greetings = ["ì•ˆë…•", "í•˜ì´", "í—¬ë¡œ", "hi", "hello"]
        if (
            any(greeting in question_lower for greeting in greetings)
            and question_length < 20
        ):
            responses = [
                f"{info['emoji']} ì•ˆë…•í•˜ì„¸ìš”! {info['name']}ì…ë‹ˆë‹¤! ì–´ë–¤ {info['field']} ê´€ë ¨ ë„ì›€ì´ í•„ìš”í•˜ì‹ ê°€ìš”?",
                f"{info['emoji']} ë°˜ê°‘ìŠµë‹ˆë‹¤! {info['name']}ê°€ ì¸ì‚¬ë“œë ¤ìš”. {info['field']} ì „ë¬¸ê°€ë¡œì„œ ìµœì„ ì„ ë‹¤í•´ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤!",
                f"{info['emoji']} ì•ˆë…•í•˜ì„¸ìš”! {info['field']} ì „ë¬¸ê°€ {info['name']}ì…ë‹ˆë‹¤. ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?",
            ]
            return random.choice(responses)

        # ê°ì‚¬ í‘œí˜„ ì²˜ë¦¬
        thanks = ["ê³ ë§ˆì›Œ", "ê°ì‚¬", "ê³ ë§™", "thanks", "thank"]
        if any(thank in question_lower for thank in thanks):
            responses = [
                f"{info['emoji']} ë³„ë§ì”€ì„ìš”! {info['name']}ë¡œì„œ ë„ì›€ì´ ë˜ì—ˆë‹¤ë‹ˆ ì •ë§ ê¸°ì©ë‹ˆë‹¤!",
                f"{info['emoji']} ì²œë§Œì—ìš”! {info['field']} ê´€ë ¨í•´ì„œ ì–¸ì œë“  ì°¾ì•„ì£¼ì„¸ìš”!",
                f"{info['emoji']} ë„ì›€ì´ ë˜ì–´ì„œ ë‹¤í–‰ì´ì—ìš”! {info['name']}ëŠ” í•­ìƒ ì—¬ê¸° ìˆìŠµë‹ˆë‹¤!",
            ]
            return random.choice(responses)

        # ì „ë¬¸ ë¶„ì•¼ í‚¤ì›Œë“œê°€ í¬í•¨ëœ ê²½ìš°
        if any(
            expertise in question_lower
            for expertise in personality.get("expertise", [])
        ):
            return self._generate_expert_response(question, info, personality)

        # ì¼ë°˜ì ì¸ ì§ˆë¬¸ì— ëŒ€í•œ ì „ë¬¸ê°€ì  ê´€ì  ì œì‹œ
        return self._generate_general_expert_response(question, info, personality)

    def _generate_expert_response(
        self, question: str, info: dict, personality: dict
    ) -> str:
        """ì „ë¬¸ ë¶„ì•¼ ê´€ë ¨ ì‘ë‹µ ìƒì„± - ë” ê¸¸ê³  êµ¬ì²´ì ì¸ ì‘ë‹µ"""

        specific_solution = self._get_detailed_solution(question, info["field"])
        practical_steps = self._get_practical_steps(question, info["field"])
        expert_tips = self._get_expert_tips(question, info["field"])

        return f"""{info['emoji']} {info['name']}ì…ë‹ˆë‹¤!

'{question}'ì— ëŒ€í•´ {personality['role']}ë¡œì„œ ì „ë¬¸ì ì´ê³  ìƒì„¸í•œ ë‹µë³€ì„ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

ğŸ¯ **ì‹¬ì¸µ ì „ë¬¸ê°€ ë¶„ì„:**
ì§ˆë¬¸í•˜ì‹  ë‚´ìš©ì€ {info['field']} ë¶„ì•¼ì—ì„œ ë§¤ìš° ì¤‘ìš”í•œ ì£¼ì œì…ë‹ˆë‹¤. {personality['style']}ì™€ í•¨ê»˜ ì‹¤ë¬´ì—ì„œ ë°”ë¡œ ì ìš©í•  ìˆ˜ ìˆëŠ” êµ¬ì²´ì ì¸ ë°©ë²•ë¡ ì„ ì œì‹œí•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

ğŸ’¡ **ìƒì„¸ ì†”ë£¨ì…˜:**
{specific_solution}

ğŸ“‹ **ë‹¨ê³„ë³„ ì‹¤í–‰ ë°©ì•ˆ:**
{practical_steps}

â­ **ì „ë¬¸ê°€ ë…¸í•˜ìš°:**
{expert_tips}

ğŸ” **ì‹¬í™” ë¶„ì„:**
{self._get_deep_analysis(question, info["field"])}

âœ¨ **ì„±ê³µ ì‚¬ë¡€ ë° ì£¼ì˜ì‚¬í•­:**
{self._get_success_cases_and_warnings(info["field"])}

ğŸš€ **ë‹¤ìŒ ë‹¨ê³„ ë¡œë“œë§µ:**
ì´ ì¡°ì–¸ì„ ë°”íƒ•ìœ¼ë¡œ ë‹¨ê³„ì ìœ¼ë¡œ ì‹¤í–‰í•´ë³´ì‹œê³ , ì§„í–‰ ê³¼ì •ì—ì„œ ê¶ê¸ˆí•œ ì ì´ë‚˜ êµ¬ì²´ì ì¸ ìƒí™©ì— ëŒ€í•œ ì¶”ê°€ ì¡°ì–¸ì´ í•„ìš”í•˜ì‹œë©´ ì–¸ì œë“  ë§ì”€í•´ì£¼ì„¸ìš”. {info['field']} ì „ë¬¸ê°€ë¡œì„œ ë”ìš± ì„¸ë°€í•œ ê°€ì´ë“œë¥¼ ì œê³µí•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤!"""

    def _generate_general_expert_response(
        self, question: str, info: dict, personality: dict
    ) -> str:
        """ì¼ë°˜ì ì¸ ì§ˆë¬¸ì— ëŒ€í•œ ì „ë¬¸ê°€ ê´€ì  ì‘ë‹µ - ë” ê¸¸ê³  êµ¬ì²´ì ì¸ ì‘ë‹µ"""

        field_analysis = self._get_comprehensive_analysis(question, info["field"])
        strategic_approach = self._get_strategic_approach(question, info["field"])
        implementation_guide = self._get_implementation_guide(info["field"])

        return f"""{info['emoji']} {info['name']}ì…ë‹ˆë‹¤!

'{question}'ì— ëŒ€í•´ {info['field']} ì „ë¬¸ê°€ë¡œì„œ ì¢…í•©ì ì´ê³  ì‹¬ì¸µì ì¸ ê´€ì ì„ ì œê³µí•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

ğŸ” **ì „ë¬¸ê°€ ì¢…í•© ì§„ë‹¨:**
{personality['role']}ë¡œì„œ ì´ ë¬¸ì œë¥¼ ë‹¤ê°ë„ë¡œ ë¶„ì„í•´ë³´ë©´, {info['field']} ì˜ì—­ì—ì„œ ê³ ë ¤í•´ì•¼ í•  í•µì‹¬ ìš”ì†Œë“¤ì´ ì—¬ëŸ¬ ê°€ì§€ ìˆìŠµë‹ˆë‹¤.

ğŸ’­ **ì „ëµì  ì ‘ê·¼ ë°©ë²•:**
{strategic_approach}

ğŸ“Š **ì„¸ë¶€ ë¶„ì„:**
{field_analysis}

ğŸ› ï¸ **ì‹¤í–‰ ê°€ì´ë“œ:**
{implementation_guide}

âš¡ **ì¦‰ì‹œ ì ìš© ê°€ëŠ¥í•œ ë°©ë²•:**
{self._get_immediate_actions(info["field"])}

ğŸ¯ **ì¥ê¸°ì  ì „ëµ:**
{self._get_long_term_strategy(info["field"])}

ğŸ“ **ì „ë¬¸ ìƒë‹´ ì•ˆë‚´:**
{info['field']} ë¶„ì•¼ì˜ íŠ¹ì„±ìƒ ê°œë³„ ìƒí™©ì— ë”°ë¼ ì ‘ê·¼ ë°©ë²•ì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. êµ¬ì²´ì ì¸ ìƒí™©ì´ë‚˜ ì¶”ê°€ì ì¸ ë°°ê²½ ì •ë³´ë¥¼ ì•Œë ¤ì£¼ì‹œë©´, {personality['role']}ë¡œì„œ ë”ìš± ì •ë°€í•˜ê³  ë§ì¶¤í˜• ì†”ë£¨ì…˜ì„ ì œê³µí•´ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

ì–¸ì œë“  ì„¸ë¶€ì ì¸ ì§ˆë¬¸ì´ë‚˜ í›„ì† ìƒë‹´ì´ í•„ìš”í•˜ì‹œë©´ {info['name']}ë¥¼ ì°¾ì•„ì£¼ì„¸ìš”!"""

    def _get_specific_solution(self, question: str, field: str) -> str:
        """ë¶„ì•¼ë³„ êµ¬ì²´ì  ì†”ë£¨ì…˜ ì œê³µ"""

        solutions = {
            "ì—…ë¬´ ê´€ë¦¬": "íš¨ìœ¨ì ì¸ ì‹œê°„ ê´€ë¦¬ì™€ ìš°ì„ ìˆœìœ„ ì„¤ì •ì„ í†µí•´ ìƒì‚°ì„±ì„ ê·¹ëŒ€í™”í•˜ê³ , ì²´ê³„ì ì¸ ì—…ë¬´ í”„ë¡œì„¸ìŠ¤ë¥¼ êµ¬ì¶•í•˜ì„¸ìš”.",
            "ê°œë°œ": "ë¬¸ì œë¥¼ ë‹¨ê³„ë³„ë¡œ ë¶„í•´í•˜ê³ , ì ì ˆí•œ ê¸°ìˆ  ìŠ¤íƒì„ ì„ íƒí•˜ì—¬ í™•ì¥ ê°€ëŠ¥í•œ ì†”ë£¨ì…˜ì„ ì„¤ê³„í•´ë³´ì„¸ìš”.",
            "ìƒë‹´": "ë¨¼ì € ê°ì •ì„ ì¶©ë¶„íˆ ì¸ì •í•˜ê³  ìˆ˜ìš©í•œ í›„, ê±´ì„¤ì ì¸ í•´ê²° ë°©ì•ˆì„ í•¨ê»˜ ëª¨ìƒ‰í•´ë‚˜ê°€ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.",
            "ì°½ì‘": "ê¸°ì¡´ì˜ í‹€ì—ì„œ ë²—ì–´ë‚˜ ìƒˆë¡œìš´ ê´€ì ìœ¼ë¡œ ì ‘ê·¼í•˜ê³ , ë‹¤ì–‘í•œ ì˜ê°ì˜ ì›ì²œì„ íƒìƒ‰í•´ë³´ì„¸ìš”.",
            "ë°ì´í„° ë¶„ì„": "ë°ì´í„°ì˜ í’ˆì§ˆì„ ë¨¼ì € ê²€ì¦í•˜ê³ , ì ì ˆí•œ ë¶„ì„ ë°©ë²•ë¡ ì„ ì ìš©í•˜ì—¬ ì˜ë¯¸ ìˆëŠ” ì¸ì‚¬ì´íŠ¸ë¥¼ ë„ì¶œí•˜ì„¸ìš”.",
            "ìš´ì„¸": "í˜„ì¬ì˜ ì—ë„ˆì§€ íë¦„ì„ ì´í•´í•˜ê³ , ê¸ì •ì ì¸ ë§ˆìŒê°€ì§ìœ¼ë¡œ ì¢‹ì€ ê¸°ìš´ì„ ëŒì–´ë‹¹ê¸°ì„¸ìš”.",
            "ì„±ì¥": "ì‘ì€ ìŠµê´€ë¶€í„° ì‹œì‘í•˜ì—¬ ê¾¸ì¤€íˆ ì‹¤ì²œí•˜ê³ , ë‹¨ê³„ì ìœ¼ë¡œ ëª©í‘œë¥¼ í™•ì¥í•´ë‚˜ê°€ì„¸ìš”.",
            "ì¸ì‚¬ ê´€ë¦¬": "êµ¬ì„±ì› ê°œê°œì¸ì˜ ê°•ì ì„ íŒŒì•…í•˜ê³ , ê³µì •í•˜ê³  íˆ¬ëª…í•œ ì‹œìŠ¤í…œì„ í†µí•´ ì¡°ì§ ì—­ëŸ‰ì„ ê·¹ëŒ€í™”í•˜ì„¸ìš”.",
            "ë§ˆì¼€íŒ…": "íƒ€ê²Ÿ ê³ ê°ì˜ ë‹ˆì¦ˆë¥¼ ì •í™•íˆ íŒŒì•…í•˜ê³ , ì°¨ë³„í™”ëœ ê°€ì¹˜ ì œì•ˆì„ í†µí•´ ë¸Œëœë“œ ê²½ìŸë ¥ì„ ê°•í™”í•˜ì„¸ìš”.",
            "ì˜ë£Œ": "ì •í™•í•œ ì§„ë‹¨ê³¼ ì „ë¬¸ì˜ ìƒë‹´ì„ ë°›ìœ¼ì‹œê³ , ì˜ˆë°© ì¤‘ì‹¬ì˜ ê±´ê°•í•œ ìƒí™œìŠµê´€ì„ ìœ ì§€í•˜ì„¸ìš”.",
            "ì˜ì—…": "ê³ ê°ì˜ ì…ì¥ì—ì„œ ìƒê°í•˜ê³ , ì§„ì •ì„± ìˆëŠ” ê´€ê³„ êµ¬ì¶•ì„ í†µí•´ ì‹ ë¢°ë¥¼ ë°”íƒ•ìœ¼ë¡œ í•œ ì˜ì—…ì„ í•˜ì„¸ìš”.",
            "ê²€ìƒ‰ ìµœì í™”": "ì‚¬ìš©ì ì˜ë„ì— ë§ëŠ” ê³ í’ˆì§ˆ ì½˜í…ì¸ ë¥¼ ì œì‘í•˜ê³ , ê¸°ìˆ ì  SEOë¥¼ ì²´ê³„ì ìœ¼ë¡œ ìµœì í™”í•˜ì„¸ìš”.",
            "ì‡¼í•‘": "ì‹ ì¤‘í•œ ë¹„êµê²€í† ë¥¼ í†µí•´ ê°€ì„±ë¹„ë¥¼ ë”°ì ¸ë³´ê³ , ì‹¤ì œ í•„ìš”ì„±ì„ ê³ ë ¤í•œ í•©ë¦¬ì  ì†Œë¹„ë¥¼ í•˜ì„¸ìš”.",
            "ì°½ì—…": "ì‹œì¥ ê²€ì¦ì„ í†µí•´ ì‹¤ì œ ê³ ê° ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ì†”ë£¨ì…˜ì„ ê°œë°œí•˜ê³ , ì ì§„ì ìœ¼ë¡œ ì‚¬ì—…ì„ í™•ì¥í•˜ì„¸ìš”.",
            "ë§ˆì„ ê´€ë¦¬": "ëª¨ë“  êµ¬ì„±ì›ì˜ ì˜ê²¬ì„ ë“£ê³  ì¡°ìœ¨í•˜ì—¬, ê³µë™ì²´ ì „ì²´ì˜ ì´ìµì„ ê³ ë ¤í•œ ê· í˜•ì¡íŒ ì˜ì‚¬ê²°ì •ì„ í•˜ì„¸ìš”.",
            "ë¬¸ì„œ ì‘ì„±": "ëª…í™•í•œ êµ¬ì¡°ì™€ ë…¼ë¦¬ì  íë¦„ì„ ê°–ì¶”ê³ , ë…ìì˜ ì…ì¥ì—ì„œ ì´í•´í•˜ê¸° ì‰½ê²Œ ì‘ì„±í•˜ì„¸ìš”.",
        }

        return solutions.get(
            field,
            "ì „ë¬¸ì ì¸ ê´€ì ì—ì„œ ì²´ê³„ì ìœ¼ë¡œ ì ‘ê·¼í•˜ê³ , ì‹¤í–‰ ê°€ëŠ¥í•œ ë°©ì•ˆì„ ë‹¨ê³„ë³„ë¡œ ìˆ˜ë¦½í•´ë³´ì„¸ìš”.",
        )

    def _get_field_specific_advice(self, question: str, field: str) -> str:
        """ë¶„ì•¼ë³„ ë§ì¶¤ ì¡°ì–¸ ì œê³µ"""

        advice = {
            "ì—…ë¬´ ê´€ë¦¬": "ì‹œê°„ ê´€ë¦¬ ë§¤íŠ¸ë¦­ìŠ¤ë¥¼ í™œìš©í•´ ì¤‘ìš”ë„ì™€ ê¸´ê¸‰ë„ë¥¼ ë¶„ë¥˜í•˜ê³ , ì§‘ì¤‘ ì‹œê°„ì„ í™•ë³´í•˜ì„¸ìš”.",
            "ê°œë°œ": "MVP(ìµœì†Œ ì‹¤í–‰ ì œí’ˆ)ë¶€í„° ì‹œì‘í•´ì„œ ì‚¬ìš©ì í”¼ë“œë°±ì„ ë°›ìœ¼ë©° ë°˜ë³µ ê°œì„ í•´ë‚˜ê°€ì„¸ìš”.",
            "ìƒë‹´": "ê²½ì²­ì˜ ìì„¸ë¡œ ìƒëŒ€ë°©ì˜ ë§ˆìŒì„ ì¶©ë¶„íˆ ì´í•´í•˜ê³ , í•¨ê»˜ í•´ê²°ì±…ì„ ì°¾ì•„ê°€ì„¸ìš”.",
            "ì°½ì‘": "ë‹¤ì–‘í•œ ê²½í—˜ê³¼ ê´€ì°°ì„ í†µí•´ ì˜ê°ì„ ì¶•ì í•˜ê³ , ì‹¤í—˜ì •ì‹ ì„ ê°–ê³  ë„ì „í•´ë³´ì„¸ìš”.",
            "ë°ì´í„° ë¶„ì„": "ê°€ì„¤ì„ ì„¸ìš°ê³  ë°ì´í„°ë¡œ ê²€ì¦í•˜ëŠ” ê³¼ì •ì„ ë°˜ë³µí•˜ì—¬ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ê²°ê³¼ë¥¼ ë„ì¶œí•˜ì„¸ìš”.",
            "ìš´ì„¸": "í˜„ì¬ì— ì¶©ì‹¤í•˜ë©´ì„œë„ ë¯¸ë˜ì— ëŒ€í•œ ê¸ì •ì  ë¹„ì „ì„ ê°–ê³  í–‰ë™í•˜ì„¸ìš”.",
            "ì„±ì¥": "SMART ëª©í‘œ ì„¤ì •ë²•ì„ í™œìš©í•´ êµ¬ì²´ì ì´ê³  ì¸¡ì • ê°€ëŠ¥í•œ ëª©í‘œë¥¼ ìˆ˜ë¦½í•˜ì„¸ìš”.",
            "ì¸ì‚¬ ê´€ë¦¬": "ì •ê¸°ì ì¸ 1:1 ë©´ë‹´ê³¼ í”¼ë“œë°±ì„ í†µí•´ êµ¬ì„±ì›ê³¼ ì†Œí†µí•˜ê³  ì„±ì¥ì„ ì§€ì›í•˜ì„¸ìš”.",
            "ë§ˆì¼€íŒ…": "ê³ ê° ì—¬ì •ì„ ë¶„ì„í•˜ê³  ê° ë‹¨ê³„ë³„ ìµœì ì˜ í„°ì¹˜í¬ì¸íŠ¸ë¥¼ ì„¤ê³„í•˜ì„¸ìš”.",
            "ì˜ë£Œ": "ì •ê¸° ê±´ê°•ê²€ì§„ê³¼ í•¨ê»˜ ê· í˜•ì¡íŒ ì‹ë‹¨, ê·œì¹™ì ì¸ ìš´ë™ìœ¼ë¡œ ê±´ê°•ì„ ê´€ë¦¬í•˜ì„¸ìš”.",
            "ì˜ì—…": "ê³ ê°ì˜ ë‹ˆì¦ˆë¥¼ íŒŒì•…í•˜ê³  ê·¸ì— ë§ëŠ” ì†”ë£¨ì…˜ì„ ì œì‹œí•˜ëŠ” ì»¨ì„¤íŒ… ì˜ì—…ì„ í•˜ì„¸ìš”.",
            "ê²€ìƒ‰ ìµœì í™”": "í‚¤ì›Œë“œ ë¦¬ì„œì¹˜ë¶€í„° ì‹œì‘í•´ì„œ ì½˜í…ì¸  ìµœì í™”ì™€ ê¸°ìˆ ì  SEOë¥¼ ë³‘í–‰í•˜ì„¸ìš”.",
            "ì‡¼í•‘": "ê°€ê²© ë¹„êµ ì‚¬ì´íŠ¸ë¥¼ í™œìš©í•˜ê³ , ë¦¬ë·°ì™€ í‰ì ì„ ê¼¼ê¼¼íˆ í™•ì¸í•œ í›„ êµ¬ë§¤í•˜ì„¸ìš”.",
            "ì°½ì—…": "ë¦° ìŠ¤íƒ€íŠ¸ì—… ë°©ë²•ë¡ ì„ ì ìš©í•´ ë¹ ë¥¸ ì‹¤í—˜ê³¼ í•™ìŠµì„ í†µí•´ ì‚¬ì—… ëª¨ë¸ì„ ê²€ì¦í•˜ì„¸ìš”.",
            "ë§ˆì„ ê´€ë¦¬": "íˆ¬ëª…í•œ ì†Œí†µ ì±„ë„ì„ êµ¬ì¶•í•˜ê³ , ì •ê¸°ì ì¸ ì˜ê²¬ ìˆ˜ë ´ì„ í†µí•´ ë¯¼ì£¼ì ìœ¼ë¡œ ìš´ì˜í•˜ì„¸ìš”.",
            "ë¬¸ì„œ ì‘ì„±": "5W1H ì›ì¹™ì— ë”°ë¼ ì •ë³´ë¥¼ ì •ë¦¬í•˜ê³ , ë‹¨ë½ë³„ í•µì‹¬ ë©”ì‹œì§€ë¥¼ ëª…í™•íˆ í•˜ì„¸ìš”.",
        }

        return advice.get(
            field, "ì „ë¬¸ ì§€ì‹ì„ ë°”íƒ•ìœ¼ë¡œ ë‹¨ê³„ì ì´ê³  ì‹¤ìš©ì ì¸ ì ‘ê·¼ ë°©ë²•ì„ ì°¾ì•„ë³´ì„¸ìš”."
        )

    def _get_detailed_solution(self, question: str, field: str) -> str:
        """ë¶„ì•¼ë³„ ìƒì„¸ ì†”ë£¨ì…˜ ì œê³µ"""

        detailed_solutions = {
            "ì—…ë¬´ ê´€ë¦¬": """
ğŸ“Š **ì‹œê°„ ê´€ë¦¬ ì²´ê³„ êµ¬ì¶•:**
â€¢ ì•„ì´ì  í•˜ì›Œ ë§¤íŠ¸ë¦­ìŠ¤ë¥¼ í™œìš©í•œ ì—…ë¬´ ìš°ì„ ìˆœìœ„ ë¶„ë¥˜
â€¢ 25ë¶„ ì§‘ì¤‘ + 5ë¶„ íœ´ì‹ í¬ëª¨ë„ë¡œ ê¸°ë²• ì ìš©
â€¢ ì¼ì¼/ì£¼ê°„/ì›”ê°„ ëª©í‘œ ì„¤ì • ë° ê²€í†  ì‹œìŠ¤í…œ êµ¬ì¶•

âš¡ **ìƒì‚°ì„± ê·¹ëŒ€í™” ì „ëµ:**
â€¢ 2ë¶„ ë£°: 2ë¶„ ë‚´ ì²˜ë¦¬ ê°€ëŠ¥í•œ ì—…ë¬´ëŠ” ì¦‰ì‹œ ì™„ë£Œ
â€¢ ë°°ì¹˜ ì²˜ë¦¬: ìœ ì‚¬í•œ ì—…ë¬´ë“¤ì„ íŠ¹ì • ì‹œê°„ëŒ€ì— ëª°ì•„ì„œ ì²˜ë¦¬
â€¢ ê¹Šì€ ì‘ì—… ì‹œê°„ í™•ë³´: í•˜ë£¨ ì¤‘ ê°€ì¥ ì§‘ì¤‘ë ¥ì´ ë†’ì€ ì‹œê°„ëŒ€ í™œìš©

ğŸ”„ **ì—…ë¬´ í”„ë¡œì„¸ìŠ¤ ìµœì í™”:**
â€¢ ë°˜ë³µ ì—…ë¬´ì˜ ìë™í™” ë° í…œí”Œë¦¿í™”
â€¢ ì—…ë¬´ ìœ„ì„ ë° ë¶„ì‚° ì²´ê³„ êµ¬ì¶•
â€¢ ì •ê¸°ì ì¸ ì—…ë¬´ í”„ë¡œì„¸ìŠ¤ ë¦¬ë·° ë° ê°œì„ """,
            "ê°œë°œ": """
ğŸ—ï¸ **ì•„í‚¤í…ì²˜ ì„¤ê³„ ì›ì¹™:**
â€¢ SOLID ì›ì¹™ì„ ì ìš©í•œ í™•ì¥ ê°€ëŠ¥í•œ êµ¬ì¡° ì„¤ê³„
â€¢ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ vs ëª¨ë†€ë¦¬ì‹ ì•„í‚¤í…ì²˜ ì„ íƒ ê¸°ì¤€
â€¢ API ì„¤ê³„ ì‹œ RESTful ì›ì¹™ ë° GraphQL ê³ ë ¤ì‚¬í•­

ğŸ’» **ê°œë°œ ë°©ë²•ë¡ :**
â€¢ ì• ìì¼/ìŠ¤í¬ëŸ¼ì„ í†µí•œ ë°˜ë³µì  ê°œë°œ í”„ë¡œì„¸ìŠ¤
â€¢ TDD(í…ŒìŠ¤íŠ¸ ì£¼ë„ ê°œë°œ)ë¡œ ì•ˆì •ì ì¸ ì½”ë“œ ì‘ì„±
â€¢ CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì¶•ìœ¼ë¡œ ë°°í¬ ìë™í™”

ğŸ”§ **ê¸°ìˆ  ìŠ¤íƒ ì„ íƒ:**
â€¢ í”„ë¡œì íŠ¸ ìš”êµ¬ì‚¬í•­ì— ë§ëŠ” ìµœì  ê¸°ìˆ  ì¡°í•©
â€¢ ì„±ëŠ¥, í™•ì¥ì„±, ìœ ì§€ë³´ìˆ˜ì„±ì„ ê³ ë ¤í•œ ê¸°ìˆ  ì„ íƒ
â€¢ íŒ€ì˜ ê¸°ìˆ  ì—­ëŸ‰ê³¼ í•™ìŠµ ê³¡ì„  ê³ ë ¤""",
            "ì°½ì‘": """
ğŸ¨ **ì°½ì‘ í”„ë¡œì„¸ìŠ¤:**
â€¢ ë¸Œë ˆì¸ìŠ¤í† ë° â†’ ì•„ì´ë””ì–´ ì •ë¦¬ â†’ í”„ë¡œí† íƒ€ì… â†’ í”¼ë“œë°± â†’ ê°œì„ 
â€¢ ë‹¤ì–‘í•œ ì°½ì‘ ê¸°ë²•: ë§ˆì¸ë“œë§µ, ìŠ¤í† ë¦¬ë³´ë“œ, ë¬´ë“œë³´ë“œ í™œìš©
â€¢ ì°½ì‘ ì¼ì§€ ì‘ì„±ìœ¼ë¡œ ì•„ì´ë””ì–´ì™€ ì˜ê° ê¸°ë¡ ê´€ë¦¬

ğŸ’¡ **ì˜ê° ë°œêµ´ ì „ëµ:**
â€¢ ë‹¤ì–‘í•œ ë¶„ì•¼ì˜ ì‘í’ˆ ê°ìƒ ë° ë¶„ì„
â€¢ ì¼ìƒ ê´€ì°°ê³¼ ê²½í—˜ì„ í†µí•œ ì†Œì¬ ë°œêµ´
â€¢ íƒ€ ë¶„ì•¼ì™€ì˜ ìœµí•©ì„ í†µí•œ ìƒˆë¡œìš´ ê´€ì  ì°½ì¶œ

ğŸš€ **ì™„ì„±ë„ í–¥ìƒ:**
â€¢ ì´ˆì•ˆ ì™„ì„± í›„ ì¶©ë¶„í•œ íœ´ì§€ê¸°ë¥¼ ê±°ì¹œ ê°ê´€ì  ê²€í† 
â€¢ ë‹¤ì–‘í•œ ê´€ì ì˜ í”¼ë“œë°± ìˆ˜ì§‘ ë° ë°˜ì˜
â€¢ ì§€ì†ì ì¸ ìˆ˜ì •ê³¼ ê°œì„ ì„ í†µí•œ í’ˆì§ˆ í–¥ìƒ""",
        }

        return detailed_solutions.get(
            field,
            f"{field} ë¶„ì•¼ì˜ ì „ë¬¸ì ì´ê³  ì²´ê³„ì ì¸ ì ‘ê·¼ ë°©ë²•ì„ í†µí•´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê³  ëª©í‘œë¥¼ ë‹¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
        )

    def _get_practical_steps(self, question: str, field: str) -> str:
        """ì‹¤ìš©ì  ë‹¨ê³„ë³„ ì‹¤í–‰ ë°©ì•ˆ"""

        steps = {
            "ì—…ë¬´ ê´€ë¦¬": """
1ï¸âƒ£ **1ë‹¨ê³„: í˜„ì¬ ìƒí™© ë¶„ì„ (1ì£¼)**
   â€¢ í˜„ì¬ ì—…ë¬´ íŒ¨í„´ ë° ì‹œê°„ ì‚¬ìš© ë¶„ì„
   â€¢ ì—…ë¬´ ìš°ì„ ìˆœìœ„ ë° ì¤‘ìš”ë„ í‰ê°€
   â€¢ ë°©í•´ ìš”ì†Œ ë° ë¹„íš¨ìœ¨ êµ¬ê°„ íŒŒì•…

2ï¸âƒ£ **2ë‹¨ê³„: ì‹œìŠ¤í…œ êµ¬ì¶• (2ì£¼)**
   â€¢ ê°œì¸ ì—…ë¬´ ê´€ë¦¬ ë„êµ¬ ì„ íƒ ë° ì„¤ì •
   â€¢ ì¼ì¼/ì£¼ê°„ ê³„íš ìˆ˜ë¦½ ë£¨í‹´ í™•ë¦½
   â€¢ ì—…ë¬´ ë¶„ë¥˜ ì²´ê³„ ë° ìš°ì„ ìˆœìœ„ ê¸°ì¤€ ì„¤ì •

3ï¸âƒ£ **3ë‹¨ê³„: ì‹¤í–‰ ë° ëª¨ë‹ˆí„°ë§ (4ì£¼)**
   â€¢ ìƒˆë¡œìš´ ì—…ë¬´ ë°©ì‹ ì ìš© ë° ìŠµê´€í™”
   â€¢ ì£¼ê°„ ë‹¨ìœ„ ì„±ê³¼ ì¸¡ì • ë° ë¶„ì„
   â€¢ í•„ìš”ì— ë”°ë¥¸ ë°©ë²•ë¡  ì¡°ì • ë° ê°œì„ """,
            "ê°œë°œ": """
1ï¸âƒ£ **1ë‹¨ê³„: ìš”êµ¬ì‚¬í•­ ë¶„ì„ ë° ì„¤ê³„**
   â€¢ í”„ë¡œì íŠ¸ ëª©í‘œ ë° ì„±ê³µ ê¸°ì¤€ ëª…í™•í™”
   â€¢ ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ ë° ë¹„ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ ì •ì˜
   â€¢ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ë° ê¸°ìˆ  ìŠ¤íƒ ê²°ì •

2ï¸âƒ£ **2ë‹¨ê³„: MVP ê°œë°œ**
   â€¢ í•µì‹¬ ê¸°ëŠ¥ ìš°ì„ ìˆœìœ„ ì„ ì •
   â€¢ í”„ë¡œí† íƒ€ì… ê°œë°œ ë° ì´ˆê¸° í…ŒìŠ¤íŠ¸
   â€¢ ì‚¬ìš©ì í”¼ë“œë°± ìˆ˜ì§‘ ë° ê²€ì¦

3ï¸âƒ£ **3ë‹¨ê³„: ë°˜ë³µ ê°œë°œ ë° ê°œì„ **
   â€¢ ìŠ¤í”„ë¦°íŠ¸ ë‹¨ìœ„ ê¸°ëŠ¥ ì¶”ê°€ ë° ê°œì„ 
   â€¢ ì§€ì†ì ì¸ í…ŒìŠ¤íŠ¸ ë° í’ˆì§ˆ ê´€ë¦¬
   â€¢ ì„±ëŠ¥ ìµœì í™” ë° í™•ì¥ì„± ê°œì„ """,
            "ì°½ì‘": """
1ï¸âƒ£ **1ë‹¨ê³„: ì•„ì´ë””ì–´ ë°œêµ´ ë° êµ¬ì²´í™”**
   â€¢ ì°½ì‘ ì£¼ì œ ë° ë°©í–¥ì„± ì„¤ì •
   â€¢ ë ˆí¼ëŸ°ìŠ¤ ì¡°ì‚¬ ë° ì˜ê° ìˆ˜ì§‘
   â€¢ ì´ˆê¸° ì»¨ì…‰ ìŠ¤ì¼€ì¹˜ ë° ì•„ì´ë””ì–´ ì •ë¦¬

2ï¸âƒ£ **2ë‹¨ê³„: ì°½ì‘ ì‹¤í–‰**
   â€¢ ìƒì„¸ ê¸°íš ë° ìŠ¤í† ë¦¬ë³´ë“œ ì‘ì„±
   â€¢ ë‹¨ê³„ë³„ ì°½ì‘ ê³¼ì • ì‹¤í–‰
   â€¢ ì¤‘ê°„ ì ê²€ ë° ë°©í–¥ì„± ì¡°ì •

3ï¸âƒ£ **3ë‹¨ê³„: ì™„ì„± ë° ë°œí‘œ**
   â€¢ ìµœì¢… ê²€í†  ë° í’ˆì§ˆ ê°œì„ 
   â€¢ ë°œí‘œ ë° ë°°í¬ ì¤€ë¹„
   â€¢ í”¼ë“œë°± ìˆ˜ì§‘ ë° í–¥í›„ ê³„íš ìˆ˜ë¦½""",
        }

        return steps.get(
            field, f"{field} ë¶„ì•¼ì˜ ì²´ê³„ì ì¸ ë‹¨ê³„ë³„ ì ‘ê·¼ì„ í†µí•´ ëª©í‘œë¥¼ ë‹¬ì„±í•˜ì„¸ìš”."
        )

    def _get_expert_tips(self, question: str, field: str) -> str:
        """ì „ë¬¸ê°€ ë…¸í•˜ìš° ë° íŒ"""

        tips = {
            "ì—…ë¬´ ê´€ë¦¬": """
ğŸ”¥ **ì‹¤ì „ ë…¸í•˜ìš°:**
â€¢ ë©”ì¼ í™•ì¸ì€ í•˜ë£¨ 3íšŒë¡œ ì œí•œí•˜ì—¬ ì§‘ì¤‘ë ¥ ìœ ì§€
â€¢ 15ë¶„ ë£°: ë³µì¡í•œ ì—…ë¬´ë„ 15ë¶„ê°„ ì‹œì‘í•´ë³´ë©´ ì €í•­ê° ê·¹ë³µ
â€¢ ì—ë„ˆì§€ ë ˆë²¨ì— ë§ëŠ” ì—…ë¬´ ë°°ì¹˜ (ì˜¤ì „=ì°½ì‘ì—…ë¬´, ì˜¤í›„=ë‹¨ìˆœì—…ë¬´)

âš ï¸ **ì£¼ì˜ì‚¬í•­:**
â€¢ ì™„ë²½ì£¼ì˜ í•¨ì •ì— ë¹ ì§€ì§€ ë§ê³  80% ì™„ì„±ë„ì—ì„œ ë‹¤ìŒ ë‹¨ê³„ë¡œ
â€¢ ë©€í‹°íƒœìŠ¤í‚¹ë³´ë‹¤ëŠ” ì§‘ì¤‘ì ì¸ ë‹¨ì¼ ì‘ì—…ì´ ë” íš¨ìœ¨ì 
â€¢ ë²ˆì•„ì›ƒ ë°©ì§€ë¥¼ ìœ„í•œ ì ì ˆí•œ íœ´ì‹ê³¼ ì—¬ìœ  ì‹œê°„ í™•ë³´""",
            "ê°œë°œ": """
ğŸ”¥ **ê°œë°œ ë…¸í•˜ìš°:**
â€¢ ì½”ë“œ ë¦¬ë·°ë¥¼ í†µí•œ ì§€ì†ì ì¸ í’ˆì§ˆ í–¥ìƒ
â€¢ ë¬¸ì„œí™”ëŠ” ë¯¸ë˜ì˜ ë‚˜ì™€ íŒ€ì„ ìœ„í•œ íˆ¬ì
â€¢ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„ íƒ ì‹œ ì»¤ë®¤ë‹ˆí‹° í™œì„±ë„ì™€ ìœ ì§€ë³´ìˆ˜ ìƒíƒœ ê³ ë ¤

âš ï¸ **í”¼í•´ì•¼ í•  í•¨ì •:**
â€¢ ê³¼ë„í•œ ìµœì í™”ë³´ë‹¤ëŠ” ê°€ë…ì„±ê³¼ ìœ ì§€ë³´ìˆ˜ì„± ìš°ì„ 
â€¢ ìƒˆë¡œìš´ ê¸°ìˆ  ë„ì… ì‹œ ì¶©ë¶„í•œ ê²€ì¦ ê³¼ì • í•„ìš”
â€¢ ê¸°ìˆ  ë¶€ì±„ ëˆ„ì  ë°©ì§€ë¥¼ ìœ„í•œ ì •ê¸°ì ì¸ ë¦¬íŒ©í† ë§""",
            "ì°½ì‘": """
ğŸ”¥ **ì°½ì‘ ë…¸í•˜ìš°:**
â€¢ ì•„ì´ë””ì–´ ê³ ê°ˆ ì‹œì—ëŠ” ê¸°ì¡´ ì‘í’ˆì˜ ì¬í•´ì„ì´ë‚˜ ì¡°í•© ì‹œë„
â€¢ ì°½ì‘ ë¸”ë¡ ê·¹ë³µë²•: í™˜ê²½ ë³€í™”, ì‚°ì±…, ë‹¤ë¥¸ í™œë™ìœ¼ë¡œ ì „í™˜
â€¢ ë¹„íŒì  ì‹œê°ê³¼ ì°½ì‘ ëª¨ë“œë¥¼ ë¶„ë¦¬í•˜ì—¬ ì°½ì˜ì„± ë³´í˜¸

âš ï¸ **ì°½ì‘ í•¨ì •:**
â€¢ ì²« ì‘í’ˆë¶€í„° ì™„ë²½ì„ ì¶”êµ¬í•˜ì§€ ë§ê³  ì™„ì„±ì— ì§‘ì¤‘
â€¢ íƒ€ì¸ì˜ í‰ê°€ì— ê³¼ë„í•˜ê²Œ ì˜ì¡´í•˜ì§€ ë§ê³  ìì‹ ë§Œì˜ ê¸°ì¤€ í™•ë¦½
â€¢ ì˜ê° ëŒ€ê¸°ë³´ë‹¤ëŠ” ê·œì¹™ì ì¸ ì°½ì‘ ìŠµê´€ìœ¼ë¡œ ì‹¤ë ¥ í–¥ìƒ""",
        }

        return tips.get(
            field,
            f"{field} ë¶„ì•¼ì—ì„œ ì„±ê³µí•˜ê¸° ìœ„í•œ ì „ë¬¸ê°€ë§Œì˜ ì‹¤ì „ ë…¸í•˜ìš°ë¥¼ ì ìš©í•´ë³´ì„¸ìš”.",
        )

    def _get_deep_analysis(self, question: str, field: str) -> str:
        """ì‹¬í™” ë¶„ì„"""

        analysis = {
            "ì—…ë¬´ ê´€ë¦¬": "ì—…ë¬´ ê´€ë¦¬ì˜ í•µì‹¬ì€ ì‹œê°„ì´ ì•„ë‹Œ ì—ë„ˆì§€ ê´€ë¦¬ì…ë‹ˆë‹¤. ê°œì¸ì˜ ìƒì²´ë¦¬ë“¬ê³¼ ì—ë„ˆì§€ íŒ¨í„´ì„ íŒŒì•…í•˜ì—¬ ì¤‘ìš”í•œ ì—…ë¬´ë¥¼ ê³ ì—ë„ˆì§€ ì‹œê°„ëŒ€ì— ë°°ì¹˜í•˜ê³ , ë£¨í‹´ ì—…ë¬´ëŠ” ì €ì—ë„ˆì§€ ì‹œê°„ëŒ€ì— ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ íš¨ìœ¨ì„±ì„ ê·¹ëŒ€í™”í•˜ëŠ” ë¹„ê²°ì…ë‹ˆë‹¤.",
            "ê°œë°œ": "ì„±ê³µì ì¸ ê°œë°œ í”„ë¡œì íŠ¸ì˜ í•µì‹¬ì€ ê¸°ìˆ ì  ì™„ì„±ë„ë³´ë‹¤ëŠ” ì‚¬ìš©ì ë¬¸ì œ í•´ê²°ì— ìˆìŠµë‹ˆë‹¤. ê¸°ìˆ  ìŠ¤íƒ ì„ íƒê³¼ ì•„í‚¤í…ì²˜ ì„¤ê³„ ì‹œ í˜„ì¬ ìš”êµ¬ì‚¬í•­ë¿ë§Œ ì•„ë‹ˆë¼ ë¯¸ë˜ í™•ì¥ ê°€ëŠ¥ì„±ì„ ê³ ë ¤í•œ ê· í˜•ì ì„ ì°¾ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.",
            "ì°½ì‘": "ì§„ì •í•œ ì°½ì‘ì€ ê¸°ì¡´ì˜ ê²ƒì„ ì™„ì „íˆ ìƒˆë¡­ê²Œ ë§Œë“œëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ê¸°ì¡´ ìš”ì†Œë“¤ì˜ ìƒˆë¡œìš´ ì¡°í•©ê³¼ ê°œì¸ì  í•´ì„ì„ í†µí•´ ë…ì°½ì„±ì„ ë°œí˜„í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ëª¨ë°©ì—ì„œ ì‹œì‘í•˜ì—¬ ì ì§„ì ìœ¼ë¡œ ìì‹ ë§Œì˜ ìŠ¤íƒ€ì¼ì„ ë°œì „ì‹œí‚¤ëŠ” ê²ƒì´ íš¨ê³¼ì ì…ë‹ˆë‹¤.",
        }

        return analysis.get(
            field, f"{field} ë¶„ì•¼ì˜ ë³¸ì§ˆì  ì´í•´ë¥¼ ë°”íƒ•ìœ¼ë¡œ í•œ ì „ë¬¸ì  ì ‘ê·¼ì´ í•„ìš”í•©ë‹ˆë‹¤."
        )

    def _get_success_cases_and_warnings(self, field: str) -> str:
        """ì„±ê³µ ì‚¬ë¡€ ë° ì£¼ì˜ì‚¬í•­"""

        cases = {
            "ì—…ë¬´ ê´€ë¦¬": """
âœ… **ì„±ê³µ ì‚¬ë¡€:** ê¸€ë¡œë²Œ ê¸°ì—… CEOë“¤ì´ ê³µí†µì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” 'ì‹œê°„ ë¸”ë¡í‚¹' ê¸°ë²•ìœ¼ë¡œ í•˜ë£¨ë¥¼ ë¯¸ë¦¬ ê³„íšëœ ë¸”ë¡ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ê´€ë¦¬
âš ï¸ **ì£¼ì˜ì‚¬í•­:** ê³¼ë„í•œ ê³„íšìœ¼ë¡œ ì¸í•œ ìŠ¤íŠ¸ë ˆìŠ¤ë³´ë‹¤ëŠ” 80% ê³„íš + 20% ì—¬ìœ  ê³µê°„ í™•ë³´ê°€ í˜„ì‹¤ì """,
            "ê°œë°œ": """
âœ… **ì„±ê³µ ì‚¬ë¡€:** ë„·í”Œë¦­ìŠ¤ì˜ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ë¡œ í™•ì¥ì„±ê³¼ ì•ˆì •ì„±ì„ ë™ì‹œì— í™•ë³´í•œ ì‚¬ë¡€
âš ï¸ **ì£¼ì˜ì‚¬í•­:** ë³µì¡í•œ ì•„í‚¤í…ì²˜ë³´ë‹¤ëŠ” í˜„ì¬ íŒ€ ê·œëª¨ì™€ ìš”êµ¬ì‚¬í•­ì— ì í•©í•œ ë‹¨ìˆœí•œ êµ¬ì¡°ê°€ ë” íš¨ê³¼ì ì¼ ìˆ˜ ìˆìŒ""",
            "ì°½ì‘": """
âœ… **ì„±ê³µ ì‚¬ë¡€:** í”½ì‚¬ì˜ ìŠ¤í† ë¦¬í…”ë§ ë°©ë²•ë¡ ìœ¼ë¡œ ê¸°ìˆ ì  í˜ì‹ ê³¼ ê°ì •ì  ê³µê°ì„ ê²°í•©í•œ ì‘í’ˆ ì°½ì‘
âš ï¸ **ì£¼ì˜ì‚¬í•­:** íŠ¸ë Œë“œë§Œ ë”°ë¼ê°€ëŠ” ì°½ì‘ë³´ë‹¤ëŠ” ê°œì¸ì˜ ê³ ìœ í•œ ê´€ì ê³¼ ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ í•œ ì§„ì •ì„± ìˆëŠ” ì‘í’ˆì´ ë” ì˜¤ë˜ ê¸°ì–µë¨""",
        }

        return cases.get(
            field,
            f"{field} ë¶„ì•¼ì˜ ì‹¤ì œ ì„±ê³µ ì‚¬ë¡€ë¥¼ ì°¸ê³ í•˜ë˜, ê°œë³„ ìƒí™©ì— ë§ëŠ” ì ìš©ì´ ì¤‘ìš”í•©ë‹ˆë‹¤.",
        )

    def _get_comprehensive_analysis(self, question: str, field: str) -> str:
        """ì¢…í•©ì  ë¶„ì„"""

        return f"{field} ë¶„ì•¼ì—ì„œ ì œê¸°ëœ ë¬¸ì œëŠ” ë‹¨ìˆœíˆ ê¸°ìˆ ì  í•´ê²°ì±…ë§Œìœ¼ë¡œëŠ” ì™„ì „í•œ í•´ê²°ì´ ì–´ë ¤ìš°ë©°, ì¸ê°„ì  ìš”ì†Œ, í™˜ê²½ì  ìš”ì¸, ê·¸ë¦¬ê³  ì¥ê¸°ì  ê´€ì ì„ ëª¨ë‘ ê³ ë ¤í•œ í†µí•©ì  ì ‘ê·¼ì´ í•„ìš”í•©ë‹ˆë‹¤."

    def _get_strategic_approach(self, question: str, field: str) -> str:
        """ì „ëµì  ì ‘ê·¼ë²•"""

        approaches = {
            "ì—…ë¬´ ê´€ë¦¬": "ê°œì¸ì˜ ì—…ë¬´ ìŠ¤íƒ€ì¼ê³¼ ì¡°ì§ ë¬¸í™”ë¥¼ ì¡°í™”ì‹œí‚¤ë©´ì„œ, ë‹¨ê¸° íš¨ìœ¨ì„±ê³¼ ì¥ê¸° ì§€ì†ê°€ëŠ¥ì„±ì˜ ê· í˜•ì„ ë§ì¶”ëŠ” ì „ëµì  ì ‘ê·¼",
            "ê°œë°œ": "ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­ê³¼ ê¸°ìˆ ì  ì œì•½ì‚¬í•­ì„ ê³ ë ¤í•œ ì ì§„ì  ê°œë°œ ì „ëµìœ¼ë¡œ, ìœ„í—˜ì„ ìµœì†Œí™”í•˜ë©´ì„œ ê°€ì¹˜ ì°½ì¶œì„ ê·¹ëŒ€í™”",
            "ì°½ì‘": "ê°œì¸ì˜ ì°½ì‘ ì² í•™ê³¼ ì‹œì¥ì˜ ìš”êµ¬ë¥¼ ê· í˜•ìˆê²Œ ë°˜ì˜í•˜ì—¬, ì˜ˆìˆ ì  ì™„ì„±ë„ì™€ ëŒ€ì¤‘ì  ì–´í•„ì„ ë™ì‹œì— ì¶”êµ¬í•˜ëŠ” ì „ëµ",
        }

        return approaches.get(
            field, f"{field} ë¶„ì•¼ì˜ íŠ¹ì„±ì„ ê³ ë ¤í•œ ë§ì¶¤í˜• ì „ëµì  ì ‘ê·¼ì´ í•„ìš”í•©ë‹ˆë‹¤."
        )

    def _get_implementation_guide(self, field: str) -> str:
        """êµ¬í˜„ ê°€ì´ë“œ"""

        guides = {
            "ì—…ë¬´ ê´€ë¦¬": "í˜„ì¬ ì—…ë¬´ íŒ¨í„´ ë¶„ì„ â†’ ê°œì„  í¬ì¸íŠ¸ ì‹ë³„ â†’ ë‹¨ê³„ì  ë³€í™” ì ìš© â†’ íš¨ê³¼ ì¸¡ì • â†’ ì§€ì†ì  ê°œì„ ì˜ ìˆœí™˜ êµ¬ì¡°ë¡œ ì‹¤í–‰",
            "ê°œë°œ": "ìš”êµ¬ì‚¬í•­ ì •ì˜ â†’ í”„ë¡œí† íƒ€ì… ê°œë°œ â†’ ì‚¬ìš©ì ê²€ì¦ â†’ ë°˜ë³µ ê°œì„  â†’ í™•ì¥ì˜ ì• ìì¼ ë°©ì‹ìœ¼ë¡œ ì ì§„ì  êµ¬í˜„",
            "ì°½ì‘": "ì•„ì´ë””ì–´ ë°œêµ´ â†’ ì»¨ì…‰ êµ¬ì²´í™” â†’ ì‹œì•ˆ ì œì‘ â†’ í”¼ë“œë°± ë°˜ì˜ â†’ ìµœì¢… ì™„ì„±ì˜ ë°˜ë³µì  ì°½ì‘ í”„ë¡œì„¸ìŠ¤ë¡œ ì§„í–‰",
        }

        return guides.get(
            field,
            f"{field} ë¶„ì•¼ì˜ ì²´ê³„ì ì¸ êµ¬í˜„ ë°©ë²•ë¡ ì„ ì ìš©í•˜ì—¬ ë‹¨ê³„ì ìœ¼ë¡œ ì§„í–‰í•˜ì„¸ìš”.",
        )

    def _get_immediate_actions(self, field: str) -> str:
        """ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ ë°©ë²•"""

        actions = {
            "ì—…ë¬´ ê´€ë¦¬": "ì˜¤ëŠ˜ë¶€í„° ì‹œì‘: â‘  í•˜ë£¨ ê°€ì¥ ì¤‘ìš”í•œ ì—…ë¬´ 3ê°œ ì„ ì • â‘¡ ì§‘ì¤‘ ì‹œê°„ 1ì‹œê°„ í™•ë³´ â‘¢ ì—…ë¬´ ì¢…ë£Œ ì‹œ ë‹¤ìŒë‚  ê³„íš 5ë¶„ íˆ¬ì",
            "ê°œë°œ": "ì§€ê¸ˆ ë°”ë¡œ ì‹œì‘: â‘  í”„ë¡œì íŠ¸ ìš”êµ¬ì‚¬í•­ í•œ ì¤„ ì •ë¦¬ â‘¡ ê°€ì¥ ë‹¨ìˆœí•œ ê¸°ëŠ¥ë¶€í„° êµ¬í˜„ â‘¢ 15ë¶„ ë‚´ ì‹¤í–‰ ê°€ëŠ¥í•œ í”„ë¡œí† íƒ€ì… ì œì‘",
            "ì°½ì‘": "ë‹¹ì¥ ì‹¤í–‰: â‘  ìŠ¤ë§ˆíŠ¸í°ìœ¼ë¡œ ì¼ìƒì˜ í¥ë¯¸ë¡œìš´ ìˆœê°„ ì‚¬ì§„ ì´¬ì˜ â‘¡ 10ë¶„ê°„ ììœ ë¡œìš´ ìŠ¤ì¼€ì¹˜ë‚˜ ê¸€ì“°ê¸° â‘¢ ì¢‹ì•„í•˜ëŠ” ì‘í’ˆ í•˜ë‚˜ ì„ ì •í•˜ì—¬ ë¶„ì„",
        }

        return actions.get(
            field,
            f"{field} ë¶„ì•¼ì—ì„œ ì§€ê¸ˆ ë‹¹ì¥ ì‹œì‘í•  ìˆ˜ ìˆëŠ” ì‘ì€ í–‰ë™ë¶€í„° ì‹œì‘í•´ë³´ì„¸ìš”.",
        )

    def _get_long_term_strategy(self, field: str) -> str:
        """ì¥ê¸°ì  ì „ëµ"""

        strategies = {
            "ì—…ë¬´ ê´€ë¦¬": "6ê°œì›” ëª©í‘œ: ê°œì¸ ë§ì¶¤í˜• ì—…ë¬´ ì‹œìŠ¤í…œ ì™„ì„± / 1ë…„ ëª©í‘œ: ì—…ë¬´ íš¨ìœ¨ì„± 50% í–¥ìƒ ë° ì›Œë¼ë°¸ í™•ë¦½ / 3ë…„ ëª©í‘œ: ì „ë¬¸ì„± ê¸°ë°˜ ì—…ë¬´ ìë™í™” ì‹œìŠ¤í…œ êµ¬ì¶•",
            "ê°œë°œ": "6ê°œì›”: í•µì‹¬ ê¸°ëŠ¥ ì™„ì„± ë° ì‚¬ìš©ì ê²€ì¦ / 1ë…„: í™•ì¥ì„± ìˆëŠ” í”Œë«í¼ êµ¬ì¶• / 3ë…„: ì—…ê³„ í‘œì¤€ì´ ë˜ëŠ” ì†”ë£¨ì…˜ ê°œë°œ",
            "ì°½ì‘": "6ê°œì›”: ê°œì¸ ìŠ¤íƒ€ì¼ í™•ë¦½ / 1ë…„: ëŒ€í‘œì‘ ì™„ì„± ë° ì¸ì§€ë„ êµ¬ì¶• / 3ë…„: ì°½ì‘ ì˜ì—­ í™•ì¥ ë° ì˜í–¥ë ¥ ìˆëŠ” ì‘ê°€ë¡œ ì„±ì¥",
        }

        return strategies.get(
            field,
            f"{field} ë¶„ì•¼ì—ì„œì˜ ì¥ê¸°ì  ì„±ì¥ê³¼ ë°œì „ì„ ìœ„í•œ ë‹¨ê³„ë³„ ì „ëµì„ ìˆ˜ë¦½í•˜ì—¬ ì‹¤í–‰í•˜ì„¸ìš”.",
        )

    def get_agent_info(self) -> Dict[str, Any]:
        """ë„ê¹¨ë¹„ ì •ë³´ ë°˜í™˜ (í”„ë¡ íŠ¸ì—”ë“œìš©)"""
        agent_info = {
            "assistant": {
                "emoji": "ğŸ¤–",
                "name": "ë°•ì‚¬ê¸‰ ë¹„ì„œ ë„ê¹¨ë¹„",
                "field": "ì—…ë¬´ ê´€ë¦¬",
            },
            "builder": {"emoji": "ğŸ’»", "name": "ë¹Œë” ë„ê¹¨ë¹„", "field": "ê°œë°œ"},
            "counselor": {"emoji": "ğŸ’¬", "name": "ìƒë‹´ ë„ê¹¨ë¹„", "field": "ìƒë‹´"},
            "creative": {"emoji": "ğŸ¨", "name": "ì°½ì‘ ë„ê¹¨ë¹„", "field": "ì°½ì‘"},
            "data_analyst": {
                "emoji": "ğŸ“Š",
                "name": "ë°ì´í„°ë¶„ì„ ë„ê¹¨ë¹„",
                "field": "ë°ì´í„° ë¶„ì„",
            },
            "fortune": {"emoji": "ğŸ”®", "name": "ìš´ì„¸ ë„ê¹¨ë¹„", "field": "ìš´ì„¸"},
            "growth": {"emoji": "ğŸŒ±", "name": "ì„±ì¥ ë„ê¹¨ë¹„", "field": "ì„±ì¥"},
            "hr": {"emoji": "ğŸ‘¥", "name": "HR ë„ê¹¨ë¹„", "field": "ì¸ì‚¬ ê´€ë¦¬"},
            "marketing": {
                "emoji": "ğŸ“¢",
                "name": "ë§ˆì¼€íŒ… ë„ê¹¨ë¹„",
                "field": "ë§ˆì¼€íŒ…",
            },
            "medical": {"emoji": "ğŸ¥", "name": "ì˜ë£Œ ë„ê¹¨ë¹„", "field": "ì˜ë£Œ"},
            "sales": {"emoji": "ğŸ’°", "name": "ì˜ì—… ë„ê¹¨ë¹„", "field": "ì˜ì—…"},
            "seo": {"emoji": "ğŸ”", "name": "SEO ë„ê¹¨ë¹„", "field": "ê²€ìƒ‰ ìµœì í™”"},
            "shopping": {"emoji": "ğŸ›’", "name": "ì‡¼í•‘ ë„ê¹¨ë¹„", "field": "ì‡¼í•‘"},
            "startup": {"emoji": "ğŸš€", "name": "ìŠ¤íƒ€íŠ¸ì—… ë„ê¹¨ë¹„", "field": "ì°½ì—…"},
            "village_chief": {
                "emoji": "ğŸ‘‘",
                "name": "ì´ì¥ ë„ê¹¨ë¹„",
                "field": "ë§ˆì„ ê´€ë¦¬",
            },
            "writing": {
                "emoji": "âœï¸",
                "name": "ë°•ì‚¬ê¸‰ ë¬¸ì„œ ì‘ì„± ë„ê¹¨ë¹„",
                "field": "ë¬¸ì„œ ì‘ì„±",
            },
        }

        return {
            "total_agents": len(agent_info),
            "agents": agent_info,
            "categories": {
                "ì—…ë¬´&ê´€ë¦¬": ["assistant", "hr", "village_chief", "growth"],
                "ì°½ì‘&ë§ˆì¼€íŒ…": ["creative", "marketing", "writing", "seo"],
                "ê¸°ìˆ &ë¶„ì„": ["builder", "data_analyst", "medical", "startup"],
                "ìƒí™œ&ìƒë‹´": ["counselor", "fortune", "sales", "shopping"],
            },
        }


# ì „ì—­ ì¸ìŠ¤í„´ìŠ¤
stem_ai = STEMIntegration()


def add_stem_routes(app):
    """FastAPI ì•±ì— STEM ë¼ìš°íŠ¸ ì¶”ê°€"""
    from fastapi import Request
    from fastapi.responses import HTMLResponse

    @app.post("/stem/chat")
    async def stem_chat(request: Request):
        """STEM ë„ê¹¨ë¹„ì™€ ì±„íŒ…"""
        try:
            data = await request.json()
            agent_type = data.get("agent_type")
            question = data.get("question")
            user_ip = request.client.host if request.client else "unknown"

            result = stem_ai.process_question(agent_type, question, user_ip)
            return result
        except Exception as e:
            return {"success": False, "error": f"ì„œë²„ ì˜¤ë¥˜: {str(e)}"}

    @app.get("/stem/info")
    async def stem_info():
        """STEM ë„ê¹¨ë¹„ ì •ë³´ ì¡°íšŒ"""
        return stem_ai.get_agent_info()

    @app.get("/stem/stats")
    async def stem_stats():
        """STEM ì‚¬ìš© í†µê³„ ì¡°íšŒ"""
        try:
            from usage_tracker import usage_tracker

            return usage_tracker.get_statistics()
        except Exception as e:
            return {"error": f"í†µê³„ ì¡°íšŒ ì‹¤íŒ¨: {str(e)}"}

    @app.get("/stem", response_class=HTMLResponse)
    async def stem_page():
        """STEM ë„ê¹¨ë¹„ ë©”ì¸ í˜ì´ì§€"""
        try:
            with open("index_stem.html", "r", encoding="utf-8") as f:
                return f.read()
        except FileNotFoundError:
            return "<h1>STEM í˜ì´ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h1>"
